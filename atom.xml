<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[iginkgoåœ¨è·¯ä¸Š]]></title>
  <link href="iginkgo.cn/atom.xml" rel="self"/>
  <link href="iginkgo.cn/"/>
  <updated>2018-10-09T22:18:34+08:00</updated>
  <id>iginkgo.cn/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im/">MWeb</generator>
  
  <entry>
    <title type="html"><![CDATA[iOS-Appå†…éƒ¨è·³è½¬åˆ°æ¨é€å¼€å…³é¡µé¢]]></title>
    <link href="iginkgo.cn/15390946696808.html"/>
    <updated>2018-10-09T22:17:49+08:00</updated>
    <id>iginkgo.cn/15390946696808.html</id>
    <content type="html"><![CDATA[
<p>ä»Šå¤©ç¢°åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¯éœ€è¦ä½¿ç”¨åœ¨appå†…éƒ¨ç‚¹å‡»æŒ‰é’®ï¼Œç›´æ¥è·³è½¬åˆ°æ¨é€çš„å¼€å…³é¡µé¢ã€‚å®é™…ä»£ç å¦‚ä¸‹æ–¹æ‰€ç¤º</p>

<span id="more"></span><!-- more -->

<pre><code> guard let bundleId = Bundle.main.bundleIdentifier else {
        return
    }
    let url1 = URL.init(string: &quot;App-Prefs:root=\(bundleId)&quot;)!
    let url2 = URL.init(string: UIApplicationOpenSettingsURLString)!
    
    if #available(iOS 11.0, *) {
        
        if UIApplication.shared.canOpenURL(url2){
            UIApplication.shared.open(url2, options: [:], completionHandler: nil)
        }
    }else {
        if #available(iOS 10.0, *){
            UIApplication.shared.open(url1, options: [:], completionHandler: nil)
        }else {
            UIApplication.shared.openURL(url1)
        }
    }

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift POP åº”ç”¨Â ï¼ˆä¸€ï¼‰ UITableViewCell çš„æ³¨å†Œä¸è·å–]]></title>
    <link href="iginkgo.cn/15371868760783.html"/>
    <updated>2018-09-17T20:21:16+08:00</updated>
    <id>iginkgo.cn/15371868760783.html</id>
    <content type="html"><![CDATA[
<p>æœ€è¿‘åœ¨å­¦ä¹  Swift ä¸­åè®®çš„ä½¿ç”¨ã€‚ åœ¨ä¸Šä¸€ç¯‡èŠåˆ° Swift ä¸­ POP çš„ä¼˜åŠ¿ä¹‹åï¼Œ ç”±äºå‚åŠ äº† SwiftGG ä¸¾åŠçš„ Swift å¼€å‘è€…å¤§ä¼šï¼Œ å¬äº† <a href="https://t.co/rf3A9U5IBB">Anddy Hope</a> åœ¨é¡¹ç›® neno ä¸Šä»‹ç»æ–°çš„ä»£ç ç»„ç»‡æ–¹å¼ã€‚ ä½†æ˜¯ä¸»é¢˜ä¹‹å¤–ï¼Œçœ‹åˆ°äº†ä¸€èµ·å…¶å®ƒä¸é”™çš„åœ°æ–¹ã€‚ </p>

<span id="more"></span><!-- more -->

<p>æƒ³åˆ°ä»¥å‰çœ‹åˆ°<strong>æ²¡æ•…äº‹çš„å“åŒå­¦</strong>çš„<a href="https://www.jianshu.com/p/255e02337176">æ–‡ç« </a>ä¸­è®²åˆ°æœ‰å…³åè®®çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨è”æƒ³åˆ°å½“å‰é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œå› æ­¤æŠŠ neno é¡¹ç›®ä¸­çš„ä¸€äº›ä»£ç æ‹¿å‡ºæ¥èŠä¸€èŠ.</p>

<h2 id="toc_0">æœ€ä¼ ç»Ÿçš„ä½¿ç”¨æ–¹å¼</h2>

<p>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ UITableViewCell æˆ–è€… UICollectionViewCell æ—¶ï¼Œ è¦å°†å¯¹åº”çš„ cell æ³¨å†Œåœ¨ UITableView æˆ–è€… UICollectionView ä¸­ï¼Œ å¦‚ä¸‹æ–¹ä»£ç æ‰€ç¤º</p>

<pre><code>let identifier: String = &quot;DemoTableViewCell&quot;
//æ³¨å†Œ
tableView.register(DemoTableViewCell.self, forCellReuseIdentifier: identifier)

//è·å–
let cell = tableView.dequeueReusableCell(withIdentifier:identifier, for: indexPath) as! DemoTableViewCell
</code></pre>

<p>è¿™æ˜¯ä½¿ç”¨ä¸Šæœ€åŸºæœ¬çš„æµç¨‹ï¼Œ å¦‚æœå¯¹äºè·å– cell æ—¶ä½¿ç”¨çš„å¼ºåˆ¶ç±»å‹è½¬æ¢æŠ±æœ‰æ‹…å¿ƒï¼Œ å¯ä»¥åªç”¨ <code>as?</code></p>

<h2 id="toc_1">è¿›ä¸€æ­¥çš„ä½¿ç”¨æ–¹å¼</h2>

<p>åœ¨å…·ä½“çš„ ViewController è®¾ç½® cell å¯¹åº”çš„æ ‡è¯†ç¬¦<code>identifier</code>æ˜¯éå¸¸ä¸å¥½çš„ã€‚å› ä¸ºå½“å‰ ViewController å¯èƒ½æœ‰å¤šä¸ª cellï¼Œä¸€ä¸€æŒ‡å®šæ˜¯å¾ˆæ‚çš„ã€‚ å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œ å½“å‰çš„ UITableViewCell å¯èƒ½åœ¨å¤šä¸ª ViewController ä¸­è¿›è¡Œå¤ç”¨ï¼Œ å¦‚æœæ²¡æœ‰ ViewController ä¸­éƒ½è¿›è¡Œè¿™ä¸ªçš„æ ‡è¯†ï¼Œ ä¹Ÿæ˜¯éå¸¸è´¹äº‹è´¹åŠ›çš„ã€‚<br/>
å› æ­¤ï¼Œè¿›ä¸€æ­¥çš„å®ç°æ˜¯ï¼Œ æˆ‘ä»¬æŠŠæ¯ä¸ª cell å¯¹åº”çš„æ ‡è¯†ç¬¦è®¾ç½®åœ¨ cell çš„å£°æ˜æ–‡ä»¶ä¸­</p>

<pre><code>//å£°æ˜
class DemoTableViewCell: UITableViewCell {
    static let identifier: String = &quot;DemoTableViewCell&quot;
}

//æ³¨å†Œ
tableView.register(DemoTableViewCell.self, forCellReuseIdentifier: DemoTableViewCell)

//è·å–
let cell = tableView.dequeueReusableCell(withIdentifier:DemoTableViewCell.identifier, for: indexPath) as! DemoTableViewCell
</code></pre>

<p>å¦‚æ­¤ï¼Œåˆ™é¿å…äº† identifier çš„å¤šå¤„å£°æ˜ã€‚ é€šå¸¸åœ¨ OC çš„ä»£ç ä¸­ï¼Œç±»ä¼¼çš„æ–¹å¼å°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚<br/>
ä½†æ˜¯åœ¨ tableView æ³¨å†Œ cell ä»¥åŠ è·å– cell çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ–¹æ³•çš„è°ƒç”¨éƒ½ä½¿ç”¨äº†ä¸¤æ¬¡ cell è¿™ä¸ªç±»ï¼Œè¿™æ ·åšæ˜¯æœ‰äº›å†—ä½™çš„ï¼Œ æ¯•ç«Ÿ Swift ä¸­ï¼Œæ³›å‹ä¸åè®®ä¹Ÿæ˜¯éå¸¸å¼ºå¤§çš„ã€‚ç±»ä¼¼çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªç±»ï¼Œ è€Œè·å–ç±»ä¼¼çš„æ•ˆæœã€‚</p>

<h2 id="toc_2">åœ¨åœºæ™¯ä¸­å¼•å…¥ Protocol</h2>

<p>æˆ‘ä»¬å¯ä»¥é»˜è®¤å®ç°ä¸€ä¸ªåè®®ï¼Œåè®®è¦æ±‚åˆ¶å®šä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œé»˜è®¤è¿”å›<code>ç±»å</code>ã€‚</p>

<pre><code>protocol Reusable: class {
 static let identifier: String {get} 
}

extension Reusable {
    static let identifier: String {
        return String(describing: self)
    }
}
</code></pre>

<p>è¿™æ ·ï¼Œåªè¦å¯¹åº”çš„ç±»å®ç°åè®®<code>Reusable</code>ï¼Œåˆ™é»˜è®¤ä¼šç»§æ‰¿åè®®çš„é»˜è®¤æ–¹æ³•ã€‚</p>

<pre><code>extension UITableViewCell: Reusable {}
extension UICollectionViewCell: Reusable {}
</code></pre>

<p>è¿™ç§æƒ…å†µä¸‹ï¼Œ å¯¹äºæ‰€æœ‰çš„<code>UITableViewCell</code>, <code>UICollectionCell</code>çš„ç›¸åº”å­ç±»åˆ™ä¼šé»˜è®¤æ‹¥æœ‰<code>identifier</code>è¿™ä¸ªå±æ€§ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡æ‰‹åŠ¨è¿›è¡Œåˆ¶å®šã€‚ç¡®å®å¿«æ·äº†è®¸å¤šã€‚</p>

<h2 id="toc_3">åœ¨åœºæ™¯ä¸­å¼•å…¥æ³›å‹</h2>

<p>ä¸Šé¢åè®®çš„å¼•å…¥ï¼Œè§£å†³äº†identifier åœ¨æ¯æ¬¡ UITableViewCell è¿›è¡Œå£°æ˜æ—¶æ‰‹åŠ¨åˆ›å»ºçš„é—®é¢˜ï¼Œé‚£ä¹ˆå¯¹äºæ¯æ¬¡ cell çš„<code>æ³¨å†Œ</code>ä¸<code>è·å–</code>æ—¶ï¼Œå¦‚ä½•æŠŠä¸¤æ¬¡ç±»å‹çš„æ‰‹åŠ¨è¾“å…¥è¿›è¡Œç¼©å‡å‘¢ï¼Ÿ è¿™é‡Œå°±éœ€è¦ç”¨åˆ°æ³›å‹äº†ã€‚<br/>
ä¸å¾—ä¸è¯´ï¼Œæ³›å‹æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ã€‚å®ƒä¸€å®šç¨‹åº¦ä¸Šå¤§å¤§ç¼©å‡äº†ä»£ç çš„ä¹¦å†™å¤æ‚åº¦ã€‚</p>

<pre><code>extension UITableView {
    //æ³¨å†Œ
    func register&lt;T: UITableViewCell&gt;(_: T.Type){
        register(T.self, forCellReuseIdentifier: T.reuseIdentifier)
    }
    
    
    //è·å–
     func dequeueReusableCell&lt;T: UITableViewCell&gt;(for indexPath: IndexPath) -&gt; T {
        if let cell = dequeueReusableCell(withIdentifier: T.reuseIdentifier, for: indexPath) as? T {
            return cell
        }
        else {
            fatalError(&quot;The dequeueReusableCell \(String(describing: T.self)) couldn&#39;t be loaded.&quot;)
        }
    }
}
</code></pre>

<p>ç”¨è¿‡å®ç° UITableView çš„æ‰©å±•ï¼Œæ–°å¢ä¸¤ä¸ªå¯¹äº<code>regisiter</code>ä¸<code>dequeueReusableCell</code>è¿›è¡Œå¢å¼ºçš„å‡½æ•°ï¼Œå¼•å…¥æ³›å‹ï¼Œ æœ€ç»ˆå®ç°ï¼Œè¾“å…¥ä¸€æ¬¡å‚æ•°çš„ç»“æœã€‚ ä¸‹é¢æ˜¯å…·ä½“çš„ä½¿ç”¨ï¼š</p>

<pre><code>//æ³¨å†Œ
tableView.register(DemoTableViewCell.self)

//è·å–
let cell: DemoTableViewCell = tableView.dequeueReusableCell(indexPath: indexPath) // ç”¨è¿‡æ³›å‹ï¼Œç›´æ¥å¯ä»¥è¾“å‡ºå¯¹åº”çš„ç±»å‹

</code></pre>

<p>æœ€ç»ˆå¾—åˆ°çš„æ•ˆæœæ˜¯ï¼ŒtableView ä¸­<code>register</code>ä¸<code>dequeueReusableCell</code>æ–¹æ³•ï¼Œåªéœ€è¦è¾“å…¥éœ€è¦çš„ç±»å‹ï¼Œå°±èƒ½å¤Ÿå¾—åˆ°æƒ³è¦å¾—åˆ°çš„ç»“æœï¼Œä¸ä»…åœ¨ä¹¦å†™ä¸Šå¤§å¤§çš„æé€Ÿï¼Œè€Œä¸”åœ¨æ•´æ´æ€§ä¸Šæœ‰äº†æå¤§çš„æå‡ã€‚<br/>
å°¤å…¶æ˜¯åœ¨æ³›å‹çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œ<code>let cell: DemoTableViewCell = tableView.dequeueReusableCell(indexPath: indexPath)</code> é€šè¿‡åœ¨æ–¹æ³•æŒ‡å®šè¿”å›ç±»å‹ï¼Œè¿›ä¸€æ­¥æ¨æ–­æ–¹æ³•å†…éƒ¨è¦è½¬çš„æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ç¼–è¯‘å™¨&quot;å¼ºå¤§&quot;çš„ä¸€ä¸ªä½“ç°ã€‚</p>

<p>demoå†™åˆ°è¿™é‡Œï¼Œå·²ç»éå¸¸çš„ç®€æ´äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œé€šå¸¸æ³¨å†Œ UITableViewCell æœ‰ä¸¤ç§é€”å¾„ï¼š é€šè¿‡ nib æˆ–è€… classã€‚ ä¸Šè¿°è®²åˆ°çš„ï¼Œéƒ½æ˜¯é€šè¿‡æ³¨å†Œ class æ¥è¿›è¡Œåˆ›å»ºçš„ï¼Œ é‚£ä¹ˆnib è¿™ç§æ–¹å¼æ˜¯å¦‚ä½•åˆ›å»ºçš„å‘¢? </p>

<h2 id="toc_4">å¦‚ä½•ä½¿ç”¨nibè¿›è¡Œåˆ›å»º</h2>

<p>å¯¹äºnibçš„åˆ›å»ºä¸æ³¨å†Œï¼Œæˆ‘ä»¬ä¹Ÿå¯æ˜¯å®ç°ç±»ä¼¼<code>protocol é»˜è®¤æ–¹æ³•</code> çš„æ–¹å¼æ¥è¿›è¡Œå®ç°ã€‚<br/>
é¦–å…ˆæˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œ åˆ›å»º nib ç›¸å…³åè®®çš„å®ç°ã€‚ <code>NibLoadable</code>é»˜è®¤å®ç°äº†ï¼Œé€šè¿‡ç±»åæ¥è·å– nibå®ä¾‹çš„æ–¹æ³•ã€‚</p>

<pre><code>protocol NibLoadable {
 static var nib: UINib { get }
}

extension NibLoadable {
    
    static var nib: UINib {
        return UINib(nibName: String(describing: self), bundle: Bundle(for: self))
    }
}
</code></pre>

<p>å½“ç„¶ï¼Œå¹¶éæ‰€æœ‰çš„ UIView æˆ–è€… UITableViewCell éƒ½æ˜¯å¯ä»¥é€šè¿‡nib è¿›è¡Œè·å–çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦<code>æœ‰é€‰æ‹©</code>çš„å¯¹å…¶è¿›è¡Œå®ç°ã€‚ è¿™é‡Œå°±éœ€è¦å¼€å‘è€…æ‰‹åŠ¨æŒ‡å®šæ˜¯å¦è¦å®ç°<code>NibLoadable</code> è¿™ä¸ªåè®®äº†ã€‚</p>

<pre><code>class DemoNibTableViewCell: UITableViewCell, NibLoadable {
  
    override func awakeFromNib() {
        super.awakeFromNib()
    }
}
</code></pre>

<p>å¯¹äºéœ€è¦é€šè¿‡<code>.xib</code>è¿›è¡Œåˆ›å»ºçš„cellï¼Œ æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç»§æ‰¿<code>NibLoadable</code>æä¾›çš„é»˜è®¤å®ç°ã€‚</p>

<pre><code>extension UITableView {
 func register&lt;T: UITableViewCell&gt;(_: T.Type) where T: NibLoadable {
        register(T.nib, forCellReuseIdentifier: T.reuseIdentifier)
    }
}
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ä¸Šæ–‡ä¸­å®ç°çš„<code>register</code>æ–¹æ³•ä¸åŒï¼Œæ­¤å¤„å®ç°çš„æ–¹æ³•é€šè¿‡<code>where</code>è¿›è¡Œäº†<code>ç±»å‹é™å®š</code>ã€‚<br/>
è¦æ±‚ä¼ å…¥çš„å‚æ•°è¦æ»¡è¶³çš„ä¸¤ä¸ªæ¡ä»¶ 1. æ˜¯ UITableViewCellçš„å­ç±»  2. å®ç° NibLoadable åè®®ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬æŠŠä¸¤ä¸ªæ–¹æ³•æ”¾åœ¨ä¸€èµ·è¿›è¡Œä¸€ä¸‹å¯¹æ¯”ï¼š</p>

<pre><code> func register&lt;T: UITableViewCell&gt;(_: T.Type) where T: NibLoadable {
        register(T.nib, forCellReuseIdentifier: T.reuseIdentifier)
    }
    
func register&lt;T: UITableViewCell&gt;(_: T.Type){
        register(T.self, forCellReuseIdentifier: T.reuseIdentifier)
   }
</code></pre>

<p>ä¸¤è€…çœ‹èµ·æ¥ï¼Œåœ¨æ–¹æ³•è°ƒç”¨æ—¶å‡ ä¹çœ‹ä¸å‡ºåŒºåˆ«ï¼Œä½†æ˜¯åœ¨å…·ä½“è°ƒç”¨æ—¶å´ä¼šèµ°ä¸åŒçš„æ–¹æ³•ã€‚ å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ nibLoadable çš„æ–¹æ³•è¦æ±‚çš„å‚æ•°æ›´åŠ ä¸¥æ ¼ä¸€ç‚¹ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ ç¬¬ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯ç¬¬äºŒä¸ªæ–¹æ³•å‚æ•°çš„&quot;å­é›†&quot;.</p>

<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„è°ƒç”¨åœºæ™¯</p>

<pre><code>tableView.register(DemoTableViewCell.self) //é€šè¿‡ UITableViewCell.class è¿›è¡Œåˆ›å»º
tableView.register(DemoNibTableViewCell.self) //é€šè¿‡nib è¿›è¡Œåˆ›å»ºã€‚

</code></pre>

<p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åšå¥½äº†åº•å±‚çš„å·¥ä½œä¹‹åï¼ŒtableView è¿›è¡Œ cell æ³¨å†Œæ—¶ï¼Œ å¼€å‘è€…å‡ ä¹ä¸éœ€è¦åŒºåˆ†å…·ä½“çš„ cell æ˜¯é€šè¿‡ nib åˆ›å»ºè¿˜æ˜¯é€šè¿‡ class åˆ›å»ºã€‚ è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç”Ÿäº§åŠ›ï¼ å”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œåœ¨å®ç°UITableViewCellæ—¶ï¼Œ è¦æœ‰é’ˆå¯¹æ€§çš„æ·»åŠ  NibLoadable è¿™ä¸ªåè®®ï¼Œ è·å–å…¶é»˜è®¤å®ç°ã€‚ è¿™ç›¸å¯¹äºä¼ ç»Ÿçš„æ–¹æ³•å·²ç»æ˜¯ä¸€ä¸ªæˆæœ¬ä½å¾—å¤šçš„æ–¹æ¡ˆã€‚</p>

<h2 id="toc_5">æ€»ç»“</h2>

<p>æœ¬æ–‡ä¸­æ‹¿å‡º Anddy Hope åœ¨demoä¸­çš„ä¾‹å­è¿›è¡Œäº†ä¸€äº›è¯´æ˜ã€‚è™½ç„¶ä½œè€…åœ¨é¡¹ç›®ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„å®ç°ï¼Œä½†æ˜¯ä¸ä¹‹ç›¸æ¯”ï¼Œè¿˜æ˜¯ç¨æœ‰ç‘•ç–µã€‚<br/>
åœ¨è¯¥é¡¹ç›®çš„ä»£ç ä¸­ï¼Œé™¤äº† UITableViewCell çš„ä¸€äº›åŸºæœ¬çš„ä½¿ç”¨ï¼Œ å¯¹äº UITableViewHeaderFooterViewã€ UICollectionViewCell åŒæ ·è¿›è¡Œæ‰©å±•ä½¿ç”¨ã€‚</p>

<p>æ€»ç»“æ¥è¯´ï¼Œ Swift ä¸­çš„åè®®çœŸçš„æ˜¯ä¸€ä¸ªéå¸¸å¼ºåŠ›çš„å·¥å…·ã€‚ ç†Ÿç»ƒçš„è¿›è¡ŒæŒæ¡ï¼Œ æŠ½å–ä¸€äº›å…±æœ‰çš„å±æ€§ã€å…±æœ‰æ–¹æ³•ï¼Œæœ‰é€‰æ‹©çš„è¿›è¡Œåè®®çš„å®ç°ã€‚<br/>
<strong>å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„å‡†åˆ™ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swiftä¸­çš„POPâ€”â€”é¢å‘åè®®ç¼–ç¨‹]]></title>
    <link href="iginkgo.cn/15369184268742.html"/>
    <updated>2018-09-14T17:47:06+08:00</updated>
    <id>iginkgo.cn/15369184268742.html</id>
    <content type="html"><![CDATA[
<p>Don&#39;t start with a class. Start with a protocol</p>

<span id="more"></span><!-- more -->

<ul>
<li>
<a href="#toc_0">ä¸ºä»€ä¹ˆè¦èŠè¿™ä¸ªç‚¹</a>
</li>
<li>
<a href="#toc_1">POP ä¸ OOPçš„å¯¹æ¯”</a>
</li>
<li>
<a href="#toc_2">ç›¸å¯¹äºOCï¼Œ ä¸ºä»€ä¹ˆè¯´Swiftæ˜¯OOPçš„è¯­è¨€</a>
<ul>
<li>
<a href="#toc_3">Swiftä¸­çš„å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹</a>
</li>
<li>
<a href="#toc_4">Swift ä¸­ Protocol çš„ä¸€äº›ç‹¬æœ‰ç‰¹æ€§â€”â€” Extension</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">local reasoning</a>
</li>
<li>
<a href="#toc_6">ä¸€äº›å…·ä½“çš„ä¾‹å­</a>
<ul>
<li>
<a href="#toc_7">Delegate</a>
</li>
<li>
<a href="#toc_8">å¤šæ€</a>
</li>
<li>
<a href="#toc_9">å…·ä½“çš„åº”ç”¨å®ä¾‹</a>
</li>
</ul>
</li>
</ul>


<h2 id="toc_0">ä¸ºä»€ä¹ˆè¦èŠè¿™ä¸ªç‚¹</h2>

<p>2016å¹´åœ¨è‹¹æœçš„å…¨çƒå¼€å‘è€…å¤§ä¼šWWDCä¸Šï¼Œä¸€ä¸ªé¢å‘åè®®çš„ä¸“é¢˜ä¸Šï¼Œæ¼”è®²çš„å¼€å‘è€…è¯´äº†è¿™æ ·ä¸€å¥è¯</p>

<blockquote>
<p>Don&#39;t start with a class. Start with a protocol.<br/>
è¿™å¥è¯æ›¾ç»å¼•èµ·äº†å¼ºçƒˆçš„åå“ã€‚<br/>
Swift ä¸€ç›´è¢«ç§°ä¹‹ä¸ºæ˜¯ä¸€é—¨é¢å‘åè®®ç¼–ç¨‹çš„è¯­è¨€ã€‚åŠ ä¹‹æœ€åœ¨æ€»ç»“iOSå¼€å‘è¿‡ç¨‹ä¸­å¸¸ç”¨çš„æ¨¡å¼ï¼Œå› æ­¤æƒ³ä¸“é—¨æ‹¿å‡ºä¸€äº›æ—¶é—´æ¥è€ƒç©¶ä¸€ä¸‹ï¼Œ Swift ä¸ POP ç©¶ç«Ÿæœ‰ä½•åˆ‡åˆä¹‹å¤„ã€‚</p>
</blockquote>

<h2 id="toc_1">POP ä¸ OOPçš„å¯¹æ¯”</h2>

<p>è¦èŠ POPï¼Œ å°±ä¸å¾—ä¸è¯´ä¸€ä¸‹<code>é¢å‘å¯¹è±¡ç¼–ç¨‹</code> OOP -- Object Oriented Program.</p>

<blockquote>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹â€”â€”Object Oriented Programmingï¼Œç®€ç§°OOPï¼Œæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡æ€æƒ³ã€‚ OOPæŠŠå¯¹è±¡ä½œä¸ºç¨‹åºçš„åŸºæœ¬å•å…ƒï¼Œä¸€ä¸ªå¯¹è±¡åŒ…å«äº†æ•°æ®å’Œæ“ä½œæ•°æ®çš„å‡½æ•°ã€‚</p>
</blockquote>

<p>ä¼ ç»Ÿçš„ç¨‹åºè®¾è®¡ä¸»å¼ å°†ç¨‹åºçœ‹ä½œä¸€ç³»åˆ—å‡½æ•°çš„é›†åˆï¼Œæˆ–è€…ç›´æ¥å°±æ˜¯ä¸€ç³»åˆ—å¯¹è®¡ç®—æœºä¸‹è¾¾çš„æŒ‡ä»¤ã€‚é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½åº”è¯¥èƒ½å¤Ÿæ¥å—æ•°æ®ã€å¤„ç†æ•°æ®å¹¶å°†æ•°æ®ä¼ è¾¾ç»™å…¶å®ƒå¯¹è±¡ï¼Œå› æ­¤å®ƒä»¬éƒ½å¯ä»¥è¢«çœ‹ä½œä¸€ä¸ªå°å‹çš„â€œæœºå™¨â€ï¼Œå³å¯¹è±¡ã€‚<br/>
é¢å‘å¯¹è±¡ç¼–ç¨‹å…·æœ‰ç»§æ‰¿ã€å°è£…ã€å¤šæ€ã€æŠ½è±¡ç­‰ç‰¹ç‚¹ã€‚</p>

<p>ä¸ä¹‹ç›¸å¯¹åº”çš„æ˜¯POPï¼Œå…¨ç§°é¢å‘åè®®ç¼–ç¨‹ã€‚æ˜¯ä¸€ä¸ªä»¥åè®®ä¸ºæ ¸å¿ƒçš„ç¼–ç¨‹æ–¹å¼ã€‚åè®®é›†ä¸­è¡¨è¾¾äº†æŸä¸€ä¸ªç‰¹æ€§æˆ–è€…åŠŸèƒ½ã€‚å®ƒåˆ©ç”¨ç»„åˆçš„ç‰¹æ€§å¯ä»¥æ›´å¥½çš„å®ç°ä»£ç çš„ç»„ç»‡ã€‚</p>

<p>åœ¨iOS ä¸­ï¼Œ OOP æ˜¯å•ç»§æ‰¿çš„ï¼ŒPOPæ˜¯å¤šç»§æ‰¿çš„ã€‚<br/>
ç”±äº OOP çš„å·¥ä½œæ–¹å¼ï¼Œå®ƒæœ€å¥½æ˜¯å•ç»§æ‰¿çš„ã€‚å› ä¸ºå¤šç»§æ‰¿ä¼šè®©ä»£ç å˜å¾—éå¸¸çš„æ··ä¹±ã€‚ <br/>
å½“æˆ‘ä»¬åˆ›å»ºäº†æ¯”è¾ƒå¤§çš„ç±»çš„ç»§æ‰¿é“¾ï¼Œ å¤§é‡çš„å±æ€§æˆ–è€…æ–¹æ³•ä¼šè¢«ç»§æ‰¿ã€‚å½“æœ‰æ–°çš„éœ€æ±‚æˆ–è€…ç‰¹æ€§çš„æ—¶å€™ï¼Œå¼€å‘è€…é€šå¸¸ä¼šå‘ç»§æ‰¿é“¾çš„æ ¹ç±»ï¼ˆæˆ–è€…æ˜¯é è¿‘æ ¹éƒ¨çš„ç¥–å…ˆï¼‰ä¸­æ·»åŠ æ–°ç‰¹æ€§ã€‚å¯¹äºä¸­å±‚æˆ–è€…æ˜¯å¶å­çº§åˆ«çš„ç±»å‹åˆ™ä¼šæœ‰æ›´åŠ ç²¾ç»†çš„éœ€æ±‚ã€‚æ ¹ç±»å‹ä¼šå€¾å‘äºå®ç°ä¸€ç³»åˆ—çš„æ–°ç‰¹æ€§ï¼Œç”±äºéå¸¸å¤šçš„å¯èƒ½å¹¶ä¸æœ‰ç”¨çš„ç‰¹æ€§è€Œå˜å¾—éå¸¸è‡ƒè‚¿ã€‚ å¯¹åº”çš„å­ç±»å‹ä¼šç»§æ‰¿è¿™äº›å¹¶ä¸éœ€è¦çš„ç‰¹æ€§ã€‚<br/>
è¿™äº›OOPå…³æ³¨çš„ç‚¹å¹¶ä¸æ˜¯å†™åœ¨ä¸€èµ·çš„ã€‚ä¸€ä¸ªå¥½çš„å¼€å‘è€…éœ€è¦é¿å…ä¸Šé¢çš„é—®é¢˜ã€‚è¿™å¯èƒ½éœ€è¦èŠ±æ—¶é—´å»ç»å†ã€‚æ¯”å¦‚è¯´ï¼šå¼€å‘è€…å…‹æœè¿™äº›åŠŸèƒ½æ€§è‡ƒè‚¿é—®é¢˜ï¼Œé€šè¿‡æ·»åŠ å…¶å®ƒç±»å‹çš„å®ä¾‹ä½œä¸ºå±æ€§è€Œä¸æ˜¯ä»å…¶å®ƒçš„ç±»ä¸­ç»§æ‰¿è¿‡æ¥ã€‚è¿™ä¹Ÿæ˜¯å¤šç”¨ç»„åˆã€å°‘ç”¨ç»§æ‰¿çš„æ€æƒ³</p>

<p>Protocol æ˜¯é¢å‘åè®®ç¼–ç¨‹ä¸­éå¸¸å…³é”®çš„å› ç´ ã€‚åœ¨ Javaï¼ŒC# ç­‰è¯­è¨€ä¸Šéƒ½æœ‰æ¥å£ï¼ˆInterfaceï¼‰çš„è§‚å¿µã€‚ iOSä¸­çš„ Protocol éå¸¸åƒè¿™äº›è¯­è¨€çš„æ¥å£ï¼Œä½†åˆä¸æ˜¯å®Œå…¨ä¸€æ ·ã€‚è¿™äº› Interface ä»¥åŠ OC ä¸­çš„ Protocol ä»€ä¹ˆéƒ½æ²¡æœ‰å®ç°ï¼Œå®ƒåªæ˜¯å£°æ˜äº†è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œ åƒæ˜¯æè¿°ä¸€ä¸ª <code>è“å›¾</code>ã€‚</p>

<p>OCæ˜ç¡®ä¸‹æ¥ï¼Œ ä½¿ç”¨ protocol æ¥ä»£æ›¿æ¥å£ interfaceï¼Œ protocolå¯ä»¥è·å– æ–¹æ³•ä»¥åŠå±æ€§ï¼Œä½†æ˜¯åªæœ‰classèƒ½å¤Ÿå®ç° Protocol ï¼Œ <strong>struct</strong>åˆ™ä¸å¯ä»¥ã€‚</p>

<h2 id="toc_2">ç›¸å¯¹äºOCï¼Œ ä¸ºä»€ä¹ˆè¯´Swiftæ˜¯OOPçš„è¯­è¨€</h2>

<p>Swiftè¿™ä¸ªè¯­è¨€æ˜¯ä»¥åè®®ä¸ºåŸºç¡€å‘å±•èµ·æ¥çš„ã€‚Swiftæ ‡å‡†åº“é‡Œæœ‰50å¤šä¸ªå¤æ‚ä¸ä¸€çš„åè®®ï¼Œå‡ ä¹æ‰€æœ‰çš„å®é™…ç±»å‹éƒ½æ˜¯å®ç°äº†è‹¥å¹²åè®®çš„ã€‚å®ƒæ˜¯ä»¥åè®®ä¸ºåŸºç¡€ç»„ç»‡å’Œå»ºç«‹èµ·æ¥çš„ã€‚è¿™ä¸æˆ‘ä»¬å¹³æ—¶æ‰€ç†ŸçŸ¥çš„é¢å‘å¯¹è±¡çš„æ–¹å¼å¾ˆä¸ä¸€æ ·ã€‚<br/>
åœ¨Swiftä¹‹å‰ï¼Œ Protocol åœ¨ OC ä¸­ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚ä½†æ˜¯ä¸åœ¨ OC ä¸­çš„åè®®ç›¸æ¯”ï¼Œæœ‰äº†é•¿è¶³çš„è¿›æ­¥ã€‚æ€»ç»“ä¸‹æ¥æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š<br/>
1. Swiftä¸­çš„å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½å¯ä»¥è¿›è¡Œå®ç°ã€‚<br/>
2. Swiftä¸­å®ç°äº†ä¸€äº›å…¶å®ƒè¯­è¨€éƒ½ä¸æ”¯æŒçš„ç‰¹æ€§ã€‚<br/>
ä¸‹é¢å¯ä»¥è¯¦ç»†çš„è¯´ä¸€è¯´å…·ä½“éƒ½æœ‰å“ªäº›</p>

<h3 id="toc_3">Swiftä¸­çš„å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹</h3>

<p>åœ¨ OC ä¸­ï¼Œ åªæœ‰ class æ‰èƒ½å¤Ÿå®ç°åè®®ï¼Œ ä½†æ˜¯ç­‰åˆ° Apple æ¨å‡º Swift è¿™é—¨è¯­è¨€ï¼Œè¿™ä¸ªæƒ…å†µå¾—ä»¥å¤§å¤§çš„æ”¹è§‚ã€‚<br/>
Swift åœ¨å€¼ç±»å‹çš„ä½¿ç”¨æ–¹ä¾¿è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¼•å…¥<code>Copy-On-Write</code>æœºåˆ¶ï¼Œä½¿å¾—å€¼ç±»å‹åªæœ‰åœ¨è¢«ä¿®æ”¹çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ Copy æ“ä½œï¼Œ å¤§å¤§æå‡äº†æ€§èƒ½ã€‚è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¼±åŒ–äº†å¼•ç”¨ç±»å‹çš„å­˜åœ¨æ„ä¹‰ã€‚å› æ­¤åœ¨Swiftä¸­ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†çš„æ•°æ®ç»“æ„éƒ½æ”¹ä¸ºç”¨å€¼ç±»å‹æœºå‹å®ç°ï¼Œ åŒ…æ‹¬<code>String</code>, <code>Array</code>ç­‰ç­‰ã€‚æ­¤å¤–ï¼ŒSwiftä¸­ä½¿ç”¨æœ€ä¸ºæ™®éçš„<code>Class</code>, <code>Struct</code>, <code>Enum</code>ï¼Œåªæœ‰ <code>Class</code> æ˜¯å¼•ç”¨ç±»å‹ï¼Œå…¶å®ƒä¸¤ä¸ªéƒ½å·²ç»æ˜¯ç”¨å€¼ç±»å‹è¿›è¡Œå®ç°ã€‚<br/>
å¼•ç”¨ç±»å‹åœ¨ä½¿ç”¨ä¸Šï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€å®šçš„é™„ä½œç”¨ï¼Œä¸€ä¸ªå¼•ç”¨è¢«åˆ†äº«åï¼Œå¾ˆå¯èƒ½è¢«ä¸å¯é¢„æ–™çš„ä¿®æ”¹ã€‚å€¼ç±»å‹å¯ä»¥å¾ˆå¥½çš„é¿å…è¿™ä¸ªé—®é¢˜ã€‚<br/>
å…¶ä¸­ï¼ŒSwiftä¸­å®ç°Protocolçš„ä¸»ä½“å·²ç»ä¸ä»…ä»…é™äºClassï¼Œ å…¶å®ƒçš„å€¼ç±»å‹ä¹Ÿå¯ä»¥å®ç°ã€‚WWDCä¸“é—¨æœ‰ä¸€æœŸè®²ç›¸åº”çš„<a href="https://developer.apple.com/videos/play/wwdc2016/419/">ä½¿ç”¨</a></p>

<h3 id="toc_4">Swift ä¸­ Protocol çš„ä¸€äº›ç‹¬æœ‰ç‰¹æ€§â€”â€” Extension</h3>

<blockquote>
<p>åè®®å¯ä»¥é€šè¿‡æ‰©å±•æ¥æä¾›æ–¹æ³•ã€åˆå§‹åŒ–æ–¹æ³•ã€ä¸‹æ ‡ä»¥åŠå¯¹åº”ç±»å‹çš„è®¡ç®—å±æ€§ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥é€šè¿‡åè®®æ¥çº¦å®šä¸€äº›å…·ä½“çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯è®¾ç½®å…¨å±€çš„æ–¹æ³•æˆ–è€…åœ¨å…·ä½“çš„æŸä¸ªç±»ä¸­åˆ†åˆ«è¿›è¡Œå®ç°ã€‚</p>

<p>é€šè¿‡å®ç°åè®®çš„æ‰©å±•ï¼Œ æ‰€æœ‰éµå®ˆåè®®çš„ç±»å‹éƒ½ä¼šè‡ªåŠ¨è·å–æ‰©å±•ä¸­å®ç°çš„æ–¹æ³•</p>

<p>å¯ä»¥ä½¿ç”¨åè®®çš„æ‰©å±•æ¥æä¾›æ–¹æ³•æˆ–è€…è®¡ç®—å±æ€§çš„é»˜è®¤å®ç°ã€‚å¦‚æœä¸€ä¸ªå®ç°åè®®çš„ç±»å‹æä¾›äº†å¯¹åº”çš„æ–¹æ³•æˆ–è€…å±æ€§ï¼Œåˆ™ç±»å‹ä¸­å…·ä½“çš„å®ç°ä¼šå–ä»£é»˜è®¤çš„å®ç°ã€‚</p>
</blockquote>

<h2 id="toc_5">local reasoning</h2>

<p><a href="https://developer.apple.com/videos/play/wwdc2016/419/?time=41">WWDCä¸­çš„å‡ºå¤„</a>ä¸­è®²åˆ°</p>

<blockquote>
<p>Local reasoning means that when you look at the code, right in front of you, you donâ€™t have to think about how the rest of your code interacts with that one function. You may have had this feeling before and thatâ€™s just a name for that feeling. For example, maybe when you just joined a new team and you have tons of code to look at but very little context, can you understand whatâ€™s going on in that single function? And so the ability to do that is really important because it makes it easier to maintain, easier to write, and easier to test, and easier to write the code the first time.</p>
</blockquote>

<p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œä½†ä½ çœ‹åˆ°çœ¼å‰çš„ä»£ç ç‰‡æ®µï¼Œä½ ç”šè‡³éƒ½ä¸ç”¨å»çœ‹æ–¹æ³•å‰©ä½™çš„ä»£ç ç‰‡æ®µæ˜¯å¦‚ä½•å®ç°çš„ã€‚è¿™ä¹‹å‰ä½ æœ‰ä¼šæœ‰ä¸€ç§æ„Ÿè§‰ï¼Œæ„Ÿè§‰åˆ°æ–¹æ³•çš„åå­—ã€‚ æ¯”å¦‚è¯´ï¼Œè·å–å½“ä½ åˆšåŠ å…¥ä¸€ä¸ªæ–°çš„teamï¼Œä½ ä¼šæœ‰å¤§é‡çš„ä»£ç è¦çœ‹ï¼Œä½†æ˜¯ç¼ºä¹ä¸Šä¸‹æ–‡ã€‚ä½ èƒ½å¤Ÿä»è¿™ä¸ªå•ä¸€çš„æ–¹æ³•ä¸­æ¨æµ‹å‡ºä¼šå‘ç”Ÿä»€ä¹ˆå—ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„èƒ½åŠ›ï¼Œä¿æŒä»£ç çš„ç®€æ´ã€æ˜“å†™æ˜“æµ‹ã€‚</p>

<p>å½“ç„¶ï¼Œæˆ‘æ‰¿è®¤è¿™æ˜¯ä¸€ä¸ªéå¸¸éš¾çš„èƒ½åŠ›ã€‚å°¤å…¶æ˜¯ç»™methodå–ä¸€ä¸ªæ°å¦‚å…¶åˆ†çš„åå­—æ˜¯ç¼–ç è¿‡ç¨‹ä¸­éå¸¸éš¾çš„ä¸€ç¯ğŸ˜…ã€‚</p>

<p>æ‹¿é€šç”¨çš„<code>Array</code>æ¥ä¸¾ä¸ªä¾‹å­ï¼Œ Swiftä¸­çš„ Array å®ç°äº†11ä¸ªåè®®</p>

<pre><code>BidirectionalCollection, 
Collection,
CustomDebugStringConvertible, 
CustomReflectable, 
CustomStringConvertible,
ExpressibleByArrayLiteral, 
MutableCollection, 
RandomAccessCollection,
RangeReplaceableCollection,
Sequence
</code></pre>

<p>é€šå¸¸æ¯ä¸ªåè®®éƒ½ä¼šæœ‰ä¸€ä¸ªå•ä¸€çš„èŒèƒ½ã€‚åœ¨ä¸€ä¸ªå›¢é˜Ÿæ–°æˆå‘˜æ¥é˜…è¯»ä»£ç æ—¶ï¼Œåœ¨ä»–èƒ½å¤Ÿæµåˆ©çš„é˜…è¯»ä»£ç å‰ï¼Œ æ¥åˆ°ä»£ç çš„å£°æ˜å¤„æŸ¥çœ‹ä¸€ä¸‹å®šä¹‰ä»¥åŠå®ç°çš„åè®®ï¼Œå°±ä¼šå¯¹å…·ä½“çš„åŠŸèƒ½æœ‰ä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°çš„è®¤è¯†ã€‚</p>

<h2 id="toc_6">ä¸€äº›å…·ä½“çš„ä¾‹å­</h2>

<h3 id="toc_7">Delegate</h3>

<pre><code>protocol Delelgate {
    .....
}

var delegate: Delegate?
</code></pre>

<p>Protocolåœ¨ä½œä¸ºä»£ç†æ—¶ï¼Œ å¯ä»¥ä½œä¸ºå…·ä½“çš„æŸä¸ªç±»å‹æ¥è¿›è¡Œå£°æ˜å’Œè°ƒç”¨ã€‚ç›¸ä¿¡å°ä¼™ä¼´ä»¬å¯¹äº iOS ä¸­çš„ delegate ç›¸å…³çŸ¥è¯†ç‚¹å·²ç»ä¸é™Œç”Ÿäº†ã€‚</p>

<h3 id="toc_8">å¤šæ€</h3>

<p>ä¸¾ä¸ªä¾‹å­</p>

<pre><code>protocol BaseProtocol {
    var protocolName: String { get }
}
 
protocol CenterProtocol: BaseProtocol {
    
}
 
protocol HighProtocol: CenterProtocol {
    
}
 
struct BaseLevel : BaseProtocol {
    var protocolName: String = &quot;BaseLevel&quot;
}
 
struct CenterLevel : CenterProtocol {
    var protocolName: String = &quot;CenterLevel&quot;
}
 
struct HighLevel : HighProtocol {
    var protocolName: String = &quot;HighLevel&quot;
}
 
let base = BaseLevel()
let center = CenterLevel()
let high = HighLevel()
 
var item: BaseProtocol
item = base
print(&quot;\(item)\n&quot;)
// prints &quot;BaseLevel(protocolName: &quot;BaseLevel&quot;)&quot;
 
topStruct = center
print(&quot;\(item)\n&quot;)
// prints &quot;CenterLevel(protocolName: &quot;MiddleStruct&quot;)&quot;
 
topStruct = high
print(&quot;\(item)\n&quot;)
// prints &quot;HighLevel(protocolName: &quot;HighLevel&quot;)&quot;
 
let protocolStructs:[Top] = [base,center,high]
 
for protocolStruct in protocolStructs {
    print(&quot;\(protocolStruct)\n&quot;)
}
</code></pre>

<h3 id="toc_9">å…·ä½“çš„åº”ç”¨å®ä¾‹</h3>

<pre><code>protocol ViewWithBorder {}

// SAFETY: Constrain &quot;addBorder&quot; only to UIViews.
extension ViewWithBorder where Self : UIView {
    func addBorder() -&gt; Void {
        layer.borderColor = UIColor.green.cgColor
        layer.borderWidth = 10.0
    }
}

class BorderView : UIView, ViewWithBorder {
}
</code></pre>

<p>å®é™…è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œåˆå§‹åŒ–<code>BorderView</code>å¯ä»¥ç›´æ¥è°ƒç”¨<code>addBorder()</code>æ–¹æ³•</p>

<pre><code>var view = BorderView()
view.addBorder()
</code></pre>

<p>æ­¤å¤–ï¼ŒåŸºäºåè®®çš„æ³›å‹ç»“æ„ä¹Ÿéå¸¸çš„é‡è¦ï¼Œ æ¯”å¦‚Array<T>, Stack<T>, Queue<T>ç­‰ç­‰ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2018.09.10-2018.09.16]]></title>
    <link href="iginkgo.cn/15366742578883.html"/>
    <updated>2018-09-11T21:57:37+08:00</updated>
    <id>iginkgo.cn/15366742578883.html</id>
    <content type="html"><![CDATA[
<p>ä¸€å‘¨è§é—»</p>

<span id="more"></span><!-- more -->

<h2 id="toc_0">ä¸‰åå¹´ï¼Œä¸­å›½å·¥ä¸šè½¯ä»¶ä»æ¬£æ¬£å‘è£åˆ°æºƒä¸æˆå†›</h2>

<p><a href="https://www.youtube.com/watch?v=oJ-mvkA__Yc">è§†é¢‘åœ°å€</a><br/>
å·¥ä¸šè½¯ä»¶ä»æ¥éƒ½æ˜¯å·¥ä¸šçš„ç»“æ™¶ï¼Œè€Œä¸æ˜¯ITçš„äº§ç‰©ã€‚ 2018å¹´çš„ä¸­å…´äº‹ä»¶æ…å¼€äº†ä¸­å›½å·¥ä¸šè½¯ä»¶çš„é»‘çªŸçª¿ï¼Œè®©äººä»¬æ„è¯†åˆ°ä¸­å›½çš„å·¥ä¸šè½¯ä»¶å‘å±•çš„çŸ­æ¿ã€‚å½“å‰çš„å·¥ä¸šè½¯ä»¶ï¼Œå¯¹äºä¸­å›½è€Œè¨€ï¼Œä¸æ­¢æ˜¯çŸ­æ¿ï¼Œè€Œä¸”æ˜¯â€œæ–­â€æ¿</p>

<h2 id="toc_1">9æœˆ13æ—¥å‡Œæ™¨ï¼Œè‹¹æœå‘å¸ƒäº†æ–°å“</h2>

<p>æ–°å“æ‰‹æœºåŒ…æ‹¬ iPhoneXSã€ iPhoneXRï¼Œ å…¶ä¸­iPhoneXRå®ç°äº†çœŸæ­£çš„åŒå¡åŒå¾…ï¼Œå¹¶å¤§å¹…åº¦çš„æé«˜äº†ARçš„å¤„ç†æ•ˆæœï¼Œå†åŠ ä¸Š5Gæ—¶ä»£çš„æ¥ä¸´ï¼Œæˆ‘è®¤ä¸ºARçš„çˆ†å‘å·²ç»ç¦»æˆ‘ä»¬ä¸è¿œäº†ã€‚ </p>

<h2 id="toc_2">9æœˆ15æ—¥ã€16æ—¥ SwiftGGä¸¾åŠçš„æ´»åŠ¨</h2>

<p>Swift å¼€å‘è€…æ´»åŠ¨ï¼Œä¹Ÿæ˜¯å¬äº†å¾ˆå¤šæœ‰æ„æ€çš„ä¸»é¢˜<br/>
ä» Swift åˆ°æœºå™¨å­¦ä¹  â€”â€”â€”â€” ç‹å·<br/>
æ€ä¹ˆç”¨ Swift å†™è§£é‡Šå™¨ä»¥åŠä½¿ç”¨åœºæ™¯ â€”â€”â€”â€” æˆ´é“­<br/>
åšä¸€ä¸ªæœ‰è¶£çš„å¤šäºº AR æ¸¸æˆ â€”â€”â€”â€” åˆ˜å† æ‰<br/>
çŒ¿è¾…å¯¼ä» OC åˆ° Swift çš„è¿ç§»ä¹‹è·¯ â€”â€”â€”â€” å”å·§<br/>
Strings Seven Ways â€”â€”â€”â€” åˆ˜æŒ¯å¤«<br/>
Live Code â€”â€”â€”â€” å”æ™“è½©<br/>
Swift For Tensorflow â€”â€”â€”â€” ç‹æ–‡è°¨<br/>
iOS Architecture improvements with Swift â€”â€”â€”â€” Andyy Hope<br/>
CollectionKit ä½¿ç”¨ â€”â€”â€”â€” Luke<br/>
iOS é€†å‘åº”ç”¨ â€”â€”â€”â€” åˆ˜åŸ¹åº†</p>

<p>æ€»çš„æ¥è¯´ï¼Œå‚åŠ è¿™ç§å¼€å‘è€…æ´»åŠ¨ï¼Œè¿˜æ˜¯å¾ˆæœ‰æ”¶è·çš„ã€‚ ä½œä¸º iOS å¼€å‘è€…ï¼Œåœ¨æœºå™¨å­¦ä¹ ã€ARã€é€†å‘æ–¹é¢éƒ½èƒ½æœ‰å¾ˆæ£’çš„åº”ç”¨ã€‚<br/>
è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œå›½å¤–çš„ Swfit éƒ½åœ¨å¦‚ç«å¦‚è¼çš„å‘å±•ï¼Œ å›½å†…ä¾æ—§æ˜¯ OC å æ®ä¸»æµã€‚ ä¹Ÿå¸Œæœ›å›½å†… Swift çš„å¤§æ½®èµ¶å¿«åˆ°æ¥ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RxCocoaä¸­çš„ AOP å®ç°]]></title>
    <link href="iginkgo.cn/15361137574405.html"/>
    <updated>2018-09-05T10:15:57+08:00</updated>
    <id>iginkgo.cn/15361137574405.html</id>
    <content type="html"><![CDATA[
<span id="more"></span><!-- more -->

<ul>
<li>
<a href="#toc_0">ä»‹ç»</a>
</li>
<li>
<a href="#toc_1">Let&#39;s go</a>
</li>
<li>
<a href="#toc_2">MessageSentProxy</a>
</li>
<li>
<a href="#toc_3">registerMessageInterceptor(selector)</a>
</li>
<li>
<a href="#toc_4">è§£è¯»æ–¹æ³•çš„hook</a>
</li>
</ul>


<blockquote>
<p>åœ¨è½¯ä»¶ä¸šï¼ŒAOPä¸º Aspect Oriented Programming çš„ç¼©å†™ï¼Œæ„ä¸ºï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚</p>
</blockquote>

<h2 id="toc_0">ä»‹ç»</h2>

<p>åœ¨ RxCocoa çš„ä»£ç ä¸­ï¼Œå¯¹äº <code>NSObject</code> çš„æ‰©å±•ä¸­ï¼Œæœ‰è¿™ä¸¤ä¸ªä»£ç ï¼Œå®ç°äº†å¯¹äºå®ä¾‹æ–¹æ³•çš„ AOP</p>

<pre><code class="language-swift">
public func sentMessage(_ selector: Selector) -&gt; Observable&lt;[Any]&gt;
public func methodInvoked(_ selector: Selector) -&gt; Observable&lt;[Any]&gt;

</code></pre>

<p>åœ¨æœ¬è´¨ä¸Šè¯´ï¼Œå®ƒä»¬å¯¹ <code>selector</code> çš„è§¦å‘æ—¶æœºè¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ†åˆ«åœ¨ <code>selector</code> è§¦å‘å‰ã€è§¦å‘åæ’å…¥è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚</p>

<p>ä¸‹é¢æ˜¯å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼š</p>

<pre><code>import UIKit
import RxSwift
import RxCocoa

class ViewController: UIViewController {
    private let bag = DisposeBag()
    override func viewDidLoad() {
self.rx.sentMessage(#selector(ViewController.viewWillAppear(_:))).asObservable().subscribe { (_) in
            print(&quot;sendMessage&quot;)
        }.disposed(by: bag)
        
self.rx.methodInvoked(#selector(ViewController.viewWillAppear(_:))).asObservable().subscribe { (_) in
            print(&quot;methodInvoked&quot;)
        }.disposed(by: bag)
    }
    
    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)
        print(&quot;viewWillAppear&quot;)
    }
}
</code></pre>

<p>è¾“å‡ºç»“æœ<br/>
<img src="media/15361137574405/15361338672279.jpg" alt=""/></p>

<p>æœ€ç»ˆçš„æ•ˆæœæ˜¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œå‰ä¸æ‰§è¡Œåçš„ä¸¤ä¸ªæ—¶é—´ç‚¹æ’å…¥äº†å¯¹åº”çš„æ–¹æ³•ã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬å°±å‰–æä¸€ä¸‹ï¼ŒRxCocoa ç©¶ç«Ÿåšäº†äº›ä»€ä¹ˆã€‚<br/>
æœ¬æ–‡ä¼šä»å¤–éƒ¨è°ƒç”¨çš„æ–¹æ³• <code>setMessage</code> å¼€å§‹ï¼Œä¸€æ­¥æ­¥æŸ¥çœ‹å†…éƒ¨çš„å…·ä½“çš„å®ç°ã€‚</p>

<h2 id="toc_1">Let&#39;s go</h2>

<p>ç®€å•å‰–æä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å¯¹äºä¸¤ä¸ª Observable è¿›è¡Œäº†ç›‘å¬ (<a href="https://github.com/ReactiveX/RxSwift">RxSwiftçš„ä»‹ç»</a>)ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å®é™…çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œ<br/>
selector å¯¹åº”çš„æ–¹æ³•åœ¨å³å°†æ‰§è¡Œå‰è‚¯å®šæ˜¯è¦è§¦å‘ setMessage æ‰€å¯¹åº”çš„ Observable å¹¶å‘å‡ºä¿¡å·ã€‚<br/>
selector å¯¹åº”çš„æ–¹æ³•åœ¨æ‰§è¡Œå®Œæˆè‚¯å®šè¦è§¦å‘ methodInvoked æ‰€å¯¹åº”çš„ Observable å¹¶å‘å‡ºä¿¡å·ã€‚<br/>
å½“ç„¶ï¼Œè¿™éƒ½æ˜¯æˆ‘ä»¬åŸºäºå½“å‰çš„è°ƒç”¨æ–¹æ³•ç»™å‡ºçš„æ¨æµ‹ï¼Œé‚£çœ‹çœ‹å®é™…éƒ½åšäº†äº›ä»€ä¹ˆã€‚</p>

<p>é¦–å…ˆçœ‹ <code>setMessage</code> æ‰€å¯¹åº”çš„æ–¹æ³•çš„å…·ä½“å®ç°ã€‚</p>

<pre><code>   public func sentMessage(_ selector: Selector) -&gt; Observable&lt;[Any]&gt; {
        return synchronized {
            // in case of dealloc selector replay subject behavior needs to be used
            if selector == deallocSelector {
                return deallocating.map { _ in [] }
            }

            do {
                let proxy: MessageSentProxy = try registerMessageInterceptor(selector) 
                return proxy.messageSent.asObservable()
            }
            catch let e {
                return Observable.error(e)
            }
        }
    }
</code></pre>

<p>ä¸Šé¢çš„ä»£ç æœ‰2è¡Œæ˜¯æ ¸å¿ƒã€‚</p>

<p><code>let proxy: MessageSentProxy = try registerMessageInterceptor(selector)</code><br/>
<code>proxy.messageSent.asObservable()</code> </p>

<p>å…¶ä¸­ç¬¬ä¸€è¡Œä»£ç å®ç°çš„åŠŸèƒ½æ˜¯ï¼šä¸ºè¯¥selectoråˆ›å»ºæˆ–è€…è·å–ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚<br/>
ç¬¬äºŒè¡Œä»£ç ï¼Œåˆ™æ˜¯è¿”å› messageSent çš„ä¿¡å·æºï¼Œå®ƒèƒ½ä¿è¯åœ¨æ°å½“çš„æ—¶å€™å‡ºå‘ä¿¡å·ã€‚<br/>
ä¸‹é¢åˆ†åˆ«è¦å¯¹è¿™ä¸¤ä¸ªä»£ç è¿›è¡Œå…·ä½“çš„åˆ†æã€‚</p>

<h2 id="toc_2">MessageSentProxy</h2>

<p>è´´ä¸€ä¸‹MessageSentProxyçš„å…·ä½“çš„ä»£ç ï¼š</p>

<pre><code>fileprivate final class MessageSentProxy
        : MessageInterceptorSubject
        , RXMessageSentObserver {
        typealias E = [AnyObject]

        let messageSent = PublishSubject&lt;[Any]&gt;() //messageæ‰€å¯¹åº”çš„subjectï¼ˆObservableï¼‰ï¼Œä¹Ÿå°±æ˜¯è¢«è§‚å¯Ÿè€…
        let methodInvoked = PublishSubject&lt;[Any]&gt;()//invoked æ‰€å¯¹åº”çš„è¢«è§‚å¯Ÿè€…

        @objc var targetImplementation: IMP = RX_default_target_implementation()

        var isActive: Bool {
            return targetImplementation != RX_default_target_implementation()
        }

        init() {
        }

        @objc func messageSent(withArguments arguments: [Any]) -&gt; Void {
            messageSent.on(.next(arguments))
        }

        @objc func methodInvoked(withArguments arguments: [Any]) -&gt; Void {
            methodInvoked.on(.next(arguments))
        }

        deinit {
            messageSent.on(.completed)
            methodInvoked.on(.completed)
        }
    }
</code></pre>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<code>MessageSentProxy</code> è¿™ä¸ªç±»åˆ†åˆ«æŒæœ‰äº†åä¸º <code>messageSent</code> ä»¥åŠ <code>methodInvoked</code> çš„ä¸¤ä¸ªè¢«è§‚å¯Ÿè€…ã€‚<br/>
åº”è¯¥å¯ä»¥çœ‹å‡ºï¼Œä»–ä»¬åˆ†åˆ«å¯¹åº”ç€ selector å‰åçš„è§¦å‘æ—¶æœºï¼Œå¯¹è¿™ä¸¤ä¸ªå‚æ•°è¿›è¡Œç›‘å¬ï¼Œä¹Ÿå°±æ˜¯å˜ç›¸çš„ç›‘å¬äº†selector è§¦å‘çš„å‰åçš„æ—¶æœºã€‚</p>

<p>å…¶ä¸­å†…éƒ¨çš„ <code>messageSent(withArguments arguments: [Any])</code> ä»¥åŠ <code>methodInvoked(withArguments arguments: [Any])</code> æ–¹æ³•åˆ†åˆ«è°ƒç”¨å¹¶ä¿ƒä½¿ä¸¤ä¸ªè¢«è§‚å¯Ÿè€…å‘å‡ºä¿¡å·ã€‚</p>

<p>ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«ç”¨ @objc è¿›è¡Œä¿®é¥°ï¼Œæ ‡æ˜ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥è¢« OC çš„è°ƒç”¨æœºåˆ¶è§¦å‘ã€‚</p>

<p>é‚£å½“å‰å¯ä»¥æ•´ç†å‡ºçš„è§¦å‘é¡ºåºæ˜¯ï¼š<br/>
1. MessageSentProxy ä¸­ <code>messageSent(withArguments arguments: [Any])</code> æ–¹æ³•è¢«è°ƒç”¨<br/>
2. MessageSentProxy ä¸­ <code>messageSent = PublishSubject&lt;[Any]&gt;()</code> è§¦å‘ onNext ä¿¡å·<br/>
3. å¤–éƒ¨å¯¹äº <code>messageSent</code> çš„ç›‘å¬äº‹ä»¶è§¦å‘</p>

<p>é‚£å¥½ï¼Œç»§ç»­æ·±ç©¶ä¸€ä¸‹ã€‚</p>

<h2 id="toc_3">registerMessageInterceptor(selector)</h2>

<p>ä¸Šé¢è®²åˆ° <code>registerMessageInterceptor(selector)</code> æ–¹æ³•æ˜¯é€šè¿‡ selector æ¥åˆ›å»ºä¸€ä¸ªMessageSentProxy, ç”¨æ¥å®ç° Observable. ç”±äºåŒä¸€ä¸ª selector å¯èƒ½æœ‰2ä¸ªç›‘å¬äº‹ä»¶  <code>sentMessage</code> ä»¥åŠ <code>methodInvoke</code>, è€Œä¸¤è€…éƒ½æ˜¯é€šè¿‡åŒä¸€ä¸ª <code>MessageSentProxy</code> æ¥å®ç°ã€‚å› æ­¤æœ€ç»ˆä¸€ä¸ªselectorå¯¹åº”äºä¸€ä¸ª MessageSentProxy, ä¹Ÿä¸éœ€è¦è¿›è¡Œåå¤çš„åˆ›å»ºã€‚<br/>
é‚£ç©¶ç«Ÿåšäº†å“ªäº›äº‹æƒ…å‘¢ï¼Ÿ</p>

<pre><code> //è¯¥æ–¹æ³•ä¿è¯äº†ï¼Œåœ¨åŒä¸€ä¸ªtargetä¸Š åŒä¸€ä¸ªselector åªä¼šæœ‰ ä¸€ä¸ªMessageInterceptorSubjectä¸ä¹‹ç»‘å®šã€‚
    fileprivate func registerMessageInterceptor&lt;T: MessageInterceptorSubject&gt;(_ selector: Selector) throws -&gt; T {
        let rxSelector = RX_selector(selector) //æ·»åŠ å‰ç¼€ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„selector å½“å‰åªæœ‰åå­—
        let selectorReference = RX_reference_from_selector(rxSelector) 

        let subject: T
        if let existingSubject = objc_getAssociatedObject(base, selectorReference) as? T { //å¦‚æœè¿™ä¸ªselectoræœ‰å…³è”å€¼çš„è¯ï¼Œ èµ‹å€¼ç»™subject
            subject = existingSubject
        }
        else { //å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªSubjectå¯¹è±¡ï¼ŒæŠŠå®ƒå…³è”ç»™å½“å‰çš„base
            subject = T()
            objc_setAssociatedObject(
                base,
                selectorReference,
                subject,
                .OBJC_ASSOCIATION_RETAIN_NONATOMIC
            )
        }

        if subject.isActive { // è¡¨ç¤ºå…¶å†…éƒ¨çš„IMP å…¶å®å·²ç»èµ‹å€¼äº†ï¼Œ å¦åˆ™å°±æ˜¯è¿˜æ²¡æœ‰èµ‹å€¼ã€‚
            return subject
        }

        var error: NSError?
        let targetImplementation = RX_ensure_observing(base, selector, &amp;error)
        if targetImplementation == nil {
            throw error?.rxCocoaErrorForTarget(base) ?? RxCocoaError.unknown
        }

        subject.targetImplementation = targetImplementation!

        return subject
</code></pre>

<p>ä¸Šé¢çš„ä»£ç åšäº†å¤§æ¦‚å‡ ä»¶äº‹ï¼š<br/>
1.å°† MessageInterceptorSubjectï¼Œä¹Ÿå°±æ˜¯è¯¥æ–¹æ³•è°ƒç”¨å¤„çš„ MessageSentProxy é€šè¿‡ selector ä¸å½“å‰çš„å¯¹è±¡è¿›è¡Œç»‘å®šã€‚<br/>
2.å¦‚æœå¯¹åº”çš„ selector å·²ç»ç»‘å®šè¿‡äº†ï¼Œåˆ™è·å–å·²ç»‘å®šçš„ MessageSentProxy.<br/>
è¿™æ˜¯ç”±äºå¯¹åº”åŒä¸€ä¸ªselectorï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ sentMessage ä»¥åŠ methodInvoke ä¸¤ä¸ªç›‘å¬äº‹ä»¶ï¼Œä¸¤ä¸ªç›‘å¬äº‹ä»¶å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªMessageSentProxy, é¿å…é‡å¤å·¥ä½œã€‚<br/>
3.å¼€å§‹ hook å¯¹åº”çš„ selectorï¼Œè¿›è¡Œæ’å…¥æ“ä½œ<br/>
æ ¸å¿ƒä»£ç <br/>
<code>let targetImplementation = RX_ensure_observing(base, selector, &amp;error)</code></p>

<h2 id="toc_4">è§£è¯»æ–¹æ³•çš„hook</h2>

<p>è¿™ä¹Ÿæ˜¯å½“å‰è¿™ä¸ªè¿‡ç¨‹ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚<br/>
è¿˜è®°å¾—KVOæ˜¯æ€ä¹ˆå®ç°çš„å—ï¼Ÿå¦‚æœä¸è®°å¾—ï¼Œå¯ä»¥åœ¨çœ‹ä¸€ä¸‹(<a href="15360544284777.html">KVOä»£ç æµ‹è¯•ä»¥åŠæ¢ç©¶</a>)</p>

<p>ç»§ç»­å‘ä¸‹æ·±ç©¶<code>RX_ensure_observing(base, selector, &amp;error)</code>,å¹¶ä¸”åˆ é™¤ç”¨äºè¡Œï¼Œç•™ä¸‹æ ¸å¿ƒä»£ç </p>

<pre><code>/**
 This is the main entry point for observing messages sent to arbitrary objects.
 */
-(IMP __nullable)ensurePrepared:(id __nonnull)target forObserving:(SEL __nonnull)selector error:(NSErrorParam)error {
    Method instanceMethod = class_getInstanceMethod([target class], selector); //æ ¹æ®target sel è·å–method

        Class __nullable swizzlingImplementorClass = [self prepareTargetClassForObserving:target error:error];
        if (swizzlingImplementorClass == nil) {
            return nil;
        }

        NSString *methodEncoding = RX_method_encoding(instanceMethod);
        RXInterceptWithOptimizedObserver optimizedIntercept = optimizedObserversByMethodEncoding[methodEncoding];

        if (!RX_method_has_supported_return_type(instanceMethod)) {
            RX_THROW_ERROR([NSError errorWithDomain:RXObjCRuntimeErrorDomain
                                               code:RXObjCRuntimeErrorObservingMessagesWithUnsupportedReturnType
                                           userInfo:nil], nil);
        }

        // optimized interception method
        if (optimizedIntercept != nil) {
            IMP interceptorIMPForSelector = [self interceptorImplementationForSelector:selector forClass:swizzlingImplementorClass];
            if (interceptorIMPForSelector != nil) {
                return interceptorIMPForSelector;
            }

            if (!optimizedIntercept(self, swizzlingImplementorClass, selector, error)) {
                return nil;
            }

            interceptorIMPForSelector = [self interceptorImplementationForSelector:selector forClass:swizzlingImplementorClass];
            if (interceptorIMPForSelector != nil) {
                return interceptorIMPForSelector;
            }
        }
        // default fallback to observing by forwarding messages
        else {
            if ([self forwardingSelector:selector forClass:swizzlingImplementorClass]) {
                return RX_default_target_implementation();
            }

            if (![self observeByForwardingMessages:swizzlingImplementorClass
                                          selector:selector
                                            target:target
                                             error:error]) {
                return nil;
            }

            if ([self forwardingSelector:selector forClass:swizzlingImplementorClass]) {
                return RX_default_target_implementation();
            }
        }
    

    RX_THROW_ERROR([NSError errorWithDomain:RXObjCRuntimeErrorDomain
                                       code:RXObjCRuntimeErrorUnknown
                                   userInfo:nil], nil);
}

</code></pre>

<p>é‚£å®é™…æ˜¯å¦‚ä½• fake å‡ºä¸€ä¸ªæ–°çš„æ´¾ç”Ÿç±»æ¥å–ä»£åŸæ¥çš„ class å‘¢ï¼Ÿ</p>

<pre><code>-(Class __nullable)prepareTargetClassForObserving:(id __nonnull)target error:(NSErrorParam)error
</code></pre>

<p>è¿™ä¸ªæ–¹æ³•åšäº†ä»¥ä¸‹å‡ ä»¶äº‹<br/>
1.å¦‚æœå·²ç»æœ‰äº†å¯¹åº”çš„æ´¾ç”Ÿç±»ï¼Œ åˆ™ç›´æ¥è¿”å›ï¼ˆé€šè¿‡å…³è”å€¼è¿›è¡Œå…³è”ï¼‰<br/>
2.å¦‚æœ class æ–¹æ³•ä¸ object_getClass è·å–çš„ç±»å‹ä¸ä¸€æ ·ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º KVOï¼Œè‹¥ä¸æ˜¯ï¼Œé»˜è®¤æ— æ³•å¤„ç†ï¼Œè¿”å›é”™è¯¯ã€‚<br/>
3.ç”Ÿæˆæœ€ç»ˆçš„ fakeClassï¼Œ å¹¶ä¸å…³è”ç±»å‹è¿›è¡Œç»‘å®šã€‚</p>

<p>å…¶ä¸­ï¼Œè¿™ä¸ª fakeClass å°±ç±»ä¼¼äºKVOæœºåˆ¶ä¸­çš„ <code>NSKVONotifying_ç±»å</code>. éƒ½æ˜¯èµ·åˆ°ä¸€ä¸ªæ›¿æ¢çš„ä½œç”¨ï¼Œè®©å®é™…æ–¹æ³•æ‰§è¡Œçš„ selector è¢«é‡å†™ï¼Œæ‰§è¡Œçš„èµ·å§‹ä»¥åŠç»“å°¾åˆ†åˆ«åŠ å…¥è§¦å‘ã€‚<br/>
é‚£è¯´åˆ°åº•ï¼Œè¿˜æ˜¯æ²¡æœ‰è¯´ï¼Œå…·ä½“è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨ç»†èŠ‚ä¸Šæ˜¯å¦‚ä½•æ’å…¥å¯¹åº”çš„èŠ‚ç‚¹çš„(æ‚è„¸)ã€‚<br/>
æœ‰å…³äº fakeClass çš„å…·ä½“å®ç°è¿‡ç¨‹ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è¿›è¡Œè¯¦ç»†çš„æè¿°ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KVOä»£ç æµ‹è¯•ä»¥åŠæ¢ç©¶]]></title>
    <link href="iginkgo.cn/15360544284777.html"/>
    <updated>2018-09-04T17:47:08+08:00</updated>
    <id>iginkgo.cn/15360544284777.html</id>
    <content type="html"><![CDATA[
<p>ä¹‹å‰å¯¹äº KVO çš„å®ç°ï¼Œéƒ½ä»…ä»…é™äºä¿®æ”¹äº†å¯¹åº”å±æ€§çš„ <code>set</code> æ–¹æ³•çš„å®ç°ï¼Œä½¿å¾—åœ¨è¯¥æ–¹æ³•ä½¿ç”¨å‰ä¸ä½¿ç”¨ååˆ†åˆ«è§¦å‘ä¸åŒçš„æ–¹æ³•ã€‚ç°åœ¨ä½œè€…æƒ³ä»”ç»†çš„çœ‹ä¸€ä¸‹å…·ä½“çš„ç»†èŠ‚ã€‚</p>

<span id="more"></span><!-- more -->

<h2 id="toc_0">æ‰“å°ä¸€ä¸‹åŸºæœ¬ä¿¡æ¯</h2>

<p>è¯´æ˜¯å®ç°çš„å¯¹æ–¹æ³•çš„æ›¿æ¢ï¼Œé‚£å®é™…ä¸Šæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p>

<pre><code>Person *person1 = [[Person alloc] init];
    Person *person2 = [[Person alloc] init];
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿå‰ä¸¤ä¸ªå¯¹è±¡çš„å®ä¾‹ %@, %@ &quot;, person1, person2); //æ‰“å°å®ä¾‹çš„åœ°å€
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿå‰ä¸¤ä¸ªå¯¹è±¡çš„ç±» %@, %@ &quot;, [person1 class], [person2 class]); //ä½¿ç”¨classæ–¹æ³•è·å–ç±»
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿå‰ï¼Œä¸¤ä¸ªå¯¹è±¡çš„ç±» objc_getClass:%@, %@&quot;, object_getClass(person1), object_getClass(person2));//ä½¿ç”¨objc_getClass è·å–ç±»
    
    [person1 addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:NULL];
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿåä¸¤ä¸ªå¯¹è±¡çš„å®ä¾‹ %@, %@ &quot;, person1, person2);
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿåä¸¤ä¸ªå¯¹è±¡çš„ç±» %@, %@ &quot;, [person1 class], [person2 class]);
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿåä¸¤ä¸ªå¯¹è±¡çš„ç±» objc_getClass:%@, %@&quot;, object_getClass(person1), object_getClass(person2));
</code></pre>

<p>è¾“å…¥çš„ç»“æœï¼š<br/>
<img src="media/15360544284777/15360571965777.jpg" alt=""/></p>

<p>ç”±ä»¥ä¸Šçš„ç»“è®ºå¯ä»¥çŸ¥é“å‡ ä»¶äº‹æƒ…ï¼š<br/>
1.æ·»åŠ KVOä¹‹åï¼Œå®ä¾‹å¯¹è±¡çš„åœ°å€å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜<br/>
2.æ·»åŠ KVOä¹‹åï¼Œ <code>[instance class]</code> è·å–å…ƒç±»ä¾æ—§æŒ‡å‘ personï¼Œ ä½†æ˜¯<code>object_getClass(instance)</code> æ¥è·å–å…ƒç±»åˆ™æ˜¯ NSKVONotifying_Personã€‚å…¶ä¸­ <code>class</code> æ–¹æ³•æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªå‡çš„ç»“æœã€‚<code>object_getClass</code> è¿”å›çš„æ‰æ˜¯ä¸€ä¸ªçœŸæ­£çš„ç±»å‹ã€‚</p>

<h2 id="toc_1">æ‰“å°ä¸€ä¸‹å…·ä½“çš„IMP</h2>

<p>é‚£æ—¢ç„¶å·²ç»çŸ¥é“KVOæœºåˆ¶æœ¬èº«æ˜¯ä¿®æ”¹äº†è§‚å¯Ÿå…ƒç´ çš„IMPï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„å®ç°ï¼Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹å…·ä½“çš„IMPç©¶ç«Ÿæ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼š</p>

<pre><code>    Person *person1 = [[Person alloc] init];
    Person *person2 = [[Person alloc] init];

    SEL sel = @selector(setName:);
    
    IMP imp1 = [person1 methodForSelector:sel];
    IMP imp2 = [person2 methodForSelector:sel];
    
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿå‰çš„çš„Impåˆ†åˆ«æ˜¯ person1: %p, person2: %p&quot;, imp1, imp2);
    
    [person1 addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:NULL];
    
    imp1 = [person1 methodForSelector:sel];
    imp2 = [person2 methodForSelector:sel];
    
    NSLog(@&quot;æ·»åŠ è§‚å¯Ÿåçš„Impåˆ†åˆ«æ˜¯ person1: %p, person2: %p&quot;, imp1, imp2);
</code></pre>

<p>æœ€åçš„è¾“å‡ºï¼š<br/>
<img src="media/15360544284777/15360602518137.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œperson1 åœ¨å±æ€§ name æ·»åŠ äº† KVO ä¹‹åï¼Œå…¶ set æ–¹æ³•çš„ IMP å‘ç”Ÿäº†å˜åŒ–ã€‚<br/>
ç»“è®ºï¼š å¯¹äºå±æ€§æ·»åŠ KVOæ–¹æ³•åï¼Œ å…¶å…·ä½“çš„å®ç°ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>

<h2 id="toc_2">ç»§ç»­æ¢ç©¶ä¸€ä¸‹ï¼ŒIMP å‘ç”Ÿäº†å“ªäº›å˜åŒ–</h2>

<p>åœ¨ä¸Šæ–¹ä»£ç æ®µçš„ç»“å°¾å¤„æ·»åŠ äº†æ–­ç‚¹ï¼Œè¿›è¡Œè¾“å‡ºæ‰“å°:<br/>
<img src="media/15360544284777/15360604856835.jpg" alt=""/></p>

<p>ç»“è®ºï¼š<br/>
æ·»åŠ  KVO åï¼Œå±æ€§çš„setæ–¹æ³•å˜ä¸º <code>_NSSetObjectValueAndNotify</code> æ–¹æ³•ã€‚<br/>
è€Œæœªæ·»åŠ KVOçš„å±æ€§çš„setæ–¹æ³•ä¾æ—§æ˜¯ <code>setName:</code>.</p>

<h2 id="toc_3">NSKVONotifying_Person ä¸ Person çš„å…³ç³»</h2>

<p>ä»ä¸Šé¢å¾—åˆ°çš„ç»“è®ºæ˜¯ï¼Œperson çš„å®ä¾‹å±æ€§åœ¨æ·»åŠ äº† KVO åï¼Œå…¶å…ƒç±»å‹å˜ä¸º <code>NSKVONotifying_Person</code>,é‚£ä¹ˆå½“å‰è¿™ä¸¤ä¸ªç±»åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ<br/>
åœ¨ä»£ç æ®µçš„æœ€åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>

<pre><code>    NSLog(@&quot;%@ çš„çˆ¶ç±»å‹ä¸º %@&quot;, object_getClass(person1), class_getSuperclass(object_getClass(person1)));
    NSLog(@&quot;%@ çš„çˆ¶ç±»å‹ä¸º %@&quot;, object_getClass(person2), class_getSuperclass(object_getClass(person2)));
</code></pre>

<p>æ‰“å°åçš„ç»“æœè¡¨ç¤ºï¼š<br/>
 â€¨<img src="media/15360544284777/15360609310566.jpg" alt=""/></p>

<p>ç»“è®ºï¼šæ·»åŠ KVOåæ–°ç”Ÿæˆçš„ NSKVONotifying_Person ä¸º person çš„æ´¾ç”Ÿç±»ã€‚<br/>
é‚£ä¹ˆæœ€ç»ˆç”Ÿæˆè¿™ä¸ªæ–°çš„æ´¾ç”Ÿç±»ä¸åŸæ¥çš„Personåˆæœ‰ä»€ä¹ˆä¸ä¸€æ ·å‘¢ï¼Ÿ<br/>
åœ¨ä»£ç æ®µæœ€åæ·»åŠ ï¼š</p>

<pre><code>    NSString *list1 = [self printPersonMethods:object_getClass(person1)];
    NSString *list2 = [self printPersonMethods:object_getClass(person2)];
    NSLog(@&quot;%@&quot;, list1);
    NSLog(@&quot;%@&quot;, list2);
</code></pre>

<p><img src="media/15360544284777/15360665467454.jpg" alt=""/></p>

<p>æœ€ç»ˆè¾“å‡ºçš„ç»“æœæ˜¯ï¼š<br/>
<img src="media/15360544284777/15360666460967.jpg" alt=""/><br/>
å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ´¾ç”Ÿç±»ä¸­ <code>NSKVONotifying_Person</code> å¤šäº†å‡ ä¸ªæ–¹æ³•ã€‚å…¶å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ª <code>setNameï¼š</code> çš„æ–¹æ³•ï¼Œåº”è¯¥æ˜¯é‡å†™äº†å…¶çˆ¶ç±» <code>Person</code> ä¸­çš„ <code>setNameï¼š</code>æ–¹æ³•ã€‚<br/>
é‡å†™äº† <code>dealloc</code> æ˜¯ä¸ºäº†åšä¸€äº› KVO ç›¸å…³çš„å†…å­˜é‡Šæ”¾çš„æ“ä½œã€‚<br/>
é‡å†™ <code>class</code> æ–¹æ³•æ˜¯éšè—äº† NSKVONotifying_Person è¿™ä¸ªç±»çš„å­˜åœ¨ã€‚è®©å¤–ç•Œä»¥ä¸ºä¾ç„¶æ˜¯ Person ç›¸å…³çš„ç±»ã€‚</p>

<h2 id="toc_4">KVOæ·»åŠ ä»¥åŠå–æ¶ˆæ—¶çš„ isa æŒ‡é’ˆ</h2>

<pre><code>   Person *person = [[Person alloc] init];
    [person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew|
    NSKeyValueObservingOptionOld  context:NULL];
    NSLog(@&quot;person-&gt;isa:%@&quot;,object_getClass(person));
    NSLog(@&quot;person class:%@&quot;,[person class]);
</code></pre>

<p><img src="media/15356370719300/15356412308181.jpg" alt=""/></p>

<p>é‚£ä¹ˆæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œclass æ–¹æ³•å’Œ object_getclass æ–¹æ³•éƒ½åº”è¯¥æ˜¯è·å–å…ƒç±»çš„æ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼Ÿä¸ºä»€ä¹ˆè·å–çš„ç»“æœä¸ä¸€æ ·å‘¢ï¼Ÿ<br/>
class æœ¬èº«ä¹Ÿæ˜¯è·å–å®ä¾‹å…ƒç±»å‹çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å®ç°æ—¶ KVO æ—¶ï¼Œclassçš„æ–¹æ³•è¢«æ´¾ç”Ÿç±»é‡å†™æ”¹å†™ï¼Œ å› æ­¤çœ‹åˆ°çš„ä¼šä¾æ—§æŒ‡å‘åŸç”Ÿçš„ç±»ã€‚</p>

<p><strong>å–æ¶ˆKVOä¹‹å</strong>ï¼Œçœ‹ä¸€ä¸‹æœ€ç»ˆæ•ˆæœ</p>

<pre><code>  [person removeObserver:self forKeyPath:@&quot;name&quot;];
    NSLog(@&quot;person-&gt;isa:%@&quot;,object_getClass(person));
    NSLog(@&quot;person class:%@&quot;,[person class]);
</code></pre>

<p><img src="media/15356370719300/15356414025816.jpg" alt=""/><br/>
æ­¤æ—¶å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºçš„ç»“æœä¸­ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½å˜æˆäº†personã€‚</p>

<h2 id="toc_5">åˆ†ç±»ä¸­æ–°æ·»å±æ€§çš„ KVO</h2>

<p>é€šå¸¸ï¼Œå¦‚æœå¸Œæœ›åœ¨Categoryä¸­æ·»åŠ å±æ€§æ—¶ï¼Œ ä¼šä½¿ç”¨åŸºäº Runtime çš„å…³è”å€¼çš„æ–¹å¼è¿›è¡Œå®ç°ã€‚ä½¿ç”¨<code>objc_getAssociatedObject</code> , <code>objc_setAssociatedObject</code> è¿™ä¸¤ä¸ªæ–¹å¼æ¥å®ç° get å’Œ set æ–¹æ³•ã€‚<br/>
é‚£ä¹ˆå¯¹äºè¿™ç§æƒ…å†µå®ç°çš„å±æ€§ï¼Œåœ¨è¿›è¡ŒKVOæ—¶ï¼Œèƒ½å¦æ­£å¸¸çš„è·å–å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚</p>

<pre><code>@implementation Person (Category)
static char *CloudoxKey = &quot;CloudoxKey&quot;;

-(void)setCloudox:(NSString *)cloudox{
    objc_setAssociatedObject(self, CloudoxKey, cloudox, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

-(NSString *)cloudox{
    return objc_getAssociatedObject(self, CloudoxKey);
}
@end
</code></pre>

<pre><code>//åœ¨è°ƒç”¨çš„viewControllerä¸­

  [person addObserver:self forKeyPath:@&quot;CloudoxKey&quot; options:NSKeyValueObservingOptionNew|
    NSKeyValueObservingOptionOld context:NULL];
    person.cloudox = @&quot;11&quot;;
    person.cloudox = @&quot;22&quot;;
</code></pre>

<pre><code>//è¾“å‡ºä»£ç 
- (void) observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context {
    if([keyPath isEqualToString:@&quot;CloudoxKey&quot;] || [keyPath isEqualToString:@&quot;age&quot;] ){
        NSLog(@&quot;\\noldnum:%@ newnum:%@&quot;,
              [change valueForKey:@&quot;old&quot;],
              [change valueForKey:@&quot;new&quot;]);
    }   
}
</code></pre>

<h2 id="toc_6">æ€»ç»“</h2>

<ol>
<li>iOSä¸­çš„ KVO æ˜¯æ˜¯åŸºäº runtime çš„ã€‚</li>
<li>æŸä¸ªç±»çš„å±æ€§é¦–æ¬¡æ·»åŠ  KVO åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ´¾ç”Ÿç±» <code>NSKVONotifying_ç±»å</code>ã€‚åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™è¢«è§‚å¯Ÿçš„å±æ€§çš„ set æ–¹æ³•ï¼Œä»¥æ­¤æ¥å®ç°çœŸæ­£çš„é€šçŸ¥ã€‚æ–°çš„ç±»ä¹Ÿé‡å†™çš„é”€æ¯ä»¥åŠ class æ–¹æ³•ï¼Œç”¨äºæ©æŠ¤æ´¾ç”Ÿç±»çš„å­˜åœ¨ã€‚</li>
<li>å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«è§‚å¯Ÿåï¼Œè¯¥å¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆä¼šæŒ‡å‘æ–°ç”Ÿæˆçš„æ´¾ç”Ÿç±»ã€‚ä»è€Œç¡®ä¿è¢«ç›‘æ§çš„å±æ€§å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè°ƒç”¨çš„æ˜¯æ´¾ç”Ÿç±»çš„ set æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨å…³è”å€¼çš„æ–¹æ³•åœ¨åˆ†ç±»ä¸­å®ç°å±æ€§ï¼Œåœ¨èµ‹å€¼æ—¶æ˜¯å¯ä»¥è§¦å‘ KVO çš„ã€‚</li>
</ol>

<h2 id="toc_7">å‚è€ƒæ–‡æ¡£</h2>

<p><a href="https://www.jianshu.com/p/0aa83ac521ba">https://www.jianshu.com/p/0aa83ac521ba</a><br/>
<a href="https://www.jianshu.com/p/dc89f0a2d1ac">https://www.jianshu.com/p/dc89f0a2d1ac</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è®º UITableView çš„ dequeueReusableCell æ–¹æ³•]]></title>
    <link href="iginkgo.cn/15350236247070.html"/>
    <updated>2018-08-23T19:27:04+08:00</updated>
    <id>iginkgo.cn/15350236247070.html</id>
    <content type="html"><![CDATA[
<p>ç”±ä¸€ä¸ªé¡¹ç›®ä¸­çš„é—®é¢˜æƒ³åˆ°çš„ã€‚</p>

<span id="more"></span><!-- more -->

<p>ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°è®¨è®ºè¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä»¥å‰åœ¨ä½¿ç”¨UITableViewçš„æ—¶å€™ï¼Œä¹Ÿæ›¾æœ‰è¿‡ç–‘é—®ï¼Œé‚£å°±æ˜¯åŒæ ·æ˜¯åœ¨tableViewçš„ç¼“å­˜ä¸­è·å–cellï¼Œä¸‹é¢çš„ä¸¤ä¸ªæ–¹æ³•ç©¶ç«Ÿæœ‰ä½•ä¸åŒ</p>

<pre><code>func dequeueReusableCell(withIdentifier: String, for: IndexPath) -&gt; UITableViewCell

func dequeueReusableCell(withIdentifier identifier: String) -&gt; UITableViewCell?
</code></pre>

<p>æ ¹æ®å®˜ç½‘<a href="https://developer.apple.com/documentation/uikit/uitableview/1614878-dequeuereusablecell">æœ‰IndexPath</a>ä»¥åŠ<a href="https://developer.apple.com/documentation/uikit/uitableview/1614891-dequeuereusablecell">æ— IndexPath</a>ä¸Šçš„è¯´æ³•ï¼Œ<br/>
 ä¸¤è€…çš„ä»‹ç»éå¸¸çš„ç›¸ä¼¼ï¼Œä¸€ä¸ª tableView é€šå¸¸ä¼šç»´æŒä¸€ä¸ªé˜Ÿåˆ—çš„ cellï¼Œç”¨ä»¥ç»™dataSourceå¤ç”¨ã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°±æ˜¯è¦æ±‚ tableView è¿”å›ä¸€ä¸ªæ–°çš„ cellã€‚å¦‚æœé˜Ÿåˆ—ä¸­æœ‰ç°æˆçš„ cellï¼Œé‚£å¯ä»¥ç›´æ¥æ‹¿å‡ºæ¥å¤ç”¨ã€‚å¦‚æœæ²¡æœ‰ç°æˆçš„ cellï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œçš„ nib file æˆ–è€…æ˜¯ class é‡æ–°åˆ›å»ºã€‚<br/>
 å¦‚æœæ˜¯é€šè¿‡æ³¨å†Œçš„classè¿›è¡Œåˆ›å»ºï¼Œåˆ™éœ€è¦è°ƒç”¨æ–¹æ³• <code>init(style: reuseIdentifier:)</code> æ–¹æ³•è¿›è¡Œåˆ›å»ºã€‚å¯¹äºåŸºäº nib çš„ classï¼Œåˆ™æ˜¯ç›´æ¥é€šè¿‡nibæ–‡ä»¶è¿›è¡Œåˆ›å»ºã€‚å¦‚æœå­˜åœ¨å¯ä»¥ç›´æ¥å¤ç”¨çš„cellï¼Œåˆ™ä¼šè°ƒç”¨cellçš„ <code>prepareForReuse()</code> æ–¹æ³•ã€‚</p>

<p>é‚£ä¹ˆçœ‹èµ·æ¥ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä»…ä»…æœ‰ä¸¤ç‚¹ä¸ä¸€æ ·</p>

<table>
<thead>
<tr>
<th style="text-align: center">dequeueReusableCell(withIdentifier: String, for: IndexPath)</th>
<th style="text-align: center">dequeueReusableCell(withIdentifier: String)</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">ä¸èƒ½è¿”å›nil</td>
<td style="text-align: center">å¯ä»¥è¿”å›nil</td>
</tr>
<tr>
<td style="text-align: center">æœ‰indexPathå‚æ•°</td>
<td style="text-align: center">æ²¡æœ‰indexPathå‚æ•°</td>
</tr>
</tbody>
</table>

<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼Œé€šå¸¸ä¼šæœ‰è€ä¸€äº›çš„è¯´æ³•ï¼Œè¯´æ˜¯åœ¨æœ‰ indexPath çš„æ–¹æ³•ä¸­ï¼Œå¦‚æœå·²ç»å¯¹è¯¥ cell è¿›è¡Œäº†æ³¨å†Œï¼Œåˆ™è‚¯å®šä¼šè¿”å›ä¸€ä¸ªå¯¹åº”ç±»å‹çš„cellã€‚ è€Œå¦å¤–ä¸€ä¸ªæ²¡æœ‰ indexPath çš„æ–¹æ³•ä¸­ï¼Œåˆ™ä¸ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œéœ€è¦ç”¨æˆ·è¿›è¡Œæ‰‹åŠ¨åˆ›å»ºã€‚<br/>
åœ¨æœ€æ–°çš„æ–‡æ¡£ä¸­ï¼Œä¸¤ä¸ªæ–¹æ³•çš„è¯´æ˜éƒ½åˆ†åˆ«è¯´æ˜ï¼Œåªæœ‰å¯¹äº cell è¿›è¡Œäº†æ³¨å†Œï¼Œåˆ™æ— è®ºå“ªä¸ª dequeue çš„æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªå¯¹åº”çš„ cellã€‚</p>

<p>é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œä½œè€…å°±ä¼šæœ‰ä¸€ä¸ªç–‘é—®äº†ï¼ŒindexPath èµ·åˆ°äº†ä¸€ä¸ªä»€ä¹ˆæ ·çš„ä½œç”¨å‘¢ï¼Ÿ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æœ€è¿‘ä½œè€…åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚</p>

<h2 id="toc_0">é—®é¢˜</h2>

<h3 id="toc_1">é—®é¢˜ä»£ç </h3>

<p>é—®é¢˜çš„èƒŒæ™¯æ˜¯ä¸€ä¸ªç«–ç›´æ–¹å‘çš„ UITableViewï¼Œ å…¶ä¸­ä¸€ç§ cell åŒ…è£¹å¯ä»¥æ°´å¹³æ»‘åŠ¨çš„UICollectionViewã€‚<br/>
å•¥ä¹Ÿä¸è¯´ï¼Œä¸Šä»£ç ã€‚</p>

<pre><code> public func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {
    guard let cell = tableView.dequeueReusableCell(withIdentifier:  FocusRecommentMediaTableViewCell.cellId, for: indexPath) as?    FocusRecommentMediaTableViewCell else {
        return FocusRecommentMediaTableViewCell()
    }
    cell.collectionView.dataSource = self
    
    //è¿˜æœ‰å¯èƒ½æ˜¯å…¶ä»–ç±»å‹çš„cell
    return cell
</code></pre>

<p>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„äº†è§£åˆ°ï¼Œå½“å‰æ˜¯ä¸€ä¸ª tableView çš„è¿”å› cell çš„æ–¹æ³•ã€‚è¿™ä¸ª UITableViewCell ä¸­åˆåµŒå¥—äº†ä¸€ä¸ª UICollectionViewã€‚<br/>
éœ€è¦æä¸€ç‚¹çš„æ˜¯ï¼Œæˆ‘åœ¨å¯¹åº”çš„ UITableViewCell çš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹å…¶æŒæœ‰ UICollectionView çš„ dataSource è¿›è¡Œèµ‹å€¼ã€‚å³åˆå§‹åŒ–æ—¶ <code>collectionView.dataSource == nil</code>ã€‚</p>

<h3 id="toc_2">æ„å¤–</h3>

<p>é¡¹ç›®ä¸­é€šå¸¸è·‘çš„éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç›´åˆ°æµ‹è¯•åˆ°æŸä¸€ä¸ªæ‰‹æœº iphone6, iOS9.3<br/>
æ­¤æ—¶ï¼Œåœ¨<code>ç¼“æ…¢å‘ä¸‹æ»‘åŠ¨çš„æƒ…å†µä¸‹</code>ï¼Œç³»ç»Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚<br/>
åœ¨ç”¨æˆ·å¿«é€Ÿå‘ä¸‹æ»‘åŠ¨ï¼Œå³å°†å‡ºç°æ­¤ç±» cell æ—¶ï¼Œä¼šå‡ºç°å´©æºƒã€‚</p>

<p>é—®é¢˜æè¿°ï¼š <code>UICollectionView dataSource is not set</code>.<br/>
åœ¨æ·»åŠ äº†Exception æ•è·åï¼Œå¾—åˆ°ä»¥ä¸‹æç¤º:</p>

<pre><code>*** Assertion failure in -[CollectionView _createPreparedSupplementaryViewForElementOfKind:atIndexPath:withLayoutAttributes:applyAttributes:], /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit_Sim/UIKit-3512.60.7/UICollectionView.m:1599
</code></pre>

<p>ä½œè€…æœ‰å¯¹æ›´é«˜çº§çš„iOSç³»ç»Ÿè¿›è¡Œäº†æµ‹è¯•ï¼Œå‘ç°å®Œå…¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚<br/>
é‚£æ—¢ç„¶æç¤ºï¼ŒDataSourceæ²¡æœ‰è¿›è¡Œè®¾ç½®ï¼Œå¯èƒ½æ˜¯è°ƒç”¨æ—¶æœºçš„é—®é¢˜ï¼Œå› æ­¤ï¼Œæ¯”è¾ƒç²—åŠ£çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨UITableViewè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶å¯¹UICollectionViewè¿›è¡Œé…ç½®æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªä¸´æ—¶çš„dataSourceã€‚<br/>
ä½†æ˜¯è¿™ä¸ªè§£å†³æ–¹æ¡ˆä»ç„¶ä¸èƒ½è§£å†³æˆ‘çš„ç–‘æƒ‘ï¼Œç»è¿‡è¿›ä¸€æ­¥çš„å®šä½ï¼Œå‘ç°å´©æºƒçš„å…·ä½“ä½ç½®:</p>

<pre><code> guard let cell = tableView.dequeueReusableCell(withIdentifier:  FocusRecommentMediaTableViewCell.cellId, for: indexPath) as?    FocusRecommentMediaTableViewCell else {
        return FocusRecommentMediaTableViewCell()
    }
</code></pre>

<p>å³åœ¨è°ƒç”¨<code>tableView.dequeueReusableCell(withIdentifier: for:)</code>æ–¹æ³•æ—¶å‘ç”Ÿäº†å´©æºƒã€‚åœ¨è¿™ä¸ªæ—¶å€™ï¼ŒUITableViewCellè¿˜æ²¡æœ‰è¿”å›ç»™cellï¼Œ UICollectionViewè¿˜æ²¡æœ‰è®¾ç½®dataSourceã€‚è®©æˆ‘å¥½å¥‡çš„æ˜¯ï¼Œè¿™ä¸ªæ—¶æœºåº”è¯¥æ˜¯UICollectionViewåœ¨è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>æ²¡æœ‰è¿›è¡Œreloadæ“ä½œ</code>,ä¸ºä½•ä¼šè°ƒç”¨åˆ°dataSourceï¼Œè€Œåœ¨iOS9ä»¥ååˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚è€Œä¸”å¿…é¡»æ˜¯å¿«é€Ÿæ»‘åŠ¨çš„æƒ…å†µæ‰ä¼šå‘ç”Ÿã€‚</p>

<p>è¿™ä¸ªæ—¶å€™å¤§å®¶å°±ä¼šé—®äº†ï¼Œä¸Šé¢ç£¨ç£¨å”§å”§è¯´äº†åŠå¤©çš„ä¸ºé¢˜ï¼Œè·Ÿè¿™æ¬¡çš„é¢˜ç›®æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ<br/>
æ˜¯çš„ï¼Œå°†ä¸Šé¢çš„æ–¹æ³•æ¢æˆ<code>tableView.dequeueReusableCell(withIdentifier:)</code>,ä¹Ÿå°±æ˜¯å»é™¤æ‰indexPathè¿™ä¸ªå‚æ•°ä»¥åï¼Œå°±å®Œå…¨ä¸ä¼šå‡ºç°ä¸Šé¢çš„é—®é¢˜äº†ã€‚</p>

<p>é‚£ä¹ˆå…³é”®çš„é—®é¢˜æ¥äº†ï¼Œå¯¹äºæ­¤å¤„éå¸¸é‡è¦çš„ä¸€ä¸ªå‚æ•° indexPathï¼Œ å®ƒåœ¨æ­¤å¤„èµ·äº†ä¸€ä¸ªä»€ä¹ˆæ ·çš„ä½œç”¨ï¼Ÿ</p>

<p>åœ¨developer.appleçš„æ–‡æ¡£é‡Œï¼Œ æœ‰ä¸€å¥ä¸€ç¬”å¸¦è¿‡çš„è¯´æ˜</p>

<blockquote>
<p>This method uses the index path to perform additional configuration based on the cellâ€™s position in the table view.</p>
</blockquote>

<p>è¯´çš„æ˜¯<code>func dequeueReusableCell(withIdentifier identifier: String, <br/>
                     for indexPath: IndexPath) -&gt; UITableViewCell</code>è¿™ä¸ªæ–¹æ³•ä¼šä½¿ç”¨indexPathæ¥è¿›è¡Œä¸€äº›åŸºäºcellä½ç½®çš„é¢å¤–é…ç½®ã€‚é‚£è¿™æ˜¯é…ç½®æ˜¯ä»€ä¹ˆå‘¢?<br/>
æˆ‘è¿˜è¦çœ‹çœ‹ï¼<br/>
to be continued...</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é‡æ„Massive AppDelegate]]></title>
    <link href="iginkgo.cn/15348619116019.html"/>
    <updated>2018-08-21T22:31:51+08:00</updated>
    <id>iginkgo.cn/15348619116019.html</id>
    <content type="html"><![CDATA[
<p>æœ¬æ–‡æ˜¯ç¿»è¯‘è‡ªå¢™å¤–çš„ä¸€ç‰‡<a href="http://www.vadimbulavin.com/refactoring-massive-app-delegate/">æ–‡ç« </a>ã€‚æ–‡ç« é€šè¿‡åˆ†æiOSé¡¹ç›®ä¸­ <code>AppDelegate</code> ä¸­å¸¸è´Ÿæ‹…çš„èŒèƒ½ï¼Œå¹¶å°†å…¶åˆ†ä¸ºä¸‰ç±»ï¼Œé€šè¿‡å¼•å…¥ä¸åŒçš„è®¾è®¡æ¨¡å¼å°†ä»£ç è¿›è¡ŒæŠ½ç¦»æ•´åˆï¼Œæœ€ç»ˆè¾¾åˆ°å•ä¸€èŒèƒ½ã€å¯é‡ç”¨ã€æ˜“æµ‹è¯•çš„ç‰¹ç‚¹ã€‚<br/>
è¯‘è€…ä¹Ÿåœ¨æ–‡ç« çš„å½±å“ä¸‹ï¼Œå¯¹å½“å‰è¿›è¡Œçš„é¡¹ç›®è¿›è¡Œäº†ç›¸åº”çš„å…¼å®¹å’Œå®ç°ï¼Œæœ€ç»ˆæ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚</p>

<span id="more"></span><!-- more -->

<ul>
<li>
<a href="#toc_0">å¼€å§‹</a>
</li>
<li>
<a href="#toc_1">é—®é¢˜</a>
</li>
<li>
<a href="#toc_2">è§£å†³æ–¹æ¡ˆ</a>
<ul>
<li>
<a href="#toc_3">å‘½ä»¤æ¨¡å¼</a>
</li>
<li>
<a href="#toc_4">ç»„åˆæ¨¡å¼</a>
</li>
<li>
<a href="#toc_5">ä¸­ä»‹è€…æ¨¡å¼</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">æ€»ç»“</a>
</li>
</ul>


<h2 id="toc_0">å¼€å§‹</h2>

<p>AppDetelgate è¿æ¥äº†ä½ çš„ App ä¸ç³»ç»Ÿã€‚é€šå¸¸å®ƒéƒ½æ˜¯æ•´ä¸ª iOS é¡¹ç›®çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚é€šå¸¸ï¼Œä¼´éšç€ä¸æ–­çš„å¼€å‘ï¼Œæ–°ç‰¹æ€§ä¸åŠŸèƒ½çš„å¢åŠ ï¼ŒAppDelegate æœ€ç»ˆå˜æˆå¾ˆé›¶ç¢çš„ä¸œè¥¿ã€‚</p>

<p>é€šå¸¸æŠŠæ‰€æœ‰çš„ä»£ç éƒ½åŠ å…¥ AppDelegate æ˜¯ååˆ†æµªè´¹çš„ï¼Œå› ä¸ºå®ƒå®¹æ˜“å½±å“æ•´ä¸ª Appã€‚å› æ­¤ï¼Œä¿æŒè¿™ä¸ªç±»çš„å¹²å‡€ä¸æ•´æ´å¯¹äºä¸€ä¸ªå¥å£®çš„é¡¹ç›®æ˜¯éå¸¸é‡è¦çš„ã€‚<br/>
æœ¬æ–‡æ¢è®¨äº†è®©AppDelegateå˜å¾—ç®€æ´ã€å¯æµ‹ã€å¯é‡ç”¨çš„å‡ ç‚¹å»ºè®®ã€‚</p>

<h2 id="toc_1">é—®é¢˜</h2>

<p>AppDelegate æ˜¯æ•´ä¸ª App æœ€æ ¹æœ¬çš„åœ°æ–¹ã€‚è´Ÿè´£ä¸ç³»ç»ŸåŠå…¶å®ƒçš„ App ç›´æ¥æ‰“äº¤é“ã€‚è¿™ä½¿å¾—AppDelegateæœ‰éå¸¸å¤šçš„ä»»åŠ¡ï¼Œ å¹¶ä¸”å¾ˆéš¾è¿›è¡Œä¿®æ”¹ä»¥åŠæ‰©å±•ã€‚</p>

<p><a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate">è‹¹æœå®˜æ–¹</a>æ”¯æŒè‡³å°‘è¦åœ¨AppDelegateä¸­è¡Œä½¿3ç§èŒèƒ½ã€‚</p>

<p>é€šè¿‡è°ƒæŸ¥å¤§é‡çš„å¼€æºçš„Appï¼Œæˆ‘æ€»ç»“äº†é€šå¸¸AppDelegateä¼šè¡Œä½¿çš„èŒèƒ½ï¼š<br/>
1. åˆå§‹åŒ–å¤§é‡çš„ç¬¬ä¸‰æ–¹åº“<br/>
2. åˆå§‹åŒ– Core Data stack ä»¥åŠç®¡ç†è¿ç§»<br/>
3. é…ç½® App çš„ Stateï¼Œç”¨äºè®¾ç½®å•å…ƒæµ‹è¯•ä»¥åŠUIæµ‹è¯•<br/>
4. ç®¡ç†æ¨é€ï¼Œæœ¬åœ°æ¨é€æˆ–è€…è¿œç¨‹æ¨é€<br/>
5. é…ç½® UIAppearance<br/>
6. ç®¡ç† UserDataManagerï¼šé…ç½®åˆæ¬¡ç™»å½•æ—¶çš„ Flagï¼Œä¿å­˜ä»¥åŠåŠ è½½æ•°æ®ã€‚<br/>
7. é…ç½® App çš„è§’æ ‡<br/>
8. ç®¡ç†åå°è¿›ç¨‹<br/>
9. ç®¡ç† UI è°ƒç”¨æ ˆçš„é…ç½®ã€‚é€‰æ‹©åˆå§‹çš„ ViewController<br/>
10.æ’­æ”¾å£°éŸ³<br/>
11. å…³ç³»åˆ†ææ–‡ä»¶<br/>
12. è¾“å‡º DebugLog<br/>
13. æ§åˆ¶è½¬å‘é—®é¢˜<br/>
14. å®ç°å„ç§ä»£ç†åè®®ï¼Œå°¤å…¶æ˜¯ç¬¬ä¸‰æ–¹çš„<br/>
15. å¼¹å‡º Alert  </p>

<h2 id="toc_2">è§£å†³æ–¹æ¡ˆ</h2>

<p>æ—¢ç„¶æˆ‘ä»¬æ‰¿è®¤ä¸Šé¢è¿™äº›é—®é¢˜çš„å­˜åœ¨å¹¶ä¸”è¿™ä¹Ÿå¾ˆé‡è¦ï¼Œé‚£ä¹ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬è¦éµå®ˆé‚£äº›åŸåˆ™</p>

<p>1.ç»´æŒ<a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">å•ä¸€èŒè´£åŸåˆ™</a><br/>
2.æ˜“æ‰©å±•<br/>
3.æ˜“æµ‹è¯•</p>

<h3 id="toc_3">å‘½ä»¤æ¨¡å¼</h3>

<p>å¯¹äºæ¯ä¸€ç§AppDelegateçš„èŒèƒ½ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ‰§è¡Œç±»ï¼š</p>

<pre><code>protocol Command {
    func execute()
}

struct RegisterCommand: Command {
    func execute()
}

struct SetAppearanceCommand: Command {
    ...
}

struct InitialViewControllerCommand: Command {
 ...
} 
</code></pre>

<p>ç„¶ååˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„ç®¡ç†ç±»è¿›è¡Œç®¡ç†ï¼Œç®¡ç†ä¸Šé¢è¿™äº›commandçš„åˆ›å»ºä»¥åŠæ‰§è¡Œ</p>

<pre><code>final class StartupCommandsBuilder {
    private var window: UIWindow!
    
    func setKeyWindow(_ window: UIWindow)-&gt; StartupCommandsBuilder {
        self.window = window
        return self
    }
    
    func build()-&gt; [Command] {
        return [RegisterCommand(),
                SetAppearanceCommand(),
                InitialViewControllerCommand(window)
                ...]
    }
}
</code></pre>

<p>æœ€ç»ˆåœ¨delegateè¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œ</p>

<pre><code>    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
        StartupCommandsBuilder()
            .setKeyWindow(window!)
            .build()
            .forEach { $0.execute() }
        return true
    }

</code></pre>

<p>è¿™æ ·å°† AppDelegate ä¸»åŠ¨è°ƒç”¨çš„å·¥ä½œè¿›è¡Œäº†æ¸…æ™°çš„åˆ‡å‰²ï¼Œå¹¶ä¸”å®ç°å•ä¸€èŒèƒ½åŸåˆ™ã€‚å¤§å¤§å‡å°‘äº†å·¥ä½œå·¥ä½œé‡</p>

<p>è¿™æ ·åšå®ç°äº†ä»¥ä¸‹ä¼˜ç‚¹ï¼š<br/>
1. æ¯ä¸ª Command éƒ½å®ç°äº†1ä¸ªåŠŸèƒ½<br/>
2. ä¸æ”¹åŠ¨ AppDelegate ä»£ç å°±å¯ä»¥ç›´æ¥è¿›è¡Œæ·»åŠ <br/>
3. æ¯ä¸ªå‘½ä»¤éƒ½å¯ä»¥å¾ˆç®€å•çš„è¢«å•ç‹¬æ£€æµ‹ã€‚</p>

<h3 id="toc_4">ç»„åˆæ¨¡å¼</h3>

<p>ç»„åˆæ¨¡å¼ä½¿å¾—ä¸åŒç­‰çº§çš„å¯¹è±¡å¯ä»¥çœ‹æˆä¸€ä¸ªå®ä¾‹ã€‚<br/>
è¿™é‡Œä¸»è¦å¤„ç† AppDelegate ä¸­çš„ä»£ç†å·¥ä½œã€‚<br/>
å¯¹äºæ‰€æœ‰è¦è°ƒç”¨çš„ä»£ç†ï¼Œåˆ†åˆ«åˆ›å»ºå•ç‹¬çš„ä»£ç†æ¨¡å¼ï¼Œæœ€ç»ˆé›†ä¸­è¿›è¡Œå¤„ç†ã€‚</p>

<pre><code>typealias AppDelegateType = UIResponder &amp; UIApplicationDelegate

class CompositeAppDelegate: AppDelegateType {
    private let appDelegates: [AppDelegateType]

    init(appDelegates: [AppDelegateType]) {
        self.appDelegates = appDelegates
    }

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
        appDelegates.forEach { _ = $0.application?(application, didFinishLaunchingWithOptions: launchOptions) }
        return true
    }

    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
        appDelegates.forEach { _ = $0.application?(application, didRegisterForRemoteNotificationsWithDeviceToken: deviceToken) }
    }
}
</code></pre>

<p>ç„¶åå®é™…å·¥ä½œçš„æ—¶å€™ï¼Œéœ€è¦å®ç°çš„ AppDelegate æ–¹æ³•</p>

<pre><code class="language-Swift">//æœ€ç»ˆæ¯ä¸ªdelegateçš„å®ç°æ–¹æ³•
class PushNotificationsAppDelegate: AppDelegateType {
    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
        // Registered successfully
    }
}

class StartupConfiguratorAppDelegate: AppDelegateType {
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
        // Perform startup configurations, e.g. build UI stack, setup UIApperance
        return true
    }
}

class ThirdPartiesConfiguratorAppDelegate: AppDelegateType {
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
        // Setup third parties
        return true
    }
}
</code></pre>

<p>æœ€ç»ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå·¥å‚æ¨¡å¼å»ºç«‹åˆ›å»ºçš„é€»è¾‘ã€‚<br/>
AppDelegate åˆ›å»ºäº†ç»„åˆä»£ç†ï¼Œå¹¶æŠŠå®ƒä»¬ç»™æ‰€æœ‰é€‚åˆçš„åœ°æ–¹è°ƒç”¨ã€‚</p>

<pre><code>enum AppDelegateFactory {
    static func makeDefault() -&gt; AppDelegateType {
        return CompositeAppDelegate(appDelegates: [PushNotificationsAppDelegate(), StartupConfiguratorAppDelegate(), ThirdPartiesConfiguratorAppDelegate()])
    }
}

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {

    var window: UIWindow?
    let appDelegate = AppDelegateFactory.makeDefault()

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
        _ = appDelegate.application?(application, didFinishLaunchingWithOptions: launchOptions)
        return true
    }

    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
        appDelegate.application?(application, didRegisterForRemoteNotificationsWithDeviceToken: deviceToken)
    }
}
</code></pre>

<p>è¿™æ ·æœ€ç»ˆè¾¾åˆ°çš„æ•ˆæœæ˜¯<br/>
1. æ¯ä¸€ä¸ªå­delegateéƒ½åªè¡Œä½¿åŒä¸€ä¸ªèŒèƒ½ã€‚<br/>
2. æ·»åŠ æ–°çš„ä»»åŠ¡ä»¥åŠdelegateå¾ˆå®¹æ˜“ï¼Œ è¿™å¹¶ä¸éœ€è¦ä¿®æ”¹ä¸»ä½“ä»£ç <br/>
3. æ‰€æœ‰çš„ä»£ç†éƒ½å¾ˆå®¹æ˜“è¿›è¡Œéš”ç¦»æµ‹è¯•</p>

<h3 id="toc_5">ä¸­ä»‹è€…æ¨¡å¼</h3>

<p><a href="http://www.vadimbulavin.com/mediator-pattern-case-study/">ä¸­ä»‹å¯¹è±¡</a> é€šè¿‡ä¸€ä¸ªéå¸¸éšè”½éç›´è§‚çš„å½¢å¼å®ç°äº¤äº’ã€‚</p>

<p>ç°åœ¨é€šè¿‡å®ç°ä¸€ä¸ª <code>AppLifecycleMediator</code> æ¥ä¼ æ’­ <code>UIApplication</code> çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ç»™å„ä¸ªè§‚å¯Ÿè€…ã€‚è¿™äº›è§‚å¯Ÿè€…å¿…é¡»éµå®ˆ <code>AppLifecycleListener</code> åè®®ã€‚</p>

<pre><code>// MARK: - AppLifecycleListener  Appçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
protocol AppLifecycleListener {
    func onAppWillEnterForeground()
    func onAppDidEnterBackground()
    func onAppDidFinishLaunching()
}

// MARK: - Mediator
class AppLifecycleMediator: NSObject {
    private let listeners: [AppLifecycleListener]

    init(listeners: [AppLifecycleListener]) {
        self.listeners = listeners
        super.init()
        subscribe()
    }

    deinit {
        NotificationCenter.default.removeObserver(self) //åœ¨é”€æ¯æ—¶å–æ¶ˆç›‘å¬
    }

    private func subscribe() {
        NotificationCenter.default.addObserver(self, selector: #selector(onAppWillEnterForeground), name: .UIApplicationWillEnterForeground, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(onAppDidEnterBackground), name: .UIApplicationDidEnterBackground, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(onAppDidFinishLaunching), name: .UIApplicationDidFinishLaunching, object: nil)
    }

    @objc private func onAppWillEnterForeground() {
        listeners.forEach { $0.onAppWillEnterForeground() }
    }

    @objc private func onAppDidEnterBackground() {
        listeners.forEach { $0.onAppDidEnterBackground() }
    }

    @objc private func onAppDidFinishLaunching() {
        listeners.forEach { $0.onAppDidFinishLaunching() }
    }
}

extension AppLifecycleMediator {
    static func makeDefaultMediator() -&gt; AppLifecycleMediator {
        let listener1 = ...
        let listener2 = ...
        return AppLifecycleMediator(listeners: [listener1, listener2])
    }
}
</code></pre>

<p>é€šè¿‡ä¸€è¡Œä»£ç å®Œæˆåœ¨AppDelegateä¸­çš„æ·»åŠ </p>

<pre><code>@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
    var window: UIWindow?

    let mediator = AppLifecycleMediator.makeDefaultMediator()

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
        return true
    }
}
</code></pre>

<p>ä¸­ä»‹å¯¹è±¡è‡ªåŠ¨çš„æ³¨å†Œäº†å¯¹äºæ‰€æœ‰äº‹ä»¶çš„è§‚å¯Ÿã€‚åœ¨AppDelegateåªè¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå°±èƒ½ä½¿å…¶æ­£å¸¸çš„å·¥ä½œ<br/>
æœ€ç»ˆæ»¡è¶³äº†æ–‡ç« å¼€å¤´çš„è¦æ±‚ï¼š<br/>
1. æ¯ä¸ªç›‘å¬å™¨éƒ½åªæœ‰ä¸€ä¸ªåŠŸèƒ½<br/>
2. ä¸ä¿®æ”¹ AppDelegateçš„ä»£ç ï¼Œå¾ˆè½»æ˜“çš„æ·»åŠ æ–°çš„è§‚å¯Ÿè€…/ç›‘å¬å™¨<br/>
3. æ¯ä¸ªè§‚å¯Ÿè€…ï¼Œåˆå«åšåè°ƒå™¨ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„åšéš”ç¦»æµ‹è¯•ã€‚</p>

<h2 id="toc_6">æ€»ç»“</h2>

<p>æˆ‘ä»¬éƒ½æ‰¿è®¤å¤§éƒ¨åˆ†çš„ <code>AppDelegate</code> éƒ½éç†æ€§çš„å¤§ï¼Œè¿‡åº¦å¤æ‚ï¼Œè¡Œä½¿äº†è¿‡å¤šçš„èŒèƒ½ã€‚æˆ‘ä»¬æŠŠè¿™äº›å«åš<code>Massive App Delegates</code><br/>
é€šè¿‡æ¥å…¥è¿™äº›è®¾è®¡æ¨¡å¼ï¼Œ<code>Massive App Delegate</code> å¯ä»¥è¢«åˆ†å‰²æˆå¤šä¸ªç±»ï¼Œæ¯ä¸ªç±»å®ç°å•ä¸€èŒèƒ½ï¼Œè¿™æ ·ä¹Ÿæ˜“äºéš”ç¦»æµ‹è¯•ã€‚<br/>
è¿™æ ·çš„ä»£ç éå¸¸æ˜“äºä¿®æ”¹ï¼Œä¸ä¼šå› ä¸ºæ”¹åŠ¨é€ æˆå¤§é‡çš„è¿å¸¦ååº”ã€‚æœ€ç»ˆéå¸¸çš„é¢†è¿‡ï¼Œæ˜“äºè¢«æŠ½ç¦»ä»¥åŠé‡ç”¨ã€‚</p>

<p><a href="http://www.vadimbulavin.com/refactoring-massive-app-delegate/">åŸæ–‡åœ°å€</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é—®é¢˜è®°å½•]]></title>
    <link href="iginkgo.cn/15330418099703.html"/>
    <updated>2018-07-31T20:56:49+08:00</updated>
    <id>iginkgo.cn/15330418099703.html</id>
    <content type="html"><![CDATA[
<span id="more"></span><!-- more -->

<p>ä»Šå¤©é¢ä¸´å‡ºç°äº†2ä¸ªé—®é¢˜</p>

<ol>
<li><p>åœ¨ä¸€ä¸ªtableViewé¡µä¸Šï¼Œåœ¨å½“å‰å±å¹•åªæ˜¾ç¤º2ä¸ªUITableViewCellçš„æƒ…å†µä¸‹ï¼Œ UITableViewä¼šé’ˆå¯¹æ‰€æœ‰çš„æ•°æ®æ¨¡å‹ï¼Œç»Ÿç»Ÿåˆ›å»ºä¸€écellã€‚<br/>
ç¯å¢ƒï¼š IphoneX  iOS11 <br/>
å½“å‰é¡µé¢æ•°æ®æ¨¡å‹æœ‰10ä¸ªï¼Œ å®é™…åˆ›å»ºçš„cellå®ä¾‹æœ‰10ä¸ªã€‚<br/>
æœŸæœ›ç»“æœï¼š åˆæ¬¡åªä¼šåˆå§‹åŒ–2ä¸ªcellã€‚<br/>
æ³¨æ„äº‹é¡¹ï¼š 1.åœ¨å…¶å®ƒæ‰‹æœºä¸Šæ²¡æœ‰è¿™ä¸ªé—®é¢˜ 2.åœ¨é—®é¢˜æ‰‹æœºä¸Šæœ‰äº›é¡µé¢ä¹Ÿæ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p>

<p>å¤„ç†ä¸­</p></li>
<li><p>å¯¹äºUIImageViewä¸­æ˜¾ç¤ºwebpç¼“æ…¢çš„é—®é¢˜ã€‚<br/>
é—®é¢˜èƒŒæ™¯ï¼šç”±äºå›¾ç‰‡æ ¼å¼WebPæé«˜çš„å‹ç¼©æ¯”ï¼Œå¯ä»¥åšåˆ°ä»¥å¾ˆå°çš„ä¼ è¾“å¤§å°å®ç°é«˜æ¸…çš„å›¾ç‰‡æ•ˆæœï¼Œ ç›¸æ¯”JPEGä»¥åŠpngæ€§èƒ½è¦é«˜å¾ˆå¤šã€‚å› æ­¤æ¥å£ä¸­è¿”å›webPä½œä¸ºä¸»è¦çš„æ•°æ®æ ¼å¼ã€‚<br/>
ä½†æ˜¯å¯¹äºä¸‹è½½å¥½çš„NSDataï¼Œåœ¨è½¬æ¢ä¸º UIImageçš„è¿‡ç¨‹ä¸­ï¼Œ100Kå·¦å³çš„å›¾ç‰‡å¤§çº¦è€—æ—¶50-100msã€‚ 400Kå·¦å³çš„webPå›¾ç‰‡å¤§æ¦‚è€—æ—¶1500sï¼Œæ•ˆæœæå·®ã€‚<br/>
å½“å‰é‡‡ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹çš„å›¾ç‰‡åŠ è½½æ¡†æ¶SDWebImageå¯¹webPæ”¯æŒçš„ç‰ˆæœ¬ã€‚è§£è¯»äº†ä¸€ä¸‹å®ƒçš„æºä»£ç ï¼Œå›¾ç‰‡çš„ä¸‹è½½ä»¥åŠè§£æè¿‡ç¨‹å®Œå…¨æ˜¯å¼‚æ­¥å®ç°ï¼Œåªæœ‰åœ¨æœ€åæ”¾åˆ°UIImageViewæ—¶æ‰ä¼šåˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ã€‚<br/>
å½“å‰èƒ½æƒ³åˆ°çš„æ–¹æ¡ˆå°±æ˜¯åœ¨å¤–éƒ¨webPçš„å¤§å›¾æµå…¥ã€‚æˆ–æ˜¯é€‰ç”¨å…¶ä»–çš„å›¾ç‰‡æ ¼å¼ã€‚å†…éƒ¨è€ƒè™‘è‡ªå·±å®ç°ä¸€å¥—webPå›¾ç‰‡çš„è§£ç å™¨ï¼Œè¾¾åˆ°é«˜æ€§èƒ½çš„è¦æ±‚ã€‚</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AutoRelease Pool æ€»ç»“]]></title>
    <link href="iginkgo.cn/15326191313814.html"/>
    <updated>2018-07-26T23:32:11+08:00</updated>
    <id>iginkgo.cn/15326191313814.html</id>
    <content type="html"><![CDATA[
<span id="more"></span><!-- more -->

<ul>
<li>
<a href="#toc_0">åŸºæœ¬çŸ¥è¯†ç‚¹</a>
</li>
<li>
<a href="#toc_1">ä½¿ç”¨æ–¹å¼</a>
</li>
<li>
<a href="#toc_2">åŸç†</a>
</li>
<li>
<a href="#toc_3">ä½¿ç”¨åœºæ™¯</a>
</li>
<li>
<a href="#toc_4">ç–‘é—®</a>
</li>
<li>
<a href="#toc_5">å‚è€ƒæ–‡ç« </a>
</li>
</ul>


<p>ä¸»è¦iOSçš„ç ”å‘ç”Ÿæ¶¯æ˜¯ä½¿ç”¨Swiftä½œä¸ºä¸»åŠ›è¯­è¨€è¿›è¡Œå®ç°çš„,åœ¨é¡¹ç›®ä¸­ä¹ŸåŸºæœ¬æ²¡æœ‰é‡åˆ°æ‰‹åŠ¨ä½¿ç”¨autoreleaseçš„æƒ…å†µã€‚ä½†æ˜¯å› ä¸ºè¿™æ˜¯iOSç›¸å…³çš„åº•å±‚ä¸€ç‚¹çš„çŸ¥è¯†ï¼Œå› æ­¤ä¹¦å†™æ­¤æ–‡ç« ï¼Œä½œä¸ºå­¦ä¹ çš„è®°å½•ã€‚å¦‚æœæ–‡ä¸­æœ‰ç–æ¼å’Œé”™è¯¯ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶æŒ‡æ­£ã€‚</p>

<h2 id="toc_0">åŸºæœ¬çŸ¥è¯†ç‚¹</h2>

<blockquote>
<p>Each NSThread object, including the applicationâ€™s main thread, has an NSRunLoop object automatically created for it as needed.</p>
</blockquote>

<p>æˆ‘ä»¬å¯ä»¥çŸ¥é“æ¯ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒ…æ‹¬ä¸»çº¿ç¨‹ï¼Œéƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªä¸“å±çš„ NSRunLoop å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šåœ¨æœ‰éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»º</p>

<blockquote>
<p>The Application Kit creates an autorelease pool on the main thread at the beginning of every cycle of the event loop, and drains it at the end, thereby releasing any autoreleased objects generated while processing an event.</p>
</blockquote>

<p>åœ¨ä¸»çº¿ç¨‹çš„ NSRunLoop çš„æ¯ä¸ª event loop å¼€å§‹å‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª è‡ªåŠ¨é‡Šæ”¾æ±  ï¼Œå¹¶åœ¨ event loop ç»“æŸæ—¶ drainæ‰ å½“å‰çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå› è€Œåœ¨å¤„ç†å®Œæ—¶é—´ä¹‹åï¼Œä¼šå¯¹æ± ä¸­çš„å¯¹è±¡è¿›è¡Œé‡Šæ”¾æ“ä½œ</p>

<blockquote>
<p>Each thread (including the main thread) maintains its own stack of NSAutoreleasePool objects.</p>
</blockquote>

<p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šç»´æŠ¤è‡ªå·±çš„ è‡ªåŠ¨é‡Šæ”¾æ± çš„æ ˆ</p>

<p>åŒä¸€ä¸ªå¯¹è±¡å¯ä»¥å¤šæ¬¡åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± </p>

<p>åœ¨è‡ªåŠ¨é‡Šæ”¾æ± è¦é”€æ¯æ—¶ï¼Œä¼šå‘æ± å†…çš„æ‰€æœ‰å¯¹è±¡å‘é€releaseæ¶ˆæ¯</p>

<h2 id="toc_1">ä½¿ç”¨æ–¹å¼</h2>

<ol>
<li>åœ¨MRCçš„æ¨¡å¼ä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚
å¯¹äºéœ€è¦åŠ å…¥æ± ä¸­è¿›è¡Œç®¡ç†çš„å¯¹è±¡ï¼Œè°ƒç”¨ <code>[obj autorelease]</code></li>
<li><p>åœ¨ARCçš„æ¨¡å¼ä¸‹</p>

<pre><code>//OC ä»£ç 
@autorelease{   
  //code
}
</code></pre>

<pre><code>//swift ä»£ç 

autorelease {
   //code
}

</code></pre></li>
</ol>

<h2 id="toc_2">åŸç†</h2>

<p>æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šæŒæœ‰ä¸€ä¸ªç®¡ç†è‡ªåŠ¨é‡Šæ”¾æ± çš„æ ˆï¼Œå¯¹äºè¯¥çº¿ç¨‹ä¸­æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œéƒ½ä¼šè‡ªåŠ¨åŠ å…¥åˆ°æ ˆé¡¶ã€‚</p>

<p>å¯¹äºOCä¸­çš„ä»£ç </p>

<pre><code>@autorelease {
//ä»£ç 
}
</code></pre>

<p>åœ¨ç»è¿‡ç¼–è¯‘å™¨è¿›è¡Œå¤„ç†åï¼Œä¼šè½¬æ¢æˆä»¥ä¸‹çš„ä»£ç ï¼š</p>

<pre><code>void *context = objc_autoreleasePoolPush();
// {}ä¸­çš„ä»£ç 
objc_autoreleasePoolPop(context);
//context æŒ‡çš„æ˜¯å“¨å…µ
</code></pre>

<p>å®é™…autoreleasepoolçš„åˆ›å»ºä¹‹åè°ƒç”¨äº† AutoreleasePoolPageçš„æ–¹å‘</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>AutoReleasePoolPage</code>è¿™ä¸ªC++å®ç°çš„ä»£ç åº•åšäº†äº›ä»€ä¹ˆ</p>

<p>AutoreleasePoolPage æ˜¯ä¸€ä¸ª4kå¤§å°çš„ç©ºé—´ï¼Œå…¶åŸºæœ¬ç»“æ„æ˜¯</p>

<pre><code>//AutoreleasePoolPage
magic_t const magic; //ç”¨äºæ ¡éªŒAutoreleasePoolPageçš„ç»“æ„æ˜¯å¦å®Œæ•´
id *next; //æŒ‡å‘æœ€æ–°æ·»åŠ çš„autoreleasedå¯¹è±¡çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œåˆå§‹åŒ–æ—¶æŒ‡å‘begin()
pthread_t const thread;  //æŒ‡å‘å½“å‰æŒ‡é’ˆ
AutoreleasePoolPage *const parent; //æŒ‡å‘çˆ¶èŠ‚ç‚¹ å› æ­¤ ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„parent å€¼ä¸ºnil
AutoreleasePoolPage *child //æŒ‡å‘å­èŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„child å€¼ä¸ºnil
uint32_t const depth; // è¡¨ç¤ºæ·±åº¦ï¼Œä»0å¼€å§‹ï¼Œå¾€åé€’å¢1
unit32_t hiwat;
</code></pre>

<p>ä»ä¸Šæ–¹<code>AutoreleasePoolPage</code>çš„ç»“æ„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå®ƒåŒæ—¶æ‹¥æœ‰æŒ‡å‘çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥ç”¨äºç»„æˆåŒå‘é“¾è¡¨ã€‚<br/>
è€Œåœ¨åº”ç”¨ä¸­ï¼Œ<code>AutoreleasePoolPage</code>å®ƒ4Kå¤§å°çš„ç©ºé—´é™¤äº†ä¿å­˜ä¸Šé¢çš„å˜é‡ä¹‹å¤–ï¼Œå…¶ä½™çš„æ§ä»¶éƒ½ç”¨äºä¿å­˜autoreleaseçš„å¯¹è±¡æŒ‡é’ˆã€‚å½“<code>next==begin()</code>æ—¶ï¼Œè¡¨ç¤ºAutoreleasePoolPageä¸ºç©ºï¼›å½“<code>next==end()</code>æ—¶ï¼Œè¡¨ç¤ºAutoreleasePoolPageå½“å‰å·²æ»¡ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„AutoreleasePoolPageã€‚å¹¶å°†å·²æ»¡çš„AutoreleasePoolPage.childæŒ‡é’ˆæŒ‡å‘æ–°çš„pageã€‚è¿™æ ·å°±å®ç°äº†è‡ªåŠ¨å¼€è¾Ÿç©ºé—´æ¥å­˜å‚¨autoreleaseçš„å¯¹è±¡ã€‚</p>

<p>å½“åˆ›å»ºä¸€ä¸ªæ–°çš„autorelease Poolæ—¶ï¼Œç®¡ç†autorelease Poolçš„æ ˆåœ¨æ ˆé¡¶æ·»åŠ äº†æ–°çš„autorelease Poolæ—¶ï¼Œå¯¹åº”çš„å½“å‰AutorelesePoolPageä¸­çš„nextæŒ‡å‘çš„ä½ç½®ä¼šæ·»åŠ ä¸€ä¸ªå“¨å…µï¼Œç”¨äºæ ‡è¯†æ­¤å¤„æ·»åŠ çš„Autorelease poolã€‚nextæŒ‡é’ˆåç§»ï¼Œ æ± ä¸­æ–°çš„autoreleaseçš„å¯¹è±¡ä¼šä¸€æ¬¡å­˜æ”¾åœ¨nextæŒ‡é’ˆæŒ‡å‘çš„åœ°æ–¹ã€‚</p>

<p>å½“éœ€è¦é”€æ¯ä¸€ä¸ªautorelease Poolæ—¶ï¼Œä¼šåœ¨AutorelesePoolPageå¯»æ‰¾åˆ°å¯¹åº”çš„å“¨å…µçš„ä½ç½®ï¼Œå¯¹å…¶å‘åçš„æ‰€æœ‰å¯¹è±¡ä»¥åŠä»¥åçš„AutorelesePoolPageéƒ½ä¼šæ‰§è¡Œreleaseæ“ä½œã€‚</p>

<p>ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œé€šè¿‡å¯¹AutorelesePoolPageçš„æ“ä½œï¼Œå®Œæˆäº†çº¿ç¨‹ä¸­autorelease poolå¯¹äºæ·»åŠ åˆ°æ± ä¸­å¯¹è±¡çš„ç®¡ç†ã€‚</p>

<p>å¹¶ä¸”ä¸Šé¢æåˆ°çš„ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªæ ˆï¼Œç”¨äºç®¡ç†autorelease poolï¼Œæˆ‘è®¤ä¸ºè¿™ä¹Ÿæ˜¯é€šè¿‡ AutorelesePoolPageçš„åŒå‘é“¾è¡¨å®ç°çš„ã€‚</p>

<h2 id="toc_3">ä½¿ç”¨åœºæ™¯</h2>

<ul>
<li>ä½ ç¼–å†™æ˜¯å‘½ä»¤è¡Œå·¥å…·çš„ä»£ç ï¼Œè€Œä¸æ˜¯åŸºäº UI æ¡†æ¶çš„ä»£ç </li>
<li>ä½ éœ€è¦å†™ä¸€ä¸ªå¾ªç¯ï¼Œé‡Œé¢ä¼šåˆ›å»ºå¾ˆå¤šä¸´æ—¶çš„å¯¹è±¡</li>
<li>è¿™æ—¶å€™ä½ å¯ä»¥åœ¨å¾ªç¯å†…éƒ¨çš„ä»£ç å—é‡Œä½¿ç”¨ä¸€ä¸ª @autoreleasepool {}ï¼Œè¿™æ ·è¿™äº›å¯¹è±¡å°±èƒ½åœ¨ä¸€æ¬¡è¿­ä»£å®Œæˆåè¢«é‡Šæ”¾æ‰ã€‚è¿™ç§æ–¹å¼å¯ä»¥é™ä½å†…å­˜æœ€å¤§å ç”¨</li>
<li>å½“ä½ å¤§é‡ä½¿ç”¨è¾…åŠ©çº¿ç¨‹</li>
<li>ä½ éœ€è¦åœ¨çº¿ç¨‹çš„ä»»åŠ¡ä»£ç ä¸­åˆ›å»ºè‡ªå·±çš„ @autoreleasepool {}</li>
</ul>

<h2 id="toc_4">ç–‘é—®</h2>

<p><a href="https://www.jianshu.com/p/5559bc15490d">æ–‡ç« </a>æœ‰ä¸€æ®µæè¿°</p>

<blockquote>
<p>MRCä¸‹éœ€è¦å¯¹è±¡è°ƒç”¨autoreleaseæ‰ä¼šå…¥æ± , ARCä¸‹å¯ä»¥é€šè¿‡__autoreleasingä¿®é¥°ç¬¦, å¦åˆ™çš„è¯çœ‹æ–¹æ³•å, éalloc/new/copy/mutableCopyå¼€å¤´çš„æ–¹æ³•ç¼–è¯‘å™¨éƒ½ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨autoreleaseæ–¹æ³•.</p>
</blockquote>

<h2 id="toc_5">å‚è€ƒæ–‡ç« </h2>

<p>1.<a href="https://blog.sunnyxx.com/2014/10/15/behind-autorelease/">Sunnyçš„è¿™ç¯‡æ–‡ç« è®²çš„å¾ˆè¯¦ç»†</a><br/>
2.<a href="https://blog.ibireme.com/2015/05/18/runloop/">https://blog.ibireme.com/2015/05/18/runloop/</a><br/>
3.<a href="https://imtangqi.com/2016/04/15/autorelease-pool-in-ios/">https://imtangqi.com/2016/04/15/autorelease-pool-in-ios/</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[fastlaneç›¸å…³]]></title>
    <link href="iginkgo.cn/15325341079693.html"/>
    <updated>2018-07-25T23:55:07+08:00</updated>
    <id>iginkgo.cn/15325341079693.html</id>
    <content type="html"><![CDATA[
<span id="more"></span><!-- more -->

<p>å…·ä½“çš„fastlaneé…ç½®æ–‡ä»¶åœ¨ <code>é¡¹ç›®/fastlane/</code>æ–‡ä»¶å†… </p>

<pre><code>Fastfile =&gt; ç”¨æ¥å®šä¹‰æ‰€æœ‰çš„laneä»»åŠ¡
Appfile =&gt; æ˜¯ç”¨æ¥å­˜å‚¨ä¸€äº›å…¬å…±ä¿¡æ¯çš„ï¼Œæ¯”å¦‚app_identifierï¼Œapple_idï¼Œteam_idï¼Œitc_team_idç­‰ã€‚
Deliverfile =&gt; deliverçš„é…ç½®æ–‡ä»¶
</code></pre>

<h2 id="toc_0">fastlaneå®‰è£…</h2>

<pre><code>xcode-select --install
sudo gem install fastlane
</code></pre>

<p>å…¶ä¸­åœ¨å®‰è£…fastlaneæ—¶ä¸€ç›´å‡ºç°é—®é¢˜ï¼Œ æŒ‰ç…§fastlaneåœ¨githubä¸Šç»™å‡ºçš„è¯´æ˜ï¼Œ å®‰è£…äº†RVMä¹‹åï¼Œå®‰è£…çš„é—®é¢˜å¾—ä»¥è§£å†³ã€‚</p>

<h2 id="toc_1">æ’ä»¶å®‰è£…</h2>

<pre><code>fastlane install_plugins // å®‰è£…æ’ä»¶
</code></pre>

<p>å½“å‰é¡¹ç›®ä¸­åˆ†åˆ«å®‰è£…äº†ä¸¤ä¸ªæ’ä»¶</p>

<pre><code>fastlane add_plugin firim // è‡ªåŠ¨ä¸Šä¼ firçš„æ’ä»¶
fastlane add_plugin versioning
</code></pre>

<h2 id="toc_2">ä½¿ç”¨</h2>

<p>åœ¨cocopodsä¸€ä¸‹å®‰è£…æ²¡æœ‰é—®é¢˜çš„æƒ…å†µä¸‹</p>

<p><code>fastlane develop</code> æ‰“åŒ…developmentç¯å¢ƒå¹¶è¿›è¡Œä¸Šä¼ <br/>
<code>fastlane adhoc</code>   æ‰“åŒ…adhocç¯å¢ƒå¹¶è¿›è¡Œä¸Šä¼ <br/>
 æµ‹è¯•// æ”»ç•¥ä¸­</p>

<h2 id="toc_3">å‚è€ƒæ–‡æ¡£</h2>

<ol>
<li><a href="https://docs.fastlane.tools/">å®˜æ–¹æ–‡æ¡£</a></li>
<li><p><a href="https://dongjiawang.github.io/2017/09/13/2017-09-13-fastlane/">è‡ªåŠ¨å‘å¸ƒ</a></p></li>
<li><p><a href="https://zhuanlan.zhihu.com/p/23180455">https://zhuanlan.zhihu.com/p/23180455</a></p></li>
<li><p>æŠŠæ‰€æœ‰çš„è¿‡ç¨‹æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ <a href="https://www.jianshu.com/p/edcd8d9430f6">æ–¹æ³•</a></p></li>
<li><p><a href="http://www.devzhang.cn/2017/07/18/fastLane%E5%85%A5%E9%97%A8%E4%B9%8Bipa%E6%89%93%E5%8C%85/">æ²¡äº‹çœ‹çœ‹</a></p></li>
</ol>

<h2 id="toc_4">é¢å¤–é…ç½®</h2>

<h3 id="toc_5">.gitignore</h3>

<pre><code># fastlane specific
fastlane/report.xml

# deliver temporary files
fastlane/Preview.html

# snapshot generated screenshots
fastlane/screenshots

# scan temporary files
fastlane/test_output
</code></pre>

<h3 id="toc_6">å°æ„Ÿæ‚Ÿ</h3>

<p>åœ¨laneä¸­æ‰§è¡Œ é€šå¸¸terminalçš„å‘½ä»¤æ˜¯ä¸okï¼Œ<br/>
éœ€è¦ä½¿ç”¨ sh &quot;å‘½ä»¤&quot;  æ‰§è¡Œæ‰å¯ä»¥</p>

<h2 id="toc_7">Fastfileé…ç½®æ–‡ä»¶</h2>

<p><a href="https://github.com/DroidDreamer/codeDaily/blob/master/files/Fastfile">demoåœ°å€</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æœ€å¤§å€¼è¿ç»­å­åºåˆ—]]></title>
    <link href="iginkgo.cn/15325305399890.html"/>
    <updated>2018-07-25T22:55:39+08:00</updated>
    <id>iginkgo.cn/15325305399890.html</id>
    <content type="html"><![CDATA[
<span id="more"></span><!-- more -->

<p>æ™šä¸Šåœ¨å¬å¾—åˆ°çš„ä¸Šå´å†›è€å¸ˆè®²çš„ã€Šè°·æ­Œæ–¹æ³•è®ºçš„ä¸“æ ã€‹ï¼Œé¢˜ç›®å«åšè‚¡ç¥¨çš„æœ€é•¿å¢é•¿æœŸã€‚å…¶å®ä¹Ÿå°±æ˜¯æ±‚çš„æœ€å¤§å’Œçš„å­åºåˆ—æ–¹æ³•ã€‚</p>

<blockquote>
<p>é¢˜ç›®: å¯¹äºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…æ•°å€¼å¯æ­£å¯è´Ÿï¼Œ æ±‚å…¶ä¸­å’Œæœ€å¤§çš„å­åºåˆ—(ä¸è€ƒè™‘ç©ºæ•°ç»„çš„æƒ…å†µ)</p>
</blockquote>

<p>ä¾‹å¦‚ [1,3,-2,-5,8,2,-3,6,-2]ï¼Œ å…¶å’Œæœ€å¤§çš„å­åºåˆ—ä¸º [8,2,-3,6].</p>

<pre><code>//swiftä»£ç 
var list = [1,3,-2,-5,8,2,-3,6,-2]
//
</code></pre>

<p>å½“ç„¶ï¼Œç›´æ¥æ‹¿åˆ°è¿™ä¸ªé¢˜ç›®ï¼Œé™¤äº†å¸¸è§„ä¸Šçš„ä¸Šæ¥å°±åšä¹‹å¤–ï¼Œè¿˜è¦è€ƒè™‘ä¸€ä¸‹é¢˜ç›®æ˜¯å¦å®Œæ•´ï¼Œä»¥åŠå„ç§è¾¹ç•Œæƒ…å†µï¼Œ<br/>
æ¯”å¦‚<br/>
1.å­åºåˆ—çš„å’Œæº¢å‡ºçš„æƒ…å†µ<br/>
2.ç»™å‡ºçš„æ•°ç»„ä¸ºç©ºçš„æƒ…å†µ<br/>
æ–‡ç« ä¸­çš„æ–¹æ³•å¹¶ä¸ä¼šå¯¹è¿™äº›æƒ…å†µä½œå‡ºå¤„ç†ï¼Œ ä½†æ˜¯åœ¨è‡ªå·±å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦è€ƒè™‘åˆ°è¿™äº›å¯èƒ½æ€§ã€‚</p>

<h2 id="toc_0">ä¸“æ ä¸­çš„è§£æ³•</h2>

<p>ä¸“æ ä¸­è®²åˆ°å››ç§æ–¹æ³•ï¼Œåˆ†åˆ«æŒ‰ç…§æ•ˆç‡çš„ç”±ä½åˆ°é«˜è¿›è¡Œå®ç°ã€‚ä¹Ÿå°±æ˜¯æ—¶é—´å¤æ‚åº¦çš„ç”±é«˜åˆ°ä½ã€‚</p>

<h3 id="toc_1">ç¬¬ä¸€ç§ï¼Œæš´åŠ›éå†æ‰€æœ‰æƒ…å†µ</h3>

<p>éå†æ¯ä¸€ä¸ªèµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹ï¼Œæ±‚ä¸¤ç‚¹ä¹‹é—´åºåˆ—çš„å’Œï¼Œä¿ç•™æœ€å¤§å€¼ä»¥åŠå¯¹åº”çš„èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹</p>

<pre><code>var list: [Int] = [2,3,-6,3,5,-2,7,4,-2,-1,2]
class Result {
    var startIndex: Int
    var endIndex: Int
    var count: Int
    
    init(start: Int, end: Int, count: Int) {
        self.startIndex = start
        self.endIndex = end
        self.count = count
    }
}


func getResultFor(array: [Int])-&gt; Result {
    var result = Result(start: -1, end: -1, count: 0)
    for i in 0..&lt;array.count {
        let tempResult = getResultFor(startIndex: i, array: array)
        if result.count &lt; tempResult.count{
            result = tempResult
        }
    }
    return result
}

func getResultFor(startIndex: Int, array: [Int])-&gt; Result{
    var temMax = Int.min
    var endIndex: Int = -1
    for j in startIndex..&lt;array.count {
        let count = getCount(startIndex: startIndex, endIndex: j, array: array)
        if temMax &lt; count {
            temMax = count
            endIndex = j
        }
    }
    return Result(start: startIndex, end: endIndex, count: count)
}


func getCount(startIndex: Int, endIndex: Int, array:[Int])-&gt; Int {
    if startIndex &lt;= endIndex, array.count &gt; endIndex {
        var count = 0
        for i in startIndex...endIndex {
            count += array[i]
        }
        return count
    }else {
        fatalError()
    }
}
</code></pre>

<h3 id="toc_2">ç¬¬äºŒç§ï¼Œä¼˜åŒ–ä¸€äº›çš„ç®—æ³•</h3>

<p>éå†æ¯ä¸€ä¸ªèµ·å§‹ç‚¹ï¼Œç„¶åéå†æ¯ä¸€ä¸ªç»ˆæ­¢ç‚¹ï¼Œå¯¹æ¯”æ¯æ¬¡å¾ªç¯å¾—å‡ºçš„æœ€å¤§å€¼ï¼Œæ¯”è¾ƒä¹‹åæ±‚å‡ºæœ€å€¼ç»“æœ</p>

<pre><code>
var list: [Int] = [2,3,-6,3,5,-2,7,4,-2,-1,2]


class Result {
    var startIndex: Int
    var endIndex: Int
    var count: Int
    
    init(start: Int, end: Int, count: Int) {
        self.startIndex = start
        self.endIndex = end
        self.count = count
    }
}


func getResultFor(array: [Int])-&gt; Result {
    var result = Result(start: -1, end: -1, count: 0)
    for i in 0..&lt;array.count {
        let tempResult = getResultFor(startIndex: i, array: array)
        if result.count &lt; tempResult.count{
            result = tempResult
        }
    }
    return result
}

func getResultFor(startIndex: Int, array: [Int])-&gt; Result{
    var temMax = Int.min
    var count: Int = 0
    var endIndex: Int = -1
    for j in startIndex..&lt;array.count {
        count += list[j]
        if temMax &lt; count {
            temMax = count
            endIndex = j
        }
    }
    return Result(start: startIndex, end: endIndex, count: count)
}
</code></pre>

<p>è¿™ç§è§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n2) nçš„å¹³æ–¹<br/>
åœ¨ç¬¬ä¸€ç§è§£æ³•çš„åŸºç¡€ä¸Šï¼Œå¦‚æœå‡å®šäº†èµ·å§‹ç‚¹ï¼Œé‚£ä¹ˆè¯¥ç‚¹åˆ°ç»ˆæ­¢ç‚¹çš„æ€»å’Œå¯ä»¥æ ¹æ®å‰ä¸€ä¸ªç‚¹çš„ç»“æœæ±‚å’Œå¾—å‡ºã€‚<br/>
<code>Sum(n) = Sum(n-1) + list[n]</code>. </p>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ åœ¨getResultForçš„ä¸¤ä¸ªæ–¹æ³•ä¸­ï¼Œæ¯æ¬¡éƒ½æŠŠarrayåšä¸ºå‚æ•°è¿›è¡Œäº†ä¼ é€’ã€‚é€šå¸¸æ„ä¹‰ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªArrayä½œä¸ºä¸€ä¸ªå€¼ç±»å‹ï¼Œåœ¨ä½œä¸ºå‚æ•°è¿›è¡Œè°ƒç”¨æ—¶å¯èƒ½ä¼šå¼€è¾Ÿæ–°ç©ºé—´ï¼Œå› æ­¤å¾ˆå¤šè¯­è¨€ä¸Šæ¥è¯´æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšçš„ã€‚Swiftä½œä¸ºä¸€ä¸ªæ–°ç”Ÿçš„è¯­è¨€ï¼Œå€¼ç±»å‹éƒ½ç»è¿‡äº†ä¼˜åŒ–ï¼Œé‚£å°±æ˜¯åœ¨è°ƒç”¨ä¹‹åï¼Œé»˜è®¤å…ˆä¸è¿›è¡Œcopyï¼Œåªæœ‰åœ¨å¯¹è¯¥å€¼ç±»å‹è¿›è¡Œä¿®æ”¹æ—¶æ‰ä¼šä¸´æ—¶copyã€‚</p>

<h3 id="toc_3">ç¬¬ä¸‰ç§ï¼Œåˆ†æ²»ç®—æ³•</h3>

<p>æ±‚ä¸€ä¸ªæ•°ç»„çš„æœ€å¤§è¿ç»­å­åºåˆ—å’Œï¼Œå¦‚æœé‡‡ç”¨ä¸€åˆ†ä¸ºäºŒçš„è§’åº¦æ¥çœ‹ï¼Œå°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ™å¯èƒ½å‡ºç°3ç§æƒ…å†µï¼Œå°±æ˜¯1.æœ€å¤§å­åºåˆ—åœ¨å·¦ä¾§å­æ•°ç»„ä¸­ 2.æœ€å¤§å­åºåˆ—åœ¨å³ä¾§å­æ•°ç»„ä¸­ 3. æœ€å¤§å­åºåˆ—æ¨ªè·¨ä¸­å¿ƒç‚¹ï¼Œåœ¨å·¦å³ä¸¤ä¸ªå­æ•°ç»„ä¸­åˆ†åˆ«å æœ‰ä¸€éƒ¨åˆ†ã€‚<br/>
å¯¹äºç¬¬1ï¼Œ2ä¸­æƒ…å†µï¼Œå¯ä»¥ç›´æ¥ç»§ç»­è¿›è¡Œé€’å½’å¤„ç†ã€‚<br/>
å¯¹äºç¬¬ä¸‰ç§æƒ…å†µï¼Œ å¯¹äºå·¦å­æ•°ç»„ï¼Œä»å³ä¾§èŠ‚ç‚¹ä¸ºèµ·å§‹ç‚¹ï¼Œå‘å·¦å¯»æ‰¾ä¸€ä¸ªç»ˆç‚¹ï¼Œä½¿åŒºé—´å’Œæœ€å¤§ã€‚<br/>
               å¯¹äºå³ä¾§æ•°ç»„ï¼Œä»å·¦ä¾§èŠ‚ç‚¹ä¸ºèµ·å§‹ç‚¹ï¼Œå‘å³å¯»æ‰¾ä¸€ä¸ªç»ˆç‚¹ï¼Œä½¿åŒºé—´å’Œæœ€å¤§ï¼Œå¹¶å°†ä»¥ä¸Šä¸¤è€…çš„å’Œç›¸åŠ ï¼Œå³ä¸ºæœ€ç»ˆç»“æœã€‚</p>

<pre><code>var list: [Int] = [2,3,-6,3,5,-2,7,4,-2,-1,2]

func getResult(array: [Int], left: Int, right: Int)-&gt; Int {
    if left &gt;= right {
        return array[right] &gt; 0 ? array[right] : 0
    }
    
    var middle = (right + left) / 2
    let leftMax = getResult(array: array, left: left, right: middle)
    let rightMax = getResult(array: array, left: middle + 1, right: right)
    let middleMax = getLeftSubMax(array: array, left: left, middle: middle) + getRightSubMax(array: array, middle: middle + 1, right: right)
    
    return Swift.max(leftMax, rightMax, middleMax)
}


func getLeftSubMax(array:[Int], left: Int, middle: Int)-&gt; Int {
    var max = 0
    var count = 0
    var index = middle
    
    while (index &gt;= left) {
        count += array[index]
        if max &lt; count {
            max = count
        }
        index -= 1
    }
    return count
}


func getRightSubMax(array:[Int], middle: Int, right: Int)-&gt; Int {
    var max = 0
    var count = 0
    var index = middle

    while (index &lt;= right) {
        count += array[index]
        if max &lt; count {
            max = count
        }
        index += 1
    }
    return max
}



//æœ€ç»ˆç»“æœ
getResult(array: list, left: 0, right: list.count - 1)

</code></pre>

<h3 id="toc_4">ç¬¬å››ç§(è¯¥é¢˜ä»£ç å®ç°æœ‰é—®é¢˜)</h3>

<p>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥å»¶ç»­è¿™ä¹ˆä¸€ä¸ªæ€è·¯ï¼š<br/>
å¯¹äºä¸€ä¸ªæ•°ç»„ listï¼Œå¯¹äºæŸä¸ªç¡®å®šçš„èµ·å§‹ç‚¹ï¼Œæ¯”å¦‚ä¸‹æ ‡startå¼€å§‹ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“å­åºåˆ—æ˜¯ç»ˆæ­¢åœ¨ ä¸‹æ ‡ä¸ºkçš„åœ°æ–¹å¥½çš„ï¼Œè¿˜æ˜¯ç»ˆæ­¢åœ¨ä¸‹æ ‡ä¸ºk+1çš„ä½ç½®å¥½å‘¢ï¼Œè¿™ä¸»è¦çœ‹ list[k+1]è¿™ä¸ªå€¼æ˜¯å¦ä¸ºæ­£ã€‚å¦‚æœä¸ºæ­£ï¼Œé‚£ä¹ˆæ˜¾ç„¶åº”è¯¥å§k+1è¿™ä¸ªèŠ‚ç‚¹æ”¶çº³è¿›æ¥ã€‚å¦‚æœæœªè´Ÿï¼Œä¸èƒ½å•çº¯çš„åˆ¤æ–­éœ€è¦æŠ›å¼ƒï¼Œè€Œæ˜¯è¦çœ‹ä»è¯¥ç‚¹ä¹‹åçš„ç´¯ç§¯å€¼æ˜¯å¦å¯ä»¥ä¸ºæ­£ã€‚æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯çœ‹ä»startç‚¹å¼€å§‹ï¼Œåˆ°æœ€ç»ˆå“ªä¸€å¤©ç»“æŸçš„ç´¯ç§¯å¢å¹…æœ€å¤§ã€‚è¿™ä¸ªæ—¶å€™ï¼Œendç‚¹è‚¯å®šæ˜¯æœ€ä¼˜ç»ˆæ­¢ç‚¹ã€‚</p>

<p>æ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œ<br/>
ä»¥ä¸‹æ ‡0ä¸ºèµ·å§‹ç‚¹ï¼Œæ‰¾å‡ºæŒç»­å¢å¹…æœ€å¤§çš„ä¸€ä¸ªç‚¹ ï¼ˆéå†kæ¬¡ï¼‰ï¼Œå¯ä»¥æ‰¾å‡ºendç‚¹ã€‚<br/>
å°†æ•°ç»„åè¿‡æ¥ï¼Œä»¥ ï¼ˆn-1ï¼‰ ä¸ºèµ·å§‹ç‚¹ï¼Œ0ä¸ºç»ˆæ­¢ç‚¹ï¼ŒæŒ‰ç…§åŒæ ·çš„é€»è¾‘ï¼Œå¯ä»¥æ‰¾åˆ°startç‚¹ã€‚<br/>
è¿™æ ·ï¼Œstart-endè¿™ä¸ªåŒºé—´å°±æ˜¯æ‰€æ±‚çš„ç»“æœåŒºé—´ã€‚</p>

<p>ä¸Šé¢çš„è¯­è¨€æ¯”è¾ƒå•°å—¦ï¼Œæ€»çš„æ¥è¯´ï¼Œæ­£å‘éå†ä¸€éï¼Œå¯ä»¥æ‰¾åˆ°æœ€ä½³çš„ç»ˆæ­¢ç‚¹ã€‚<br/>
å› ä¸ºè¿™ä¸ªæ•°ç»„çš„è§£æ³•å…·æœ‰å¯¹ç§°æ€§ã€‚åç€åšé€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œ åå‘éå†ä¸€éï¼Œå¯ä»¥æ‰¾åˆ°æœ€ä½³çš„èµ·å§‹ç‚¹ã€‚</p>

<pre><code>var list: [Int] = [2,3,-6,3,5,-2,7,4,-2,-1,2]
class Result {
    var startIndex: Int
    var endIndex: Int
    var count: Int
    
    init(start: Int, end: Int, count: Int) {
        self.startIndex = start
        self.endIndex = end
        self.count = count
    }
}



func leftToRightSumList(array: [Int])-&gt; [Int] {
    var sum: [Int] = []
    var count = 0

    return array.map({ (value) -&gt; Int in
        count += value
        return count
    })
}

func rightToSumList(array: [Int])-&gt; [Int]{
    var sum: [Int] = array
    
    var index = array.count - 2
    while (index &gt;= 0) {
        sum[index] = sum[index] + sum[index+1]
        index -= 1
    }
    return sum
}

func getIndexWhenValueMax(array: [Int])-&gt; Int {
    var max = 0
    var result = 0
    
    for index in 0..&lt;array.count {
        if max &lt; array[index] {
            max = array[index]
            result = index
        }
    }
    return result
    
}

func getMaxListValue(array: [Int])-&gt; Int {
    var leftSumList = leftToRightSumList(array: array)
    var rightSumList = rightToSumList(array: array)
    var rightIndex = getIndexWhenValueMax(array: leftSumList)
    var leftIndex = getIndexWhenValueMax(array: rightSumList)
    var count = 0
    for index in leftIndex...rightIndex {
        count += array[index]
    }
    return count
}
getMaxListValue(array: list)

</code></pre>

<p>æ—¶é—´å¤æ‚åº¦ O(n)</p>

<p>æ€»ç»“1: æ€ç»´é«˜åº¦å†³å®šä¸€ä¸ªäººçš„å¢ƒç•Œã€‚<br/>
æ€»ç»“2: å¯¹ç§°æ€§è¿™ä¸ªæ€ç»´å·¥å…·çœŸçš„å¾ˆé‡è¦</p>

<h2 id="toc_5">ä¸ªäººè§£æ³•</h2>

<p>é¦–å…ˆæ„å»ºä¸€ä¸ªæ–°çš„æ•°ç»„sum[], å…¶ä¸­å­˜å‚¨çš„æ¯ä¸ªå…ƒç´ sum[i] = a[0]+ a[1] +..a[i],<br/>
ä¹Ÿå°±æ˜¯ sum[0] = a[0], sum[i] = sum[i-1] + a[i]</p>

<pre><code>var sum: [Int] = []
var count: Int = 0
for i in (0..&lt;list.size) {
  if i == 0 {
   sum.append(a[0])
   }else {
     sum.append(sum[i-1] + a[i])
   }
  count += list[i]
  sum.append(count)
}

</code></pre>

<p>ç„¶åæœ€å¤§å­åºåˆ—çš„é—®é¢˜ï¼Œä¹Ÿå°±å˜æˆäº†æ•°ç»„sumä¸­ï¼Œå·®æœ€å¤§çš„ä¸¤ä¸ªå€¼çš„é—®é¢˜ã€‚<br/>
è‹¥æœ€å¤§å­åºåˆ—ä¸º a[left]... a[right], åˆ™ sum[right]ä¸sum[left-1]çš„å·®å€¼ä¹Ÿæ˜¯æœ€å¤§çš„ã€‚</p>

<p>å› æ­¤éœ€è¦æ±‚sumæ•°ç»„ä¸­å·®å€¼æœ€å¤§çš„æƒ…å†µã€‚å½“ç„¶ï¼Œè¦æ±‚ä¸‹æ ‡ right &gt; left</p>

<pre><code>var sum: [Int] = []
for index in 0..&lt;list.count {
    if index == 0 {
        sum.append(list[0])
    }else {
        sum.append(sum[index-1] + list[index])
    }
}

var minValue: Int = 0
var minValueIndex: Int = 0

var max: Int = 0
var left: Int = 0
var right: Int = 0

sum.enumerated().forEach{ (index, value) in
    if minValue &gt; value {
        minValue = value
        minValueIndex = index
    }
    
    let separatedValue = value - minValue
    if separatedValue  &gt; max {
        max = separatedValue
        right = index
        if left != minValueIndex + 1 {
            left = minValueIndex + 1
        }
    }
}


//æœ€ç»ˆï¼Œæœ€å¤§å’Œçš„å­åºåˆ— èµ·å§‹ç‚¹ä¸‹æ ‡ä¸º leftï¼Œ ç»ˆæ­¢ç‚¹ä¸‹æ ‡ä¸ºrightï¼Œå…¶å­åºåˆ—çš„å’Œä¸ºmax
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¯¹äºé¦–é¡µçš„ä¼˜åŒ–]]></title>
    <link href="iginkgo.cn/15324828408733.html"/>
    <updated>2018-07-25T09:40:40+08:00</updated>
    <id>iginkgo.cn/15324828408733.html</id>
    <content type="html"><![CDATA[
<!-- è¿›è¡Œä¸­ -->

<p>å½“å‰é¡µé¢ä¸­å­˜åœ¨çš„é—®é¢˜</p>

<pre><code>switch model.style {
case .news: 
    let cell = tableView.dequeue(&quot;newsCell&quot;) //config
    //...é…ç½®
    return cell
case .video:
     let cell = tableView.dequeue(&quot;videosCell&quot;) //config
    //...é…ç½®
    return cell
case .pic:
     let cell = tableView.dequeue(&quot;picsCell&quot;) //config
    //...é…ç½®
    return cell
case .beauty:
     let cell = tableView.dequeue(&quot;beautyCell&quot;) //config
    //...é…ç½®
    return cell
case .bigImage:
     let cell = tableView.dequeue(&quot;bigImageCell&quot;) //config
    //...é…ç½®
    return cell
default: ...
}
</code></pre>

<p>å®é™…é¡µé¢æ¶‰åŠåˆ°çš„cellç§ç±»ä¸æ­¢è¿™äº›ï¼Œå¹¶ä¸”åœ¨æœªæ¥çš„å¼€å‘è¿‡ç¨‹ä¸­ä¼šéšç€appç‰¹æ€§çš„å¢åŠ è€Œå¢é•¿ï¼Œå› ä¸ºæ¯æ¬¡éœ€è¦ç»´æŠ¤å’Œæ›´æ–°æ—¶å¯¹æ•´ä¸ªå¤§çš„ä»£ç å—è¿›è¡Œä¿®æ”¹å°±ç¼–ç¨‹ä¸€ä¸ªéå¸¸æ‚ä¹±çš„è¿‡ç¨‹ï¼Œç¨æœ‰ä¸æ…è¿˜ä¼šå½±å“æ•´ä½“çš„é€»è¾‘ã€‚é‚£è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨åè®®çš„ç‰¹æ€§è¿›è¡Œè®¾è®¡ã€‚<a href="https://xiaozhuanlan.com/topic/2537681490">ç›¸å…³å‚è€ƒ</a></p>

<p>å®é™…é¡¹ç›®ä¸­å®šä¹‰äº†ä¸€ä¸ªåè®®ï¼Œç”¨æ¥è¡¨ç¤ºæ•´ä¸ªçš„æ•°æ®ç±»å‹</p>

<pre><code class="language-è¡¨ç¤ºæˆ‘ä»¬çš„åŸºæœ¬ç±»å‹ä»¥åŠè½¬æ¢åçš„ç±»å‹">protocol ParseMessageType{
    associatetype: Original
    associatetype: ParseResult
}
</code></pre>

<p>é‚£<code>Original</code>-&gt;<code>ParseResult</code>çš„è½¬æ¢æ­¥éª¤é€šè¿‡ä¸€ä¸ª parseræ¥å®Œæˆï¼Œ å«åš<code>MessageParser</code></p>

<pre><code>protocol MessageParser {
 
 associatetype: Message
 associatetype: Target: ParaseMessageType where Message == Target.Original
    func parse(messgae: Message)-&gt; Target.ParsedResult
}

</code></pre>

<p>å¯¹äºTargetéµå®ˆ ParaseMessageType çš„åè®®ï¼Œ å¹¶ä¸”å®ƒçš„ originalå’Œmessageä¸€è‡´ï¼Œ è¿™å°±å¯¹parseæ–¹æ³•çš„è¿”å›å€¼è¿›è¡Œäº†é™å®šï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­è¿›è¡Œç±»å‹æ£€æŸ¥æ—¶ä¼šè¿›è¡Œä¸¥æ ¼çš„ç±»å‹åŒ¹é…ã€‚</p>

<p>åœ¨å…·ä½“MessageTypeå®ç°çš„è¿‡ç¨‹ä¸­</p>

<pre><code>final class ParsedChatMessage: ParsedMessageType {
    let output: NSAttributedString
    let original: ChatMessage
    
    init(message: ChatMessage){
        original = messgae
        let parser = Parser()
        self.output = parser.parse(message: message)
    }
}

struct Parser: MessageParser {
    typealias Target = ParsedChatMessage
    func parse(message: ChatMeaasge)-&gt; NSAttributeString {
     let reuslt = ...
     return .init(attributedString: result...)
    }
}


</code></pre>

<p>é‚£ä¹ˆå®é™…ä¸­çš„æœ¬åœ°æ•ˆæœå‘¢ï¼š</p>

<p>FeedModel   IndexProtocol   cellViewModel1  cellViewModel2cellViewModel3</p>

<p>åœ¨ feedModelï¼Œ<br/>
åœ¨feedModelä¸­å®ç°fakeModel<br/>
FeedModel-&gt; IndexProtocol<br/>
fakeModel-&gt; IndexProtocol<br/>
TopicModel -&gt; IndexProtocol</p>

<p>å¯¹åº”çš„ä¸åŒçš„cellï¼Œ </p>

<p>æ­¤å¤–ï¼Œéœ€è¦è¿›ä¸€æ­¥å®è·µçš„</p>

<p><a href="http://xiaozhuanlan.com/topic/6104325798">delegateæ”¹è¿›</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é¦–é¡µçš„ä¼˜åŒ–è®°å½•]]></title>
    <link href="iginkgo.cn/15324314483651.html"/>
    <updated>2018-07-24T19:24:08+08:00</updated>
    <id>iginkgo.cn/15324314483651.html</id>
    <content type="html"><![CDATA[
<p>è®°å½•ä¸€ä¸ªå¤æ‚é¡µé¢çš„ä¼˜åŒ–è¿‡ç¨‹</p>

<span id="more"></span><!-- more -->

<h2 id="toc_0">ç¬¬ä¸€æ¬¡ä¼˜åŒ–</h2>

<h3 id="toc_1">å½“å‰ç°çŠ¶</h3>

<p>å½“å‰çš„é¡µé¢æœ‰ä¸‰ä¸ªæ–‡ä»¶</p>

<pre><code>viewController.swift //å¤„ç†äº¤äº’å’Œä¸»ä½“é€»è¾‘
viewController.xib   //å½“å‰é¡µé¢çš„ä¸»è¦view 
viewModel.swift      //å½“å‰é¡µé¢çš„ä¸»è¦ç½‘ç»œè¯·æ±‚ã€æ•°æ®è½¬æ¢ä¸å­˜å‚¨ã€ä¿¡å·
</code></pre>

<p>å½“å‰çš„viewControlleræ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„<strong>â€œMassive view Controllerâ€</strong>.<br/>
æ•´ä¸ªviewConttroller å¤§æ¦‚1000è¡Œä»£ç ã€‚</p>

<p>å¤§ä½“æ¢³ç†ä¸€ä¸‹å…·ä½“çš„å®ç°ï¼š</p>

<ol>
<li><p>åˆå§‹åŒ–æ–¹æ³•<br/>
æ™®é€šviewçš„åˆå§‹åŒ–    10<br/>
tableViewåˆå§‹åŒ–    45<br/>
ç½‘ç»œè¯·æ±‚ï¼ˆå¤±è´¥å’ŒæˆåŠŸçš„UIå˜åŒ–ï¼‰            20<br/>
äº‹ä»¶ç›‘å¬        60è¡Œ</p></li>
<li><p>tableViewä¸­æ¶‰åŠåˆ°çš„cellæœ‰8ç§æ··æ‚ï¼Œ<br/>
ä½¿ç”¨ä»£ç (å¦‚ä¸‹æ–¹ä»£ç )çš„æ–¹å¼è¿›è¡Œè§£æ</p></li>
</ol>

<pre><code>switch viewmodel.list[indexpath.row].style {
case .news: //...
case .video: //...
case .image:// ...
...
}
</code></pre>

<p>å…¶ä¸­æ–¹æ³•<code>cellForRowAtIndex</code>  90è¡Œ<br/>
æ–¹æ³• <code>cellDidSelect</code>  65è¡Œ</p>

<ol>
<li>tableViewä¸ŠæŸäº›cellåŒ…å«UICollectionViewï¼Œéœ€è¦å…·ä½“å®ç°<code>UICollectionDataSource</code>ã€<code>UICollectionDataSource</code>å®ç°   60è¡Œ</li>
<li>tableViewä¸Šå…·ä½“ç‚¹èµæŒ‰é’®ã€å…³æ³¨æŒ‰é’®ã€æ”¶è—æŒ‰é’®ç­‰éœ€è¦å…·ä½“ä½¿ç”¨å›è°ƒæ¥ç›¸åº”   90è¡Œ</li>
<li>å…¶ä½™çš„è¾…åŠ©æ–¹æ³•  å¤§çº¦200è¡Œå·¦å³ã€‚</li>
</ol>

<p>å½“å‰ä»£ç ç»“æ„è¿‡äºé›å®¹ï¼Œåƒã€Šä»£ç å¤§å…¨ã€‹ï¼Œã€Šä»£ç ç®€æ´ä¹‹é“ã€‹ç­‰æ€»ç»“ä»£ç è§„èŒƒçš„ä¹¦ç±ï¼Œé€šå¸¸å»ºè®®ä¸€ä¸ªæ–‡ä»¶ä¸è¦è¶…è¿‡200è¡Œï¼Œæœ€å¤šä¸è¦è¶…è¿‡400è¡Œã€‚ä¸€ä¸ª1000è¡Œå·¦å³çš„æ–‡ä»¶å·²ç»è®©äººè¯»èµ·æ¥éå¸¸åƒåŠ›ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°ä¸šåŠ¡ä¼šç»å¸¸ä¿®æ”¹çš„æƒ…å†µï¼Œæ¸…æ™°çš„è„‰ç»œæ˜¯éå¸¸å¿…è¦çš„ã€‚</p>

<h3 id="toc_2">å½“å‰è¿›è¡Œçš„æ“ä½œ</h3>

<ol>
<li>å°†å„ç§æ¶‰åŠåˆ°cell idendifierï¼Œcell heightç­‰è·Ÿå›ºå®šçš„cellç›¸å…³çš„ä¸€äº›å¸¸é‡ï¼Œå…¨éƒ¨æå–åˆ°cellæœ¬èº«ä»£ç ä¸­å»ã€‚</li>
<li>å»é™¤æ•´ä¸ªé¡µé¢ä¸­çš„é­”å¹»æ•°ï¼ˆçªç„¶å‡ºç°çš„å­—ç¬¦ä¸²ã€å¸¸é‡ç­‰ï¼‰ï¼Œç”¨ä¸€ä¸ªå˜é‡è¿›è¡Œä»£æ›¿ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ª<code>TableViewDataSourceï¼š NSObject, UITableViewDataSource</code>ä½œä¸ºtableViewçš„æ•°æ®æºã€‚å°†å¯¹åº”çš„ä»£ç åˆ‡æ¢è¿‡å»ã€‚</li>
</ol>

<h3 id="toc_3">é‡åˆ°çš„é—®é¢˜</h3>

<p>åœ¨è¿›è¡ŒDataSourceå‰¥ç¦»çš„æ—¶å€™,å‡ºç°tableViewä¸­é«˜åº¦å¤±è°ƒçš„é—®é¢˜ã€‚</p>

<pre><code>//ViewController.swift
tableView.dataSource = TableViewDataSource()
tableView.delegate = self
</code></pre>

<pre><code>//UITableViewDataSource
public func numberOfSections(in tableView: UITableView)-&gt; Int
public func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int
public func tableView(_ tableView: UITableView, cellForRow indexPath: IndexPath)-&gt; UITableViewCell
public func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat
</code></pre>

<p>è°ƒè¯•è®¸ä¹…å‘ç°ï¼Œè¿”å›é«˜åº¦çš„æ–¹æ³•<strong>ä¸å±äº</strong><code>UITableViewDataSouce</code>.<br/>
é—®é¢˜çš„å‘ç”Ÿæºäºæˆ‘çš„ä¸€ä¸ªè§‚å¿µï¼š DataSourceé€šå¸¸æ˜¯ç”¨äºviewåœ¨controllerä¸­è·å–æ‰€éœ€æ•°æ®ã€å†…å®¹ã€viewã€‚ delegateæ˜¯å¤„ç†ä¸€äº›å“åº”ã€ç›‘å¬çš„äº‹ä»¶çš„ã€‚ ä½†æ˜¯ä»è¿™æ¬¡çš„é—®é¢˜æ¥çœ‹ï¼Œæ˜¾ç„¶ä¸æ˜¯å¦‚æ­¤</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ObjectMapperå­¦ä¹ ]]></title>
    <link href="iginkgo.cn/15321858704283.html"/>
    <updated>2018-07-21T23:11:10+08:00</updated>
    <id>iginkgo.cn/15321858704283.html</id>
    <content type="html"><![CDATA[
<p>ObjectMapper<br/>
æœ€è¿‘åœ¨å†™Mirrorçš„æ—¶å€™ï¼Œä¸€ç›´åœ¨è€ƒè™‘å¦‚ä½•è‡ªåŠ¨å®ç°JSON ä¸Objectä¹‹é—´çš„è§£æä¸èµ‹å€¼é—®é¢˜ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œkeyå€¼çš„é…ç½®ã€‚å› æ­¤å¯¹äºå½“å‰Swiftä¸­å¸¸ç”¨çš„å‡ ä¸ªæ¡†æ¶æ¯”è¾ƒå¥½å¥‡ã€‚å› æ­¤æˆ‘æ‰“ç®—è§£è¯»ä¸€ä¸‹ ObjectMapperæ˜¯å¦‚ä½•å®ç°çš„ã€‚ã€‚</p>

<span id="more"></span><!-- more -->

<p>çœ‹ä¸€ä¸‹ObjectMapperçš„ç»“æ„</p>

<pre><code>Map.swift
Mapper.swift
Mappable.swift
MapError.swift

...Transform.swift


</code></pre>

<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹ä¸»è¦çš„èŒèƒ½éƒ¨åˆ†</p>

<h3 id="toc_0">Mapper</h3>

<p>Mapperæ˜¯ä¸€ä¸ªæ“ä½œç±»ï¼Œç”¨äºæ“ä½œæœ¬åœ°èµ‹äºˆçš„å„ç§æ•°å€¼ï¼Œlist, dictionaryç­‰ä¸åŒçš„ç±»å‹ï¼Œå°†ç±»å‹ç»Ÿä¸€å ç”Ÿæˆå¯¹åº”çš„Mapè¿›è¡Œèµ‹å€¼æ“ä½œã€‚<br/>
å®ƒæ˜¯æ§åˆ¶æ•´ä¸ªè½¬æ¢æ“ä½œè¿‡ç¨‹ä¸­æœ€å¤§çš„æ“ä½œç±»ã€‚</p>

<p>//TODO: éœ€è¦ç”»å›¾è¿›è¡Œæ¼”ç¤ºã€‚</p>

<h4 id="toc_1">ä¸»è¦æ–¹æ³•</h4>

<p>æ–¹æ³•åˆ—è¡¨ä¸­çš„æ–¹æ³•ä¸»è¦æ˜¯å…¼å®¹å¯èƒ½å‡ºç°çš„å„ç§è¾“å…¥å½¢å¼ï¼Œå¹¶æœ€ç»ˆåˆ†æç›®æ ‡ç±»å‹çš„å…ƒç´ æˆ–è€…listï¼Œ dictionaryç­‰ã€‚</p>

<pre><code>//class Mapper&lt;N: BaseMappable&gt;
//æ³›å‹Nè¡¨ç¤ºç›®æ ‡ç±»å‹
public func map(JSONObject: Any?, toObject object: N) -&gt; N
public func map(JSONString: String, toObject object: N) -&gt; N
public func map(JSON: [String : Any], toObject object: N) -&gt; N
public func map(JSONString: String) -&gt; N?
public func map(JSONObject: Any?) -&gt; N?
public func map(JSON: [String : Any]) -&gt; N?
public func mapArray(JSONString: String) -&gt; [N]?
public func mapArray(JSONObject: Any?) -&gt; [N]?
public func mapArray(JSONArray: [[String : Any]]) -&gt; [N]
public func mapDictionary(JSONString: String) -&gt; [String : N]?
public func mapDictionary(JSONObject: Any?) -&gt; [String : N]?
public func mapDictionary(JSON: [String : [String : Any]]) -&gt; [String : N]?
public func mapDictionary(JSONObject: Any?, toDictionary dictionary: [String : N]) -&gt; [String : N]
public func mapDictionary(JSON: [String : [String : Any]], toDictionary dictionary: [String : N]) -&gt; [String : N]
public func mapDictionaryOfArrays(JSONObject: Any?) -&gt; [String : [N]]?
public func mapDictionaryOfArrays(JSON: [String : [[String : Any]]]) -&gt; [String : [N]]?
 public func mapArrayOfArrays(JSONObject: Any?) -&gt; [[N]]?
public static func parseJSONStringIntoDictionary(JSONString: String) -&gt; [String : Any]?
public static func parseJSONString(JSONString: String) -&gt; Any?
</code></pre>

<h3 id="toc_2">Map</h3>

<p>Map æä¾›ä¸€ä¸ªåŸºç¡€çš„å®¹å™¨ï¼Œ åœ¨è·å–JSONå†…å®¹æˆ–è€…Objectä¹‹åï¼Œæä¾›ä¸€äº›åŸºæœ¬çš„çŠ¶æ€æ ‡è¯†ï¼Œæ•°æ®å­˜å‚¨</p>

<h4 id="toc_3">å…³é”®å±æ€§</h4>

<pre><code>public internal(set) var JSON: [String: Any] = [:] //å­˜æ”¾è¦æ“ä½œçš„json
public internal(set) var isKeyPresent = false// å½“å‰keyå€¼å¯¹åº”çš„å€¼æ˜¯å¦å­˜åœ¨
public internal(set) var currentValue: Any? //å½“å‰keyå€¼æ‰€å¯¹åº”çš„valueå€¼
public internal(set) var currentKey: String? //å½“å‰çš„keyå€¼
</code></pre>

<p>ä¸¾äº†ä¾‹å­å†è¿›è¡Œè¯´æ˜<br/>
å¯¹äºä¸€ä¸ªå¯¹è±¡è¿›è¡Œè½¬åŒ–æ—¶ï¼Œ</p>

<pre><code>class Person: Mappable {
var age: Int?
var gender: String?
var height: Double?

func mapping(map: Map){
  age &lt;- map[&quot;age&quot;]
    gender &lt;- map[&quot;gender&quot;]
    height &lt;_ map[&quot;height&quot;]
}
}
</code></pre>

<p>è°ƒç”¨æ–¹æ³•</p>

<pre><code>Mapper&lt;Person&gt;().map(json: JSON) //ç”Ÿæˆå¯¹è±¡
</code></pre>

<p>è¿™è¾¹åœ¨è¿›è¡Œè½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºä¸€ä¸ªjsonï¼Œç”Ÿæˆä¸€ä¸ªMapç”¨äºå­˜å‚¨jsonå¹¶è¿›è¡Œç®€å•çš„æ•°æ®æ“ä½œã€‚ åœ¨å¯¹äºå…·ä½“å±æ€§è¿›è¡Œé…ç»™æ—¶ï¼Œ<br/>
å…·ä½“çš„æ­¥éª¤<br/>
1. å¤„ç†<code>age &lt;- map[&quot;age&quot;]</code>æ—¶ï¼Œ æ•´ä¸ªmapçš„å¯¹è±¡åœ¨map[â€œageâ€]çš„æ–¹æ³•æ—¶ï¼Œ è°ƒç”¨ä¸‹æ ‡æ–¹æ³•ï¼Œ è®¾ç½® currentKey = â€œageâ€ï¼Œ currentValue = json[â€œageâ€], ç”±äºè¦æŸ¥æ‰¾çš„keyå€¼åœ¨jsonä¸­ç¡®å®å­˜åœ¨ï¼ŒisKeyPresent = true<br/>
2. å¤„ç†<code>gender&lt;-map[&quot;gender&quot;]</code>, åŠ å…¥jsonè¿™ä¸ªå­—å…¸ä¸­ä¸å­˜åœ¨json[â€œgenderâ€],<br/>
åˆ™å½“å‰ <code>isKeyPresent=false</code>, currentValue = nil<br/>
3. å¤„ç†heightå€¼æ—¶ï¼Œä½¿ç”¨ç›¸åŒçš„é€»è¾‘è¿›è¡Œå¤„ç†</p>

<p>ä¸»è¦æ–¹æ³•</p>

<pre><code>init(json: [String:Any],...) //è¿›è¡Œjsonçš„èµ‹å€¼
subscript() //ä¸‹æ ‡çš„æ–¹æ³•ï¼Œæœ¬èº«çŠ¶æ€ç»è¿‡ä¸€å®šçš„ä¿®æ­£ï¼Œè·å–ä¸‹æ ‡åœ¨jsonä¸­å¯¹åº”çš„å€¼ï¼Œç„¶åè¿”å›æœ¬èº«
func value&lt;T&gt;()-&gt; T? // å°†subscripyä¸­è·å–çš„å€¼ï¼Œåˆ¤æ–­æ˜¯å¯è½¬ä¸ºç”¨äºéœ€è¦çš„ç±»å‹ï¼Œå¹¶è½¬æ¢ã€‚

</code></pre>

<p>è¿™ä¸ªéƒ¨åˆ†ä¸­çš„valueæ–¹æ³•æ˜¯æˆ‘éå¸¸æ„Ÿå…´è¶£çš„åœ°æ–¹ã€‚ å› ä¸ºæ•´ä¸ªMapæ–‡ä»¶åªæœ‰è¿™ä¸€ä¸ªåœ°æ–¹æ¶‰åŠåˆ°æ³›å‹çš„é—®é¢˜ï¼Œè€Œæˆ‘å¥½å¥‡çš„æ˜¯ï¼Œæ³›å‹çš„ç±»å‹æ˜¯å¦‚ä½•è¿›è¡Œæ¨æ–­çš„ã€‚</p>

<pre><code>public func value&lt;T&gt;() -&gt; T? {
    let value = currentValue as? T 
  ...
    ... 
    ...
}
</code></pre>

<p>è¿™ä¸ªç±»å‹è½¬æ¢ä¸­ï¼Œæœ€ç»ˆè¿›è¡Œåˆ¤æ–­çš„ç±»å‹æ˜¯å¦‚ä½•ç¡®å®šçš„å‘¢ï¼Ÿ</p>

<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç›¸å…³çš„è°ƒç”¨æ–¹æ³•ï¼š</p>

<pre><code>//Operator.swift
public func &lt;- &lt;T&gt;(left: inout T, right: Map) {
    switch right.mappingType {
    case .fromJSON where right.isKeyPresent:
        FromJSON.basicType(&amp;left, object: right.value()) //æ³¨æ„
    case .toJSON:
        left &gt;&gt;&gt; right
    default: ()
    }
}
</code></pre>

<pre><code>//FromJSON.swift
internal final class FromJSON {
    class func basicType&lt;FieldType&gt;(_ field: inout FieldType, object: FieldType?) {}
}
</code></pre>

<p>é‚£è®©æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹æ³›å‹Tçš„æ¨æ–­è¿‡ç¨‹</p>

<pre><code>func &lt;- &lt;T&gt;(left: inout T, right: Map)
func basicType&lt;FieldType&gt;(_ field: inout FieldType, object: FieldType?)
func value&lt;T&gt;()-&gt; T?
</code></pre>

<p>ç °ç °ï¼Œåˆ’é‡ç‚¹ï¼š<br/>
basicTypeæ–¹æ³•å£°æ˜äº†ä¸€ä¸ªæ³›å‹ï¼Œçº¦æŸè¾“å…¥çš„ä¸¤ä¸ªå‚æ•°å±æ€§åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚<br/>
è€Œåœ¨Operator.swiftä¸­çš„æ–¹æ³•ï¼Œleftè¿™ä¸ªå‚æ•°ç±»å‹ å’Œ right.value()ç±»å‹ç›¸åŒã€‚<br/>
ç”±äºvalue()è¿™ä¸ªæ–¹æ³•å£°æ˜ä¸ºä¸€ä¸ªæ³›å‹ï¼Œè¿™ä¸ªç±»å‹æ˜¯éœ€è¦è¢«æ¨æ–­å‡ºæ¥çš„ï¼Œå› æ­¤æœ€ç»ˆç¡®å®šæ˜¯éœ€è¦é€šè¿‡ leftçš„å±æ€§æ¥ç¡®å®šã€‚<br/>
å³ï¼š <strong>æ ¹æ®æ“ä½œç¬¦</strong><code>&lt;-</code><strong>çš„åšå‚æ•°çš„å±æ€§æ¥ç¡®å®šè¿”å›å€¼çš„ç±»å‹</strong><br/>
æˆ‘è®¤ä¸ºè¿™æ˜¯ç±»å‹æ¨æ–­éå¸¸å¼ºå¤§çš„ä¸€ç‚¹ã€‚</p>

<p>åŒæ ·çš„, æˆ‘åœ¨playgroundä¸Šå®éªŒäº†ç±»ä¼¼çš„ä¾‹å­ï¼Œè¯´æ˜ç¼–è¯‘å™¨å¯¹äºæ³›å‹ä¸­ç±»å‹çš„æ¨å¯¼å…·æœ‰å»¶ç»­æ€§ã€‚<br/>
å†™ä¸€ä¸ªæ³›å‹ç±»å‹æ¨å¯¼çš„ä¾‹å­<a href="https://github.com/DroidDreamer/codeDaily/blob/master/Generic%20type%20inference.playground/Contents.swift">æ³›å‹ä¾‹å­</a><br/>
//TODO: æ­¤å¤„æ·»åŠ ç±»ä¼¼çš„ä»£ç ã€‚Generic type inference</p>

<p>â€¦Transform: é’ˆå¯¹ç‰¹å®šçš„ç±»å‹è®¾ç½®è½¬æ¢è§„åˆ™</p>

<p>//TODO: æœªå®Œå¾…ç»­</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swiftä¸­çš„åå°„  Mirror (ä¸Š) è®¤è¯†å’ŒåŸºæœ¬ä½¿ç”¨]]></title>
    <link href="iginkgo.cn/15321351019730.html"/>
    <updated>2018-07-21T09:05:01+08:00</updated>
    <id>iginkgo.cn/15321351019730.html</id>
    <content type="html"><![CDATA[
<span id="more"></span><!-- more -->

<h2 id="toc_0">ç®€ä»‹</h2>

<blockquote>
<p>Reflection: In computer science, reflection is the ability of a computer program to examine, introspect, and modify its own structure and behavior at runtime     --wikipedia</p>
</blockquote>

<!-- more -->

<p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œåå°„æŒ‡çš„æ˜¯åœ¨è®¡ç®—æœºç¨‹åºåœ¨è¿è¡Œæ—¶ æ£€æŸ¥ï¼Œintrospectï¼Œ ä¿®æ”¹è‡ªèº«ç»“æ„ä»¥åŠè¡Œä¸ºçš„èƒ½åŠ›ã€‚</p>

<p><a href="https://en.wikipedia.org/wiki/Reflection_(computer_programming)">wikipediaä»‹ç»</a></p>

<p>åœ¨æ­£å¸¸çš„iOSå¼€å‘ä¸­ï¼Œç”±äºOCè¯­è¨€æœ‰ç€å¼ºå¤§çš„è¿è¡Œæ—¶ç‰¹æ€§ï¼Œå®ƒçš„èƒ½åŠ›è¦æ¯”åå°„é«˜çš„å¤šï¼Œå› æ­¤åœ¨è¿‡å»OCå®ç°çš„iOSé¡¹ç›®ä¸­å¹¶ä¸å¤šè§ã€‚ Swiftä½œä¸ºä¸€ä¸ªæ ‡å‡†ä¸”å¼ºå¤§çš„é™æ€è¯­è¨€ï¼Œæœ¬èº«å¹¶æ²¡æœ‰runtimeçš„ç›¸å…³èƒ½åŠ›ï¼Œåªæä¾›äº†<code>Mirror</code>æ¥å®ç°ä¸€äº›åå°„çš„ç‰¹æ€§ã€‚</p>

<h2 id="toc_1">MirroråŸºæœ¬ä»‹ç»</h2>

<p><a href="https://developer.apple.com/documentation/swift/mirror">å®˜æ–¹æ–‡æ¡£</a></p>

<h3 id="toc_2">è¡¨è¿°ï¼šA representation of the substructure and display style of an instance of any type.</h3>

<p>å¯¹äºä¸€ç§ç±»å‹å†…éƒ¨ç»“æ„çš„æè¿°ä»¥åŠå…·ä½“å®ä¾‹çš„å±•ç¤ºç±»å‹</p>

<h3 id="toc_3">åˆ›å»º</h3>

<pre><code>class Car {
    var price: Int
    var color: String = &quot;red&quot;
    
    init(price: Int) {
        self.price = price
    }
}

let car = Car(price: 20000)
let mirror = Mirror(reflecting: car)
</code></pre>

<p>ä½¿ç”¨<code>Mirror</code>çš„<code>reflecting</code>æ–¹æ³•ï¼Œä¼ å‡ºä¸€ä¸ªé™æ€çš„å®ä¾‹ï¼Œ è·å–è¯¥å®ä¾‹ç±»å‹çš„åå°„ç»“æœ</p>

<h3 id="toc_4">å†…éƒ¨ç»“æ„</h3>

<h4 id="toc_5">property</h4>

<pre><code>let children: Mirror.Children
A collection of Child elements describing the structure of the reflected subject.

var customMirror: Mirror
var description: String
let displayStyle: Mirror.DisplayStyle?
A suggested display style for the reflected subject.

let subjectType: Any.Type
The static type of the subject being reflected.

var superclassMirror: Mirror?
A mirror of the subjectâ€™s superclass, if one exists.

</code></pre>

<p>å…¶ä¸­éœ€è¦é‡ç‚¹ä»‹ç»çš„æ˜¯ <code>Mirror.children</code></p>

<pre><code> typealias Mirror.Child = (label: String?, value: Any)
 typealias Mirror.Children = AnyCollection&lt;Mirror.Child&gt;
</code></pre>

<p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨Mirrorçš„åå°„æ¥è·å–ä¸€ä¸ªç±»å‹çš„å†…éƒ¨å˜é‡ï¼Œéƒ½æ˜¯é€šè¿‡<code>Mirror.Child</code>æ¥è·å–çš„ã€‚<br/>
 å¯¹äºå†…éƒ¨å˜é‡ï¼Œ <code>label</code>ç”¨äºè¡¨è¿°å…¶å†…éƒ¨å‚æ•°åï¼Œ <code>value</code> è¡¨ç¤ºå…¶å‚æ•°å€¼ã€‚<br/>
 ä¸‹é¢æˆ‘ä»¬å†™ä¸€ä¸ªä¾‹å­ï¼Œè¿›è¡Œè§‚å¯Ÿ</p>

<p>ç¤ºä¾‹</p>

<pre><code> for item in mirror.children {
    print(&quot;å½“å‰å±æ€§åä¸º\(item.label), å±æ€§çš„å€¼ä¸º\(item.value)&quot;)
}
</code></pre>

<p>å…¶è¾“å‡ºç»“æœä¸ºï¼š<br/>
å½“å‰å±æ€§åä¸ºOptional(&quot;price&quot;), å±æ€§çš„å€¼ä¸º20000<br/>
å½“å‰å±æ€§åä¸ºOptional(&quot;color&quot;), å±æ€§çš„å€¼ä¸ºred</p>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°ï¼ŒMirror.child ä½œä¸ºä¸€ä¸ª tupleï¼Œå…¶ç¬¬ä¸€ä¸ªå±æ€§<code>label</code>æ˜¯ä¸€ä¸ªå¯é€‰å‹ã€‚è¿™æ˜¯å› ä¸ºMirroræ”¯æŒçš„ç±»å‹å¾ˆå¤šï¼Œåé¢ä¼šè¿›ä¸€æ­¥ä»‹ç»ï¼Œ å¯¹äºä¸€ä¸ª <code>Array</code> è¿›è¡Œåå°„ï¼Œåªä¼šå¯¹å±æ€§å€¼è¿›è¡Œå±•ç¤ºï¼Œå´æ²¡æœ‰å±æ€§åï¼Œ è¿™ç§æƒ…å†µä¸‹ å±æ€§åæ˜¯ä¼šä¸ºç©ºçš„ã€‚</p>

<h4 id="toc_6">descendant</h4>

<p>è¿”å›ç»™å®šè·¯å¾„çš„å¯¹è±¡ï¼Œå¦‚æœè·¯å¾„é”™è¯¯ï¼Œåˆ™è¿”å›ä¸ºnilã€‚</p>

<pre><code>func descendant(MirrorPath, MirrorPath...) -&gt; Any?
Returns a specific descendant of the reflected subject, or nil if no such descendant exists.

protocol MirrorPath
A protocol for legitimate arguments to Mirrorâ€™s descendant method.
</code></pre>

<p>è¿™ä¸ªæ–¹æ³•ä»‹ç»ç»™æœ‰å¤šå±‚ç±»å‹åµŒå¥—çš„æƒ…å†µ<br/>
ä¾‹å¦‚ï¼Œæˆ‘ä»¬å…ˆé‡æ–°ä¿®æ”¹ è¦æ£€æµ‹çš„å®ä¾‹ç±»å‹,åœ¨<code>Car</code>ä¸­åµŒå¥—ä¸€ä¸ªclassã€‚</p>

<pre><code>class Driver {
    var gender: String = &quot;ç”·&quot;
    var age: Int = 30
}

class Car {
    var price: Int
    var color: String = &quot;red&quot;
    var driver = Driver()
    
    init(price: Int) {
        self.price = price
    }
}

let car = Car(price: 20000)
let carMirror = Mirror(reflecting: car)
let mirror = Mirror(reflecting: car)
for item in mirror.children {
    print(&quot;å½“å‰å±æ€§åä¸º\(item.label), å±æ€§çš„å€¼ä¸º\(item.value)&quot;)
}
</code></pre>

<p>å®é™…æƒ…å†µæ˜¯ï¼Œå¯¹äº driverè¿™ä¸ªå±æ€§ï¼Œæ— æ³•è¿›è¡Œæ¸…æ™°çš„è¡¨è¿°<br/>
è¾“å‡ºç»“æœï¼š<br/>
å½“å‰å±æ€§åä¸ºOptional(&quot;price&quot;), å±æ€§çš„å€¼ä¸º20000<br/>
å½“å‰å±æ€§åä¸ºOptional(&quot;color&quot;), å±æ€§çš„å€¼ä¸ºred<br/>
å½“å‰å±æ€§åä¸ºOptional(&quot;driver&quot;), å±æ€§çš„å€¼ä¸º__lldb_expr_14.Driver</p>

<p>æ­¤æ—¶ç¬¬ä¸‰æ¡driverï¼Œå°±æ˜¯ç›´æ¥æ‰“å°çš„driverçš„å¯¹è±¡ã€‚<br/>
å½“ç„¶ï¼Œå¦‚æœéœ€è¦å¯¹driverè¿›è¡Œè¿›ä¸€æ­¥è¾“å…¥ï¼Œå°±è¦ç»§ç»­å‘ä¸‹åšä¸‹å»äº†ã€‚</p>

<p><code>descendant</code> è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›ç»™å®šè·¯å¾„çš„å±æ€§å€¼ã€‚<br/>
ä¾‹å¦‚ï¼š</p>

<pre><code>let gender = mirror.descendant(&quot;driver&quot;, &quot;gender&quot;)
print(gender)car
</code></pre>

<p>è¾“å‡ºç»“æ„ä¸º Optional(30)</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[éšæƒ³ç³»åˆ—(-)]]></title>
    <link href="iginkgo.cn/15319270059690.html"/>
    <updated>2018-07-18T23:16:45+08:00</updated>
    <id>iginkgo.cn/15319270059690.html</id>
    <content type="html"><![CDATA[
<p>æœ€è¿‘èµ°ä¸Šä¸Šç­çš„è·¯ä¸Šï¼Œå¸¸å¸¸ä¼šè§¦å‘ä¸€äº›è”æƒ³ã€‚è¿™å¯èƒ½å°±æ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„ä¹¦å¤šäº†ï¼Œå°±ä¼šè§¦å‘è·¨åŒºåŸŸçš„ä¼ è¾“ã€‚</p>

<p>ä»Šå¤©æ€è€ƒäº†ä¸ªé—®é¢˜ï¼Œ <strong>äººä¸ºä»€ä¹ˆè¦å­¦ä¹ å‘¢ï¼Ÿ</strong><br/>
æœ€è¿‘ä¸¤å¤©ä¹Ÿåœ¨åˆ·ç®—æ³•çš„ä¸€äº›é—®é¢˜ã€‚å‘ç°å¾ˆå¤šé—®é¢˜çš„è§£å†³ç¡®å®æ˜¯éœ€è¦ä¸€äº›å¥‡æ€å¦™æƒ³ï¼Œè¿™äº›å¤©é©¬è¡Œç©ºçš„æ€æƒ³éœ€è¦ä¸€ä¸ªå“è¶Šçš„å¤§è„‘æ¥å®ç°ã€‚ç„¶è€Œå¤§éƒ¨åˆ†ç®—æ³•çš„å®ç°éƒ½æ˜¯æœ‰<strong>å¥—è·¯</strong>çš„ã€‚ä½œä¸ºæ™®é€šåŠ³åŠ¨åŠ›é‡Œçš„æˆ‘ï¼Œä¹Ÿå°±åªèƒ½é€šè¿‡ä¸æ–­çš„æ¥è§¦å’Œå®è·µæ‰èƒ½æ…¢æ…¢æŒæ¡ã€‚<br/>
è¿™é‡Œå°±æŠŠè§£é¢˜çš„äººåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šèªæ˜äººå’Œå¹³åº¸çš„äººã€‚ <br/>
é’ˆå¯¹ä¸€ä¸ªé—®é¢˜ï¼Œèªæ˜äººå¯èƒ½ç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œå¹³åº¸çš„äººå‘¢ï¼Œè¦é’ˆå¯¹ç»™å‡ºçš„ç»†èŠ‚ï¼Œè¿›è¡Œåå¤çš„æ€è€ƒã€‚<br/>
è¿™é‡Œå°±ä½“ç°äº†ä¸åŒçš„äººï¼Œä»–çš„æ€ç»´æ·±åº¦å’Œå¹¿åº¦ã€‚<br/>
æ€ç»´çš„æ·±åº¦æŒ‡çš„æ˜¯ï¼Œé’ˆå¯¹ä¸€ä¸ªä¸€äº›åº•å±‚æ¡ä»¶å’Œç»†èŠ‚ï¼Œæ˜¯å¦èƒ½å¤Ÿæ¨æ–­å‡ºé«˜å±‚æ¬¡çš„ç»“è®ºï¼Œè¿›è€Œç”±è¿™äº›é«˜å±‚æ¬¡çš„ç»“è®ºï¼Œæ¨æ–­å‡ºæƒ³è¦çš„ç»“æœã€‚ è¿™ä¸ªå·²çŸ¥æ¡ä»¶å®ç°çš„â€œå‡çº§â€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶å¸¸è¯´çš„çŸ¥è¯†ç‚¹äº†ã€‚å¯¹äºä¸äº†è§£è¿™äº›çŸ¥è¯†ç‚¹çš„äººï¼Œå¯¹äºé‚£äº›åº•å±‚çš„ç»†èŠ‚ï¼Œä¹Ÿéƒ½æ˜¯æŸæ‰‹æ— ç­–çš„ã€‚<br/>
æˆ‘åˆæƒ³åˆ°ä»¥å‰è®¨è®ºçš„å¾ˆç«çƒ­çš„ä¸€ä¸ªé—®é¢˜â€ç°åœ¨æœç´¢è½¯ä»¶å·²ç»è¿™ä¹ˆæ–¹ä¾¿äº†ï¼Œå¯ä»¥ç›´æ¥åœ¨ç½‘ç»œæœç´¢æˆ‘éœ€è¦çš„ç»“æœï¼Œé‚£æˆ‘è¿˜è¦èŠ±æ—¶é—´å­¦ä¹ ï¼Œæœ‰å¿…è¦å—?â€œ  æˆ‘çš„ç»“è®ºæ˜¯â€”â€”éå¸¸æœ‰å¿…è¦ã€‚<br/>
courseraä¸Šæœ‰ä¸€é—¨è¯¾ç¨‹ï¼Œå«åšã€ŠLearn How to learnã€‹, é‡Œé¢ä»‹ç»äº†å­¦ä¹ çŸ¥è¯†çš„ä¸€ç§ç†è®ºï¼š æˆ‘ä»¬å­¦ä¹ çš„ä¸œè¥¿åœ¨å¤§è„‘ä¸­å°±æ˜¯ä¸€ä¸ªç‚¹ï¼Œä¸è¯¥çŸ¥è¯†ç›¸å…³çš„çŸ¥è¯†å°±æ˜¯å¦å¤–ä¸€ä¸ªç‚¹ï¼Œå½“æˆ‘ä»¬å­¦ä¹ å¹¶æ·±åŒ–ä¹‹åï¼Œä¸¤ä¸ªç‚¹å°±ä¼šå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œåœ¨å¤§è„‘æ€è€ƒé—®é¢˜æ—¶ï¼Œè€ƒè™‘åˆ°æŸä¸ªç‚¹ï¼Œå°±å¾ˆè‡ªç„¶çš„é€šè¿‡è¿æ¥åˆ°è¾¾å…¶ä»–çš„ç›¸å…³çŸ¥è¯†ç‚¹ã€‚è¿™å°±æ˜¯æ¨è®ºã€è”æƒ³ã€‚è¿æ¥æ˜¯å¯ä»¥é€šè¿‡ä¸æ–­çš„æ€è€ƒï¼Œç»ƒä¹ æ¥å¼ºåŒ–çš„ã€‚è¿™æ ·ï¼Œéšç€ç‚¹çš„è¶Šæ¥è¶Šå¤šï¼Œè¿æ¥çš„è¶Šæ¥è¶Šå¤šï¼Œæœ€ç»ˆå½¢æˆäº†ç‰¢å›ºçš„çŸ¥è¯†ä½“ç³»ã€‚æˆ‘ä»¬åœ¨è€ƒè™‘ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥è—‰ç”±è¿™ä¸ªçŸ¥è¯†ç½‘ç»œåˆ°è¾¾ä½“ç³»å†…çš„ä»»æ„ä¸€ç‚¹ã€‚è¿™ä¹Ÿä»£è¡¨äº†åœ¨æŸä¸€ä¸ªé¢†åŸŸå†…çš„å¹¿åº¦å’Œæ·±åº¦ã€‚è€Œè¿™ä¸€ç‚¹æ˜¯å¾ˆéš¾é€šè¿‡ç½‘ç»œå¼•æ“æ¥æ›¿ä»£ã€‚<br/>
å›åˆ°è§£é¢˜çš„é—®é¢˜ä¸Šæ¥ï¼ŒçŸ¥è¯†ä½“ç³»ä¸°å¯Œçš„äººï¼Œå¯¹äºç°æœ‰çš„æ¡ä»¶ï¼Œå¾ˆå®¹æ˜“åœ¨ç½‘ç»œä¸­å¯»æ‰¾ç›¸å…³çš„ä¿¡æ¯ï¼Œåˆ©ç”¨è¿™äº›ç›¸å…³ä¿¡æ¯æ¥å¤„ç†é—®é¢˜ã€‚è€Œä½“ç³»ç‹­çª„ï¼Œèç¼©çš„äººï¼Œæƒ³ç ´è„‘è¢‹ä¹Ÿå¾ˆéš¾æƒ³çš„å‡ºæ¥ï¼Œä¸´æ—¶ä½¿ç”¨æœç´¢å¼•æ“ï¼Œé’ˆå¯¹ç›¸å…³çš„çŸ¥è¯†è¿›è¡Œå­¦ä¹ ï¼Œå…¶æŒ‘é€‰ã€å¸æ”¶çš„è¿‡ç¨‹å°±éœ€è¦å¾ˆå¤§çš„æˆæœ¬ã€‚</p>

<p>æˆ‘å½“å‰å¸Œæœ›è‡ªå·±åšçš„ï¼Œå°±æ˜¯ä¸æ–­å¼ºåŒ–å’Œå»¶ä¼¸è¿™æ ·çš„çŸ¥è¯†ç½‘ç»œã€‚</p>

<p>ç¬¬äºŒä¸ªæƒ³æ³•å‘¢ï¼Œ æ¯å¤©åšä¸€ä»¶è®©è‡ªå·±èµå¹çš„äº‹æƒ…å§ã€‚è®©è‡ªå·±çš„ä¸€å¤©æ˜¾å¾—ä¸ä¼—ä¸åŒã€‚<br/>
ç¬¬ä¸‰ä¸ªæƒ³æ³•å‘¢ å…‹æœä¹ æƒ¯çš„æƒ¯æ€§ï¼Œå…‹æœæ¬²æœ›ã€‚å®Œæˆä¸€ä¸ªå®Œæ•´çš„æµç¨‹ï¼Œå¥½å¥½çš„åšå®Œä¸€ä»¶äº‹ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WWDC 2018 Swift 4.2 æ–°ç‰¹æ€§]]></title>
    <link href="iginkgo.cn/15282735197620.html"/>
    <updated>2018-06-06T16:25:19+08:00</updated>
    <id>iginkgo.cn/15282735197620.html</id>
    <content type="html"><![CDATA[
<span id="more"></span><!-- more -->

<p><a href="https://devstreaming-cdn.apple.com/videos/wwdc/2018/401ieeclipzse3tz3fg/401/401_hd_whats_new_in_swift.mp4?dl=1">è§†é¢‘ä¸‹è½½åœ°å€</a></p>

<ul>
<li>
<a href="#toc_0">ä¼˜åŒ–</a>
</li>
<li>
<a href="#toc_1">åœ¨ç¼–è¯‘æ–¹ä¾¿çš„ä¼˜åŒ–</a>
<ul>
<li>
<a href="#toc_2">Compliation Mode</a>
</li>
<li>
<a href="#toc_3">Optimization Level</a>
</li>
</ul>
</li>
<li>
<a href="#toc_4">Swiftè¯­è¨€ç‰¹æ€§</a>
<ul>
<li>
<a href="#toc_5">CaseIterableåè®®</a>
</li>
<li>
<a href="#toc_6">éšæœºæ•°ç”Ÿæˆä»¥åŠæ‰“ä¹±æ“ä½œ</a>
</li>
<li>
<a href="#toc_7">Enhanced conditional conformances</a>
<ul>
<li>
<a href="#toc_8">è¿è¡Œæ—¶çš„ç±»å‹è¯¢é—®</a>
</li>
<li>
<a href="#toc_9">Optionalã€Arrayã€Dictionaryç­‰å¯¹åè®®çš„é»˜è®¤å®ç°</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_10">Hashableï¼ˆæœªå®Œå¾…ç»­ï¼‰</a>
</li>
</ul>


<p>ä¸å¾—ä¸èµå¹ä¸€å¥ Xcode10ä¸‹çš„playgroundè¿è¡Œèµ·æ¥çœŸæ˜¯æ¯”ä»¥å‰å¥½åˆ°ä¸è¡Œ</p>

<h2 id="toc_0">ä¼˜åŒ–</h2>

<p><code>TODO: å¾…è¡¥å……</code></p>

<h2 id="toc_1">åœ¨ç¼–è¯‘æ–¹ä¾¿çš„ä¼˜åŒ–</h2>

<p><img src="media/15282735197620/1D720CC705576DB05D71C805EFE2BBB6.jpg" alt="1D720CC705576DB05D71C805EFE2BBB6"/></p>

<p>ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢</p>

<h3 id="toc_2">Compliation Mode</h3>

<p>åœ¨debugæ¨¡å¼ä¸‹å»ºè®®å¼€å§‹<code>Incremental</code>æ¨¡å¼ï¼Œä¼šå¤§å¤§æå‡æ•ˆç‡<br/>
 <code>Whole Module</code>æ¨¡å¼æ„å‘³ç€åœ¨æ¯æ¬¡buildä¼šå°†å…¨å±€è¿›è¡Œbuildï¼Œè€—æ—¶è¾ƒé•¿</p>

<h3 id="toc_3">Optimization Level</h3>

<p>å…¶ä¸­æœ‰3ä¸ªé€‰é¡¹ <code>No optimization[-Onone]</code>,<code>Optimize for Speed [-O]</code>,<code>Optimize for Size[-Osize]</code><br/>
å…¶ä¸­<code>Optimize for Size</code>æ¨¡å¼æ˜¯è¿™æ¬¡æ›´æ–°çš„ä¸€å¤§ä¸»é¢˜<strong>Code Size</strong>çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨å¼€å¯ä¹‹åï¼Œ Code sizeå¯èƒ½ä¼šå‡å°‘ 10% - 30%ï¼Œ ä½†æ˜¯è¿è¡Œæ—¶çš„ç‰¹æ€§å¯èƒ½ä¼šé™ä½ 5%ã€‚</p>

<h2 id="toc_4">Swiftè¯­è¨€ç‰¹æ€§</h2>

<h3 id="toc_5">CaseIterableåè®®</h3>

<p>swiftä¸­çš„æšä¸¾ç±»å‹åœ¨å®ç°CaseIterableåè®®åï¼Œå¯ä»¥å¯¹æ¯ä¸ªcaseè¿›è¡Œéå†æ“ä½œã€‚å…¶å…·ä½“æ“ä½œå¦‚ä¸‹</p>

<p><img src="media/15282735197620/F24356323AB18A4707FDC96E96D35FB8.jpg" alt="F24356323AB18A4707FDC96E96D35FB8"/></p>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>FamilyMember</code> è¿™ä¸ªæšä¸¾ç±»å‹åœ¨å®ç°CaseIterableåè®®ä¹‹åï¼Œ swiftè‡ªåŠ¨ä¸ºå…¶æ·»åŠ äº†é™æ€å˜é‡</p>

<pre><code>static var allCase: [FamilyMember] {
    return  [.father, .mother, .brother, .sister]
}
</code></pre>

<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºæšä¸¾ç±»å‹ä¸­æœ‰å…³è”å˜é‡çš„æƒ…å†µï¼Œç³»ç»Ÿä¸ä¼šè‡ªåŠ¨å®ç°allCaseã€‚</p>

<p>æ¯”å¦‚ ä¸‹å›¾ä¸­<code>case porsche(convertible: Bool)</code>æ¶‰åŠäº†å…³è”å˜é‡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦åƒå›¾ä¸­çš„æ³¨é‡Šæ‰çš„ä»£ç é‚£æ ·è‡ªå·±ç”Ÿæˆ ã€‚</p>

<p><img src="media/15282735197620/4CC5806A78B51C75CA0789FB03A1D13D.jpg" alt="4CC5806A78B51C75CA0789FB03A1D13D"/></p>

<h3 id="toc_6">éšæœºæ•°ç”Ÿæˆä»¥åŠæ‰“ä¹±æ“ä½œ</h3>

<p>è¿‡å»æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆæ“ä½œ</p>

<pre><code>1+(arc4random() % 6) //ç”Ÿæˆ1-6ä¹‹é—´çš„éšæœºæ•°
</code></pre>

<p>swift4.2ä¸­æä¾›çš„æ–°çš„æ–¹æ³•</p>

<pre><code>Int.random(in: 0..&lt;10)
Float.random(in: 0..&lt;1)
[&quot;1&quot;,&quot;he&quot;,&quot;she&quot;,&quot;we&quot;].randomElement()! //é€‰ä¸¾å‡ºä¸€ä¸ªéšæœºçš„
[&quot;1&quot;,&quot;he&quot;,&quot;she&quot;,&quot;we&quot;].shuffled()   // æ‰“ä¹±é¡ºåºï¼Œé‡æ–°ç»„åˆ
</code></pre>

<p>é™¤äº†ç³»ç»Ÿæä¾›çš„éšæœºæ•°ç”Ÿæˆæ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®©ç³»ç»Ÿè°ƒç”¨æˆ‘ä»¬è‡ªå·±å†™çš„éšæœºæ•°ç”Ÿæˆç®—æ³•ã€‚<br/>
éœ€è¦å®ç°åè®®<code>RandomNumberGenerator</code></p>

<pre><code>struct PrivateRandom: RandomNumberGenerator {...} //å®šä¹‰è‡ªå·±çš„éšæœºæ•°ç”Ÿæˆæ–¹å¼
var pr = PrivateRandom()
Int.random(in: 0..&lt;10, using: &amp;pr) //æŒ‰ç…§è‡ªå·±çš„éšæœºæ•°ç”Ÿæˆæ–¹æ³•è¿›è¡Œç”Ÿæˆ
</code></pre>

<h3 id="toc_7">Enhanced conditional conformances</h3>

<p>conditional conformances å…è®¸åœ¨åªæœ‰åœ¨ç‰¹å®šæ¡ä»¶æ»¡è¶³æ—¶ï¼Œæ‰å®ç°æŸç§åè®®</p>

<p>æ¯”å¦‚è¯´</p>

<pre><code>
protocol Purchaseable {
    func buy()
}

struct Book: Purchaseable {
    func buy(){
     print(&quot;You bought a book&quot;)
    }
}

extension Array: Purchaseable where Element: Purchaseable {
    func buy(){
    
    }
}
</code></pre>

<h4 id="toc_8">è¿è¡Œæ—¶çš„ç±»å‹è¯¢é—®</h4>

<p>ä½†æ˜¯å¦‚æœåœ¨è¿è¡Œæ—¶ å»è¯¢é—®è¿™ä¸ªarrayæ—¶ï¼Œä¼šå‡ºç°crashçš„æƒ…å†µï¼ˆå› ä¸ºé»˜è®¤æŠŠarrayå®šä¹‰ä¸ºanyï¼‰ã€‚<br/>
è¿™ä¸ªæƒ…å†µåœ¨Swift4.2ä¸­å¾—åˆ°è§£å†³ã€‚</p>

<p>ä¸¾ä¾‹è¯´æ˜<br/>
<img src="media/15282735197620/F9E6BB62AB0D7F29BAEC7E1428ECD376.jpg" alt="F9E6BB62AB0D7F29BAEC7E1428ECD376"/></p>

<h4 id="toc_9">Optionalã€Arrayã€Dictionaryç­‰å¯¹åè®®çš„é»˜è®¤å®ç°</h4>

<p>åœ¨swift4.2ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬è¦å¯¹ ä¸¤ä¸ªå®¹å™¨æ˜¯å¦ç›¸ç­‰è¿›è¡Œåˆ¤å®šï¼Œé€šå¸¸è¦æ‰‹åŠ¨å®ç°Equatableåè®®ã€‚</p>

<p><img src="media/15282735197620/43EF202AEED4513984A2C30BDA907EAB.jpg" alt="43EF202AEED4513984A2C30BDA907EAB"/></p>

<p>åœ¨swift4.2ä¸­ï¼Œå¯¹äºè¿™äº›å®¹æ˜“ç±»å‹ï¼Œ swiftå·²ç»ä¸ºæˆ‘ä»¬åšå¥½äº†å¤„ç†ã€‚</p>

<p><img src="media/15282735197620/A9F4B891E7C0A3D7C242ABE9838204AD.png" alt="A9F4B891E7C0A3D7C242ABE9838204AD"/></p>

<p><img src="media/15282735197620/170E2367105A5EB8FBBF90FF4D0184C6.png" alt="170E2367105A5EB8FBBF90FF4D0184"/></p>

<p><strong>æœªå®Œå¾…ç»­</strong></p>

<h2 id="toc_10">Hashableï¼ˆæœªå®Œå¾…ç»­ï¼‰</h2>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¸©å‘è®°å½•]]></title>
    <link href="iginkgo.cn/15282672319466.html"/>
    <updated>2018-06-06T14:40:31+08:00</updated>
    <id>iginkgo.cn/15282672319466.html</id>
    <content type="html"><![CDATA[
<!--more-->

<h3 id="toc_0">é—®é¢˜1  ä½¿ç”¨ Leaksæ£€æŸ¥é¡¹ç›®å†…å­˜æ³„æ¼ï¼Œå´©æºƒçš„é—®é¢˜</h3>

<p>é—®é¢˜æè¿°</p>

<p>è¿›å…¥Leaksæ¨¡æ‹Ÿå™¨æˆ–è€…çœŸæœºappï¼Œè¿›å…¥30så·¦å³å°±å‡ºç°å´©æºƒçš„ç°è±¡ï¼Œä½†æ˜¯æ­£å¸¸è¿è¡Œappæ²¡æœ‰é—®é¢˜</p>

<p><a href="">å‚è€ƒèµ„æ–™</a><br/>
æœ€åæ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼š<br/>
è¿›å…¥leaksä¹‹åï¼Œåœ¨å¼€å¯ä»»åŠ¡å‰ï¼Œ<br/>
é€šè¿‡æ“ä½œ<code>file</code> -&gt; <code>recordOptions</code> -&gt; <code>recordCount</code> å–æ¶ˆé€‰æ‹©</p>

<h3 id="toc_1">é—®é¢˜2 å¯¹äºçº¦æŸçš„åˆ¤å®š</h3>

<p>åº”ç”¨åœºæ™¯ï¼š ä¸€ä¸ªsuperview åŠ å…¥ ä¸€ä¸ªå­view-UITableViewã€‚<br/>
åœ¨åç»­éœ€è¦æ‰¾åˆ°tableViewçš„é¡¶éƒ¨çº¦æŸå¹¶æ”¹å˜å…¶å€¼ï¼Œä½¿ä¹‹å‘ç”Ÿæ”¹å˜ã€‚</p>

<pre><code>  self.view.constraints.foreach { (const) in
    if const.firstAttribute == NSLayoutAttribute.top.
        let view = const.firstItem as? UITableView,
            view = self.tableView {
            //TODO: æ­¤å¤„å·²è¯†åˆ«ï¼Œdo sth
            }
  }
</code></pre>

<p>åœ¨è¿™å¯¹å…³ç³»ä¸­ constä¸­çš„item1æ˜¯UITableViewï¼Œitem2æ˜¯superView<br/>
ç”±äºtableViewçš„ä½ç½®éœ€è¦é€šè¿‡ superViewæ¥è¿›è¡Œç¡®å®šã€‚<br/>
åœ¨æœ€åˆæ·»åŠ çº¦æŸæ—¶ï¼Œ <code>superView.addConstraints(...)</code></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xcodeæé€Ÿ]]></title>
    <link href="iginkgo.cn/15209408664766.html"/>
    <updated>2018-03-13T19:34:26+08:00</updated>
    <id>iginkgo.cn/15209408664766.html</id>
    <content type="html"><![CDATA[
<p>å¦‚ä½•æ›´åŠ å¿«é€Ÿçš„ä½¿ç”¨Xcode</p>

<span id="more"></span><!-- more -->

<h2 id="toc_0">1.æŠŠDeriveDataæ”¾åœ¨å†…å­˜ä¸­</h2>

<p><a href="http://blog.csdn.net/qq_30513483/article/details/70600301">ç›¸å…³åœ°å€</a></p>

<p>ç›¸å…³æ€è·¯<br/>
1. é…ç½®ramï¼Œè®©ramå¼€è¾Ÿå‡ºä¸€å—å†…å­˜ä¸“é—¨ä¾›Xcodeä½¿ç”¨<br/>
2. è¿æ¥Xcodeï¼Œè®©Xcodeè¿æ¥åˆ°æˆ‘ä»¬å¼€è¾Ÿå‡ºçš„ä¸“å±å†…å­˜ä¸­</p>

<p>æ–¹æ¡ˆ<br/>
1.åˆ›å»º<code>.sh</code>æ–‡ä»¶</p>

<pre><code>#!/bin/bash
RAMDISK=â€ramdiskâ€
SIZE=1024         #size in MB for ramdisk.
diskutil erasevolume HFS+ $RAMDISK \
     `hdiutil attach -nomount ram://$[SIZE*2048]`
</code></pre>

<p>2.å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>./ramdisk.sh</code>å‘½ä»¤ï¼Œæ‰§è¡Œè¯¥è„šæœ¬</p>

<pre><code>//æ³¨æ„ï¼šå¦‚æœå‡ºç°`Permission denied`çš„æƒ…å†µï¼Œä½¿ç”¨
chmod 777 aa.sh
</code></pre>

<p>3.å‘ç° ./Volume/ ä¸‹å‡ºç°äº†ä¸€ä¸ªæ–°çš„å†…å­˜ç©ºé—´</p>

<p>4.Xcode-&gt;Preference-&gt;Locations-&gt;Location Tabä¸­ <br/>
DeriveData ç›®å½•é€‰å®šä¸º Customï¼Œç„¶åè·¯å¾„ä¸º /Volumes/â€œramdiskâ€/DeriveData</p>

]]></content>
  </entry>
  
</feed>
